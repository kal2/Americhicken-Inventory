**********
* Program.: MATCHED.PRG
* Author..: GRACE KELLER
* Date....: 01/25/88 
* Notice..: Copyright 1986, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: CUSTOMERS WITH MATCHED INVOICES ON FILE
*

*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
CLEAR 
@  1, 0 SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + ' - MATCH SELECT'
@ 3,0 to 24,79
**** GET DATE FOR THIS REPORT
STORE DATE() TO MPAY_DATE
STORE 'D' TO MDISP_PRT
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 10,5 SAY 'ENTER PAYMENT DATE: '
   @ 10,25 GET MPAY_DATE
   
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MPAY_DATE) = '  /  /  '
         @ 24,0 CLEAR
         mwait = ' '
         @ 24,1 SAY 'NO DATE ENTERED - PRESS ANY KEY TO REENTER' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 CLEAR
         LOOP 
      ENDIF
   ENDIF
ENDDO

IF MACTION = 3
   RETURN
ENDIF  
SELECT D
USE TEMP_AGE INDEX TEMP_AGE EXCLUSIVE         
DELETE ALL
PACK
USE
SELECT D
DO FOX_USE WITH "TEMP_AGE INDEX TEMP_AGE", .F.

SELECT C
DO FOX_USE WITH "SUP_INV INDEX SUP_INV", .F.
IF EOF()
   @ 10,5 SAY 'THERE ARE NO MATCHED INVOICES ON FILE FOR SUPPLIERS.'
   STORE ' ' TO MWAIT
   @ 12,5 SAY 'PRESS ANY KEY TO CONTINUE ' GET MWAIT
   READ
   RETURN
ENDIF

DO WHILE .NOT. EOF()
   STORE RSUPCODE TO MRSUPCODE
   MWRITE = .F.
   MTOTAL = 0
   DO WHILE .NOT. EOF() .AND. RSUPCODE = MRSUPCODE
      IF DUE_DATE <= MPAY_DATE
         MWRITE = .T.
         MTOTAL = MTOTAL + AMT_BILL  
      ENDIF
      SKIP
   ENDDO
   IF MWRITE
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
      SEEK MRSUPCODE
      IF .NOT. EOF()
         STORE NAME TO MNAME
         STORE CITY TO MCITY       
         STORE STATE TO MSTATE
      ELSE 
         STORE 'REMIT TO NOT ON FILE' TO MRSUPNAME
         STORE SPACE(20) TO MCITY
         STORE SPACE(2) TO MSTATE
      ENDIF
      SELECT D
      DO FILELOCK
      APPEND BLANK
      REPLACE NAME WITH MNAME
      REPLACE CITY WITH MCITY     
      REPLACE STATE WITH MSTATE
      REPLACE RSUPCODE WITH MRSUPCODE
      REPLACE TOT_SELL WITH MTOTAL
      UNLOCK
      
      SELECT C
   ENDIF
ENDDO
CLOSE DATA
RETURN
* EOF: MATCHED.PRG
*Formatted by: dANALYST Ver. 7.3a on January 26, 1988 at 2:52 PM.
