**********
* Program.: PAYDTL.PRG
* Author..: GRACE KELLER
* Date....: 01/08/88
* Notice..: Copyright 1988, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: DAILY PAYMENTS REPORT              
*

MTITLE = ' - DAILY RECEIPTS REGISTER'

CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET DATE FOR THIS REPORT
STORE DATE() TO MDATE
STORE 'P' TO MDISP_PRT
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 08,5 SAY '            ENTER REPORT DATE: '
   @ 08,37 GET MDATE
   *  @ 10,5 SAY 'DISPLAY OR PRINT REPORT (D/P):'
   *  @ 10,37 GET MDISP_PRT PICTURE '@!'
   
   STORE 1 TO MACTION
   @ 23,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MDATE) = '  /  /  '
         @ 24,0 CLEAR
         mwait = ' '
         @ 24,1 SAY 'NO DATE ENTERED - PRESS ANY KEY TO REENTER' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 CLEAR
         LOOP 
      ENDIF
   ENDIF
ENDDO

IF MACTION = 3
   RETURN
ENDIF  
MACTION = 'C'

IF MDISP_PRT = 'P'
   DO PRT_SET
   
   IF MACTION <> 'C'
      RETURN
   ENDIF
   MPAGE_LEN = 56
ELSE
   MPAGE_LEN = 22
ENDIF

STORE MONTH(MDATE) TO MMONTH
MMONTH = MMONTH + 100
STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH

STORE YEAR(MDATE) TO MYEAR
STORE STR(MYEAR,4) TO MYEAR

STORE DAY(MDATE) TO MDAY
MDAY = MDAY + 100
STORE SUBSTR(STR(MDAY,3),2) TO MDAY

SELECT A
DO FOX_USE WITH "PAYMENTS INDEX PAY_DATE", .F.
SEEK MYEAR + MMONTH + MDAY
IF EOF()
   @ 4,1 CLEAR TO 21,78 
   @ 10,5 SAY 'THERE IS NO PAYMENT DATA ON FILE FOR THIS DATE'
   STORE ' ' TO MWAIT
   @ 12,5 SAY 'PRESS ANY KEY TO CONTINUE ' GET MWAIT
   READ
   RETURN
ENDIF

MPAGE_NO = 0
MLINE = 99 
IF MDISP_PRT = 'P'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON

*** PRINT IN 12 CPI
?? chr(27) + '&k4S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

ENDIF

MTOTAL = 0

DO WHILE .NOT. EOF() .AND. MYEAR = SUBSTR(DTOC(PAID_DATE),7) .AND. VAL(MMONTH) = VAL(SUBSTR(DTOC(PAID_DATE),1,2)) .and. val(MDAY) = VAL(SUBSTR(DTOC(PAID_DATE),4,2))
   
   IF MLINE > MPAGE_LEN
      IF MLINE <> 99
         IF MDISP_PRT = 'P'
            EJECT
         ELSE
            STORE 'C' TO MPRT_SEL
            @ 24,0 SAY "PRESS 'C' TO CONTINUE OR 'S' TO STOP REPORT DISPLAY: "     ;
               GET MPRT_SEL PICTURE '@! A'
            READ
            IF MPRT_SEL = 'S'
               SELECT A
               GOTO BOTTOM
               SKIP
               LOOP
            ENDIF
            CLEAR
         ENDIF
      ENDIF
      IF MLINE = 99 .AND. MDISP_PRT <> 'P'
         CLEAR
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      
      
      @ 1,34 SAY MCOMPANY
      @ 2,0 SAY 'PAGE'
      @ 2,05 say mpage_no picture '99'
      @ 2,22 SAY 'DAILY RECEIPTS REGISTER FOR ' + DTOC(MDATE)
      @ 2,70 SAY DTOC(DATE())
      @ 4,0 SAY 'INV NBR'
      @ 4,10 SAY 'PO NUMBER'
      @ 4,22 SAY 'PAYER'    
      @ 4,56 SAY 'CHECK NBR'
      @ 4,68 SAY ' RECEIVABLE'
      @ 4,82 SAY '     MISC.'
      IF MDISP_PRT = 'P'
         @ 4,0 SAY REPLICATE ('_',92)
      ELSE
         @ 5,0 SAY REPLICATE ('-',80)
      ENDIF
      MLINE = 6
   ENDIF
   
   STORE SALESMAN TO MSALESMAN
   STORE PO_NBR TO MPO_NBR
   STORE PO_SUFFIX TO MPO_SUFFIX
   STORE BBUYCODE TO MBBUYCODE
   STORE RSUPCODE TO MRSUPCODE
   STORE SPACE(7) TO MCK_NBR
   IF MBBUYCODE = SPACE(4) .AND. MRSUPCODE = SPACE(4)
      STORE DESCRIP TO MBBUYNAME
      STORE 'MISC' TO MCK_NBR
   ELSE
      IF MBBUYCODE <> SPACE(4)
         IF MBBUYCODE = 'NONE'
            STORE 'NONE' TO MBBUYNAME
         ELSE  
            SELECT B
            DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
            SEEK MBBUYCODE
            IF .NOT. EOF()
               STORE NAME TO MBBUYNAME
            ELSE 
               STORE 'NOT ON FILE' TO MBBUYNAME
            ENDIF
         ENDIF
      ELSE
         IF MRSUPCODE = 'NONE'
            STORE 'NONE' TO MBBUYNAME
         ELSE  
            SELECT B
            DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
            SEEK MRSUPCODE
            IF .NOT. EOF()
               STORE NAME TO MBBUYNAME
            ELSE 
               STORE 'NOT ON FILE' TO MBBUYNAME
            ENDIF
         ENDIF
      ENDIF
      
      SELECT A
   ENDIF
   
   IF SALESMAN <> SPACE(2)
      STORE SALESMAN + '-' + INV_NBR TO MINV_NBR
   ELSE
      STORE INV_NBR TO MINV_NBR
   ENDIF
   
   @ MLINE,0  SAY MINV_NBR
   IF MSALESMAN <> SPACE(2)
      @ MLINE,10 SAY MSALESMAN + '-' + MPO_NBR
   ELSE
      @ MLINE,13 SAY MPO_NBR
   ENDIF
   IF MPO_SUFFIX <> ' '
      @ MLINE,17 SAY '-' + PO_SUFFIX
   ENDIF
   @ MLINE,22 SAY MBBUYNAME
   IF CK_NBR <> SPACE(7)
      STORE CK_NBR TO MCK_NBR
   ENDIF
   @ MLINE,56 SAY MCK_NBR
   @ MLINE,69 SAY AMT_PAID PICTURE '@B 999,999.99'
   @ MLINE,82 SAY AMT_OVER PICTURE '@Z 999,999.99'
   MTOTAL = MTOTAL + AMT_PAID + AMT_OVER 
   MLINE = MLINE + 2
   SKIP
ENDDO

IF MDISP_PRT = 'P'
   @ MLINE,0 SAY 'TOTAL RECEIPTS:'
   @ MLINE,67 SAY MTOTAL PICTURE '9,999,999.99'
   @ mline+1,1 say ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
ELSE
   IF MLINE > MPAGE_LEN
      @ 6,0 CLEAR
      MLINE = 6
   ENDIF
   @ MLINE,0 SAY '    TOTAL RECEIPTS:'
   @ MLINE,66 SAY MTOTAL PICTURE '9,999,999.99'
   MPRT_SEL = ' '
   @ 24,00 SAY 'End Of Report - Press Return to Continue ' GET MPRT_SEL
   READ
ENDIF

CLOSE DATA
RETURN

* EOF: PAYDTL.PRG
*Formatted by: ToolBox Ver. 1.2  on 7/23/14 at 11:57 AM.
