SET DELETED ON
SET CENTURY ON

*** need to add the pending in here

SELECT B
USE INVN_DTL
INDEX ON SALESMAN+PO_NBR+PO_SUFFIX TO XX
USE INVN_DTL INDEX XX

SELECT A
USE INVEN
SET FILTER TO SOLD_FLG = 'Y'
GOTO TOP

DO WHILE .NOT. EOF()
   IF SHIP_DATE <= CTOD('12/31/2007')
      STORE SALESMAN TO MSALESMAN
      STORE PO_NBR TO MPO_NBR
      STORE PO_SUFFIX TO MPO_SUFFIX
      SELECT B
      SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
      DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
         DELETE
         SKIP
      ENDDO
      SELECT A
      DELETE
   ENDIF
   SKIP
ENDDO
