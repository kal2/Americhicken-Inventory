*************
* Program.: ORD_MARG.PRG
* Author..: Grace Keller
* Date....: 10/26/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PRINT ORDER MARGIN SHEET
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
MTITLE = ' - PRINT ORDER MARGIN SUMMARY'
SET PROCEDURE TO ORD_MARG
SELECT C
DO FOX_USE WITH "PO_DTL INDEX PO_DTL", .F.
SELECT B
DO FOX_USE WITH "PO_HEAD INDEX PO_HEAD, PRINT, PO_SUP, PO_SHIP, PO_FRT", .F.
STORE SPACE(2)    TO MSALESMAN
STORE SPACE(4)    TO MPO_NBR
STORE SPACE(1)    TO MPO_SUFFIX
STORE 1 TO MACTION
MPO_SEL = .T.
DO WHILE MPO_SEL
   CLEAR 
   @  1, 0 SAY MCOMPANY
   @  1,68 SAY DATE()
   MTITLE = ' - SELECT ORDER'
   @  2, 0 SAY MPROGRAM + MTITLE
   @ 3,0 TO 22,79
   
   @  5, 5 SAY 'Enter Search Field:'
   @  8, 5 SAY 'Order Number'
   @ 10, 5 GET Msalesman PICTURE '##'
   @ 10,7 say '-'
   @ 10,8 get mpo_nbr picture '####'
   @ 10,12 say '-'
   @ 10,13 get mpo_suffix picture '@!'
   STORE 1 TO MACTION
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)  
   @ 24,13 SAY '1. Print    2. Edit    3. Finished'
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   
   IF MACTION = 2
      LOOP
   ENDIF
   
   IF MACTION = 3 .OR. MPO_NBR = SPACE(4)
      MSALESMAN = SPACE(2)
      MPO_NBR = SPACE(4)
      MPO_SUFFIX = ' '
      MPO_SEL = .F.
      LOOP
   ENDIF
   
   SELECT B
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   IF EOF() .OR. DELETED()
      @ 23,0 CLEAR
      MWAIT = ' '
      @ 24,10 SAY 'ORDER NOT ON FILE - PRESS RETURN TO SELECT AGAIN ' GET MWAIT
      READ
      LOOP
   ENDIF
   IF SHIP_NBR <> SPACE(4) .AND. MAIN_SHIP <> 'Y'
      @ 23,0 CLEAR
      MWAIT = ' '
      @ 24,1 SAY 'SHIPPED WITH PO DOES NOT NEED P/L RPT-PRESS RETURN TO SELECT AGAIN ' GET MWAIT
      READ
      LOOP
   ENDIF
   DO MARG_PRT
   MSALESMAN = SPACE(2)
   MPO_NBR = SPACE(4)
   MPO_SUFFIX = ' '
ENDDO

CLOSE DATA
SET PROC TO

RETURN


PROCEDURE MARG_PRT
** INITIALIZE TOTAL PRODUCT SUMMARY LINES
I = 1
DO WHILE I <= 15
   MI = SUBSTR(STR(I+100,3),2)
   STORE SPACE(6) TO TPROD&MI
   STORE 0 TO TQTY&MI, TLBS&MI
   STORE 0 TO TSELL&MI, TPURCH&MI, TCOM1&MI, TCOM2&MI, TCOM3&MI
   STORE 0 TO TFRT&MI, TMISC&MI, TNET&MI
   I = I + 1
ENDDO

SELECT B
STORE SUP_CODE TO MSUP_CODE
STORE RSUPCODE TO MRSUPCODE
STORE FRT_CODE1 TO MFRT_CODE
***************************
** GET FREIGHT  INFORMATION
***************************
SELECT E
DO FOX_USE WITH "&MDBFLOC.FREIGHT INDEX &MDBFLOC.FRT_CODE", .F.
SEEK MFRT_CODE
IF EOF()
   STORE 'FREIGHT NOT ON FILE' TO MFRT_NAME
ELSE
   STORE NAME TO MFRT_NAME
ENDIF
***************************
** GET SUPPLIER INFORMATION
***************************
SELECT E
DO FOX_USE WITH "&MDBFLOC.SUPPLIER INDEX &MDBFLOC.SUP_CODE", .F.
SEEK MSUP_CODE
IF .NOT. EOF()
   STORE SUBSTR(NAME,1,30) TO MSUP_NAME       
   STORE STREET + SPACE(2) TO MSUP_STRT
   IF ZIP4 = SPACE(4)
      STORE ZIP + SPACE(5) TO MSUP_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MSUP_ZIP 
   ENDIF
   STORE TRIM(CITY) + ', ' + STATE  + '  ' + MSUP_ZIP TO MSUP_CITYST
   STORE LEN(MSUP_CITYST) TO MLEN
   IF MLEN < 30
      STORE MSUP_CITYST + SPACE(30-MLEN) TO MSUP_CITYST
   ELSE
      IF MLEN > 30
         STORE SUBSTR(MSUP_CITYST,1,3) TO MSUP_CITYST
      ENDIF
   ENDIF
ELSE
   STORE SPACE(30) TO MSUP_NAME
   STORE SPACE(30) TO MSUP_STRT
   STORE SPACE(30) TO MSUP_CITYST
ENDIF

DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
SEEK MRSUPCODE
IF .NOT. EOF()
   STORE SUBSTR(NAME,1,30) TO MREM_NAME       
   STORE STREET +SPACE(2) TO MREM_STRT  
   IF ZIP4 = SPACE(4)
      STORE ZIP + SPACE(5) TO MREM_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MREM_ZIP 
   ENDIF
   STORE TRIM(CITY) + ', ' + STATE  + '  ' + MREM_ZIP TO MREM_CITYST
   STORE LEN(MREM_CITYST) TO MLEN
   IF MLEN < 30
      STORE MREM_CITYST + SPACE(30-MLEN) TO MREM_CITYST
   ELSE
      IF MLEN > 30
         STORE SUBSTR(MREM_CITYST,1,3) TO MREM_CITYST
      ENDIF
   ENDIF
ELSE
   STORE SPACE(30) TO MREM_NAME
   STORE SPACE(30) TO MREM_STRT
   STORE SPACE(30) TO MREM_CITYST
ENDIF

SELECT B
STORE BUY_CODE TO MBUY_CODE
STORE BBUYCODE TO MBBUYCODE
***************************
** GET CUSTOMER INFORMATION
***************************
SELECT E
DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_CODE", .F.
SEEK MBUY_CODE
IF .NOT. EOF()
   STORE SUBSTR(NAME,1,30) TO MCUS_NAME       
   STORE STREET + SPACE(2) TO MCUS_STRT  
   IF ZIP4 = SPACE(4)
      STORE ZIP + SPACE(5) TO MCUS_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MCUS_ZIP 
   ENDIF
   STORE TRIM(CITY) + ', ' + STATE  + '  ' + MCUS_ZIP TO MCUS_CITYST
   STORE LEN(MCUS_CITYST) TO MLEN
   IF MLEN < 30
      STORE MCUS_CITYST + SPACE(30-MLEN) TO MCUS_CITYST
   ELSE
      IF MLEN > 30
         STORE SUBSTR(MCUS_CITYST,1,3) TO MCUS_CITYST
      ENDIF
   ENDIF
ELSE
   STORE SPACE(30) TO MCUS_NAME
   STORE SPACE(30) TO MCUS_STRT
   STORE SPACE(30) TO MCUS_CITYST
ENDIF

DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
SEEK MBBUYCODE
IF .NOT. EOF()
   STORE SUBSTR(NAME,1,30) TO MBIL_NAME       
   STORE STREET +SPACE(2) TO MBIL_STRT
   IF ZIP4 = SPACE(4)
      STORE ZIP + SPACE(5) TO MBIL_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MBIL_ZIP 
   ENDIF
   STORE TRIM(CITY) + ', ' + STATE  + '  ' + MBIL_ZIP TO MBIL_CITYST
   STORE LEN(MBIL_CITYST) TO MLEN
   IF MLEN < 30
      STORE MBIL_CITYST + SPACE(30-MLEN) TO MBIL_CITYST
   ELSE
      IF MLEN > 30
         STORE SUBSTR(MBIL_CITYST,1,3) TO MBIL_CITYST
      ENDIF
   ENDIF
ELSE
   STORE SPACE(30) TO MBIL_NAME
   STORE SPACE(30) TO MBIL_STRT
   STORE SPACE(30) TO MBIL_CITYST
ENDIF

STORE SPACE(30) TO MCOM_NAME, MCOM_NAME2, MCOM_NAME3
DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
IF B->COM_CODE <> SPACE(2)
   SEEK B->COM_CODE
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME
   ENDIF
ENDIF
IF B->COM_CODE2 <> SPACE(2)
   SEEK B->COM_CODE2
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME2
   ENDIF
ENDIF
IF B->COM_CODE3 <> SPACE(2)
   SEEK B->COM_CODE3
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME3
   ENDIF
ENDIF

**** IF SHIPPED WITH PO, GET ALL ORDERS GOING TOGETHER ON ONE REPORT
SELECT B
IF B->MAIN_SHIP = 'Y'
   STORE RECNO() TO MRECNO
   STORE MPO_NBR TO MPO_SHIP1
   STORE MPO_SUFFIX TO MPO_SUFF1
   
   SELECT A
   DO FOX_USE WITH "SHIPWITH INDEX SHIPWITH", .T.
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   I = 2
   DO WHILE I <= 7
      MI = STR(I,1)
      MX = STR(I-1,1)
      STORE PO_SHIP&MX TO MPO_SHIP&MI
      STORE PO_SUFF&MX TO MPO_SUFF&MI
      I = I + 1
   ENDDO
   
   DO FOX_USE WITH "C:\COMPWORK\DTL_TEMP", .T.
   DELETE ALL
   PACK
   INDEX ON PROD_DESC + STR_PRI TO C:\COMPWORK\DTL_TEMP
   DO FOX_USE WITH "C:\COMPWORK\DTL_TEMP INDEX C:\COMPWORK\DTL_TEMP", .F.
   MTOT_FRT = 0
   MCUS_ADJ = 0
   MSUP_ADJ  = 0
   MTOT_MISC = 0
   MTOT_COM1 = 0
   MTOT_COM2 = 0
   MTOT_COM3 = 0
   MTOT_SELL = 0
   MTOT_PURCH = 0
   MTOT_NET   = 0
   MTOT_LBS   = 0
   I = 1
   DO WHILE I <= 7
      MI = STR(I,1)
      SELECT B
      SEEK MSALESMAN + MPO_SHIP&MI + MPO_SUFF&MI
      MFREIGHT  =  FRT_AMT1 + FRT1_ADJ1 + FRT1_ADJ2
      MCUS_ADJ  = MCUS_ADJ + CUS_AMT1 + CUS_AMT2
      MSUP_ADJ  = MSUP_ADJ + SUP_AMT1 + SUP_AMT2
      MTOT_FRT  = MTOT_FRT + MFREIGHT
      MTOT_COM1 = MTOT_COM1 + COMM_AMT
      MTOT_COM2 = MTOT_COM2 + COMM_AMT2 
      MTOT_COM3 = MTOT_COM3 + COMM_AMT3
      MTOT_SELL = MTOT_SELL + TOT_SELL + CUS_PALL
      MTOT_PURCH = MTOT_PURCH + TOT_PURCH + SUP_PALL
      MTOT_NET = MTOT_NET + TOT_NET
      MTOT_LBS = MTOT_LBS + TOT_LBS
      
      IF B->MISC_FLG <> ' '
         SELECT E           
         DO FOX_USE WITH "MISC_CHG INDEX MISC_CHG", .F.
         SEEK MSALESMAN + MPO_SHIP&MI + MPO_SUFF&MI
         MMISC = MISCAMT1 + MISCAMT2 + MISCAMT3
         USE
         SELECT C
      ELSE
         MMISC = 0
      ENDIF
      MTOT_MISC = MTOT_MISC + MMISC
      
      SELECT C
      SEEK MSALESMAN + MPO_SHIP&MI + MPO_SUFF&MI
      
      DO WHILE .NOT. EOF() .AND. MSALESMAN = SALESMAN .AND. PO_NBR = MPO_SHIP&MI .AND. PO_SUFFIX = MPO_SUFF&MI
         
         IF PROD_DESC = SPACE(4) 
            SKIP
            LOOP
         ENDIF
         
         STORE STR(PUR_PRICE,7,4) TO MSTR_PRI
         
         SELECT A
         SEEK C->PROD_DESC + MSTR_PRI
         
         IF EOF()
            DO FILELOCK
            APPEND BLANK
            REPLACE PROD_DESC WITH C->PROD_DESC
            REPLACE STR_PRI   WITH MSTR_PRI
            REPLACE SALESMAN WITH MSALESMAN
            REPLACE PO_NBR   WITH MPO_NBR
            REPLACE PO_SUFFIX WITH MPO_SUFFIX
            UNLOCK
         ENDIF
         
         DO RECLOCK
         REPLACE SEL_PRICE WITH C->SEL_PRICE
         REPLACE PUR_PRICE WITH C->PUR_PRICE
         REPLACE COM1_CENT WITH C->COM1_CENT
         REPLACE COM2_CENT WITH C->COM2_CENT
         REPLACE COM3_CENT WITH C->COM3_CENT
         REPLACE QTY WITH QTY + C->QTY
         REPLACE TOT_SELL WITH TOT_SELL + C->TOT_SELL
         REPLACE TOT_PURCH WITH TOT_PURCH + C->TOT_PURCH
         REPLACE LBS WITH LBS + C->LBS
         SELECT C
         SKIP
      ENDDO
      I = I + 1
   ENDDO
   SELECT B
   GOTO MRECNO
ELSE
   SELECT B
   MTOT_FRT =  FRT_AMT1 + FRT1_ADJ1 + FRT1_ADJ2
   MTOT_COM1 = COMM_AMT
   MTOT_COM2 = COMM_AMT2
   MTOT_COM3 = COMM_AMT3
   MCUS_ADJ  = CUS_AMT1 + CUS_AMT2
   MSUP_ADJ  = SUP_AMT1 + SUP_AMT2
   MTOT_SELL = TOT_SELL + CUS_PALL
   MTOT_PURCH = TOT_PURCH + SUP_PALL
   MTOT_NET = TOT_NET
   MTOT_LBS = TOT_LBS
   IF MISC_FLG <> ' '
      SELECT E           
      DO FOX_USE WITH "MISC_CHG INDEX MISC_CHG", .F.
      SEEK B->SALESMAN + B->PO_NBR + B->PO_SUFFIX
      MMISC = MISCAMT1 + MISCAMT2 + MISCAMT3
      USE
      SELECT B
   ELSE
      MMISC = 0
   ENDIF
   MTOT_MISC = MMISC
ENDIF

STORE ' ' TO MACTION
DO PRT_BOT
IF MACTION <> 'C'
   MACTION = 1
   CLOSE DATA
   RETURN
ENDIF 
MACTION = 2
SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 12 CPI
?? chr(27) + '&k4S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

LMARGIN = SPACE(1)
SELECT B
?
?
?  LMARGIN + 'ORDER MARGIN SUMMARY         PRINTED ON: ' + DTOC(DATE())
?
?  LMARGIN + '   PO NBR:   '
?? SALESMAN
IF SALESMAN = '  '
   ?? PO_NBR
ELSE
   ?? '-' + PO_NBR
ENDIF
IF PO_SUFFIX = ' '
   ?? SPACE(2)
ELSE
   ?? '-' + PO_SUFFIX
ENDIF
IF B->MAIN_SHIP = 'Y'
   ?? SPACE(4) + 'SHIPPED WITH: '
   I = 2
   DO WHILE I <= 7
      MI = STR(I,1)
      IF MPO_SHIP&MI <> SPACE(4) 
         ?? SALESMAN + '-' + MPO_SHIP&MI
         IF MPO_SUFF&MI <> ' '
            ?? '-' + MPO_SUFF&MI
         ENDIF
         ?? SPACE(3)
      ENDIF
      I = I + 1
   ENDDO
ENDIF
?
?
?  LMARGIN + 'SHIP DATE:      ' + DTOC(SHIP_DATE)
?
?  LMARGIN + 'DELV DATE:      ' + DTOC(DEL_REQD)
?
?  LMARGIN + ' CUSTOMER:  ' + SPACE(4) + MCUS_NAME + SPACE(5) + MBIL_NAME
?  LMARGIN + '  CUST PO:  ' + SPACE(4) +BUYER_PO
?
*?  LMARGIN + 'SUPPLIER:  ' + SPACE(5) +MSUP_NAME + SPACE(5) + MREM_NAME
*?
?  LMARGIN + 'PROGRAM/ : ' + SPACE(5) +MCOM_NAME
?  LMARGIN + 'BILLBACKS  ' + SPACE(5) +MCOM_NAME2
IF MCOM_NAME3 <> SPACE(10)
   ?  LMARGIN + '            ' + SPACE(5) +MCOM_NAME3
ENDIF
?

? '  QTY  CODE       SELL   PURCHASE   COMM #1  COMM #2  COMM #3   FRT/LB    MISC    NET $  NET/QTY'
? '  --- ------ ---------  ---------  -------- -------- --------  ------- ------- --------- -------'  
**                XX.XXXX    XX,XXXX   XX.XXXX  XX.XXXX  XX.XXXX  XX.XXXX XX.XXXX
**  XXXX  XXXX  XX,XXX.XX  XX,XXX.XX  X,XXX.XX X,XXX.XX X,XXX.XX  XXXX.XX XXXX.XX XX,XXX.XX 9999.99
** 12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
**      10       20         30        40        50        60        70        80        90        100            

?

IF B->MAIN_SHIP = 'Y'
   SELECT A
   DO FOX_USE WITH "C:\COMPWORK\DTL_TEMP", .T.
   INDEX ON SALESMAN + PO_NBR + PO_SUFFIX TO C:\COMPWORK\DTL_TEMP
   DO FOX_USE WITH "C:\COMPWORK\DTL_TEMP INDEX C:\COMPWORK\DTL_TEMP", .T.
ELSE
   SELECT C
ENDIF

SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
DO WHILE .NOT. EOF() .AND. MSALESMAN = SALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
   IF PROD_DESC = SPACE(4) .OR. QTY = 0
      SKIP
      LOOP
   ENDIF
   
   IF MTOT_FRT = 0
      MFRT_LB = 0
   ELSE
      MFRT_LB = ROUND(MTOT_FRT/MTOT_LBS,4)
   ENDIF
   
   IF MTOT_COM1 = 0 .AND. COM1_CENT = 0
      MCOM1_LB = 0
   ELSE
      MCOM1_LB = COM1_CENT
   ENDIF
   
   IF MTOT_COM2 = 0 .AND. COM2_CENT = 0
      MCOM2_LB = 0
   ELSE
      MCOM2_LB = COM2_CENT
   ENDIF
   
   IF MTOT_COM3 = 0 .AND. COM3_CENT = 0
      MCOM3_LB = 0
   ELSE
      MCOM3_LB = COM3_CENT
   ENDIF
   
   IF MTOT_MISC = 0
      MMISC_LB = 0
   ELSE
      MMISC_LB = ROUND(MTOT_MISC/MTOT_LBS,4)
      IF SUBSTR(PACKED,1,1) = 'B'
         MPACKED = VAL(SUBSTR(PACKED,2))
         MMISC_LB = ROUND(MMISC_LB * MPACKED,4)
      ENDIF
   ENDIF
   *** CALCULATE ITEM NET
   MNET_LB = SEL_PRICE - PUR_PRICE - MCOM1_LB - MCOM2_LB - MCOM3_LB - MMISC_LB
   
   IF SUBSTR(PACKED,1,1) = 'B' .AND. MFRT_LB <> 0
      MPACKED = VAL(SUBSTR(PACKED,2))
      MFRT_QTY = ROUND(MFRT_LB * MPACKED,4)
   ELSE
      MFRT_QTY = MFRT_LB
   ENDIF
   MNET_LB = MNET_LB - MFRT_QTY
   
   ? LMARGIN + SPACE(14)
   ?? TRANSFORM(SEL_PRICE, '99.9999') + SPACE(4)
   ?? TRANSFORM(PUR_PRICE, '99.9999') + SPACE(3)
   ?? TRANSFORM(MCOM1_LB, '99.9999') + SPACE(2)
   ?? TRANSFORM(MCOM2_LB, '99.9999') + SPACE(2)
   ?? TRANSFORM(MCOM3_LB, '99.9999') + SPACE(2)
   ?? TRANSFORM(MFRT_LB, '99.9999')  + SPACE(1)
   ?? TRANSFORM(MMISC_LB, '99.9999')
   ?? SPACE(11)
   ?? TRANSFORM(MNET_LB, '99.9999')
   
   ? LMARGIN + TRANSFORM(QTY, '9999') + SPACE(1)
   ?? SUBSTR(PROD_DESC,1,6) + SPACE(1)
   ?? TRANSFORM(TOT_SELL, '99,999.99') + SPACE(2)
   ?? TRANSFORM(TOT_PURCH, '99,999.99') + SPACE(2)
   MCOM1 = ROUND(MCOM1_LB * LBS,2)
   MCOM2 = ROUND(MCOM2_LB * LBS,2)
   MCOM3 = ROUND(MCOM3_LB * LBS,2)
   IF SUBSTR(PACKED,1,1) = 'B'
      MLBS = val(substr(packed,2)) * QTY
   ELSE
      MLBS = LBS
   ENDIF
   MFRT = ROUND(MFRT_LB * MLBS,2)
   MMISC = ROUND(MMISC_LB * LBS,2)
   *?? TRANSFORM(MTOT_COM1, '9,999.99') + SPACE(1)
   *?? TRANSFORM(MTOT_COM2, '9,999.99') + SPACE(1)
   *?? TRANSFORM(MTOT_COM3, '9,999.99') + SPACE(2)
   ?? TRANSFORM(MCOM1, '9,999.99') + SPACE(1)
   ?? TRANSFORM(MCOM2, '9,999.99') + SPACE(1)
   ?? TRANSFORM(MCOM3, '9,999.99') + SPACE(2)
   ?? TRANSFORM(MFRT, '9999.99') + SPACE(1)
   ?? TRANSFORM(MMISC, '9999.99') + SPACE(1)
   MNET = TOT_SELL - TOT_PURCH - MCOM1 - MCOM2 - MCOM3 - MFRT - MMISC
   ?? TRANSFORM(MNET, '99,999.99')
   *** FIND THE RIGHT PRODUCT TO ADD TO
   I = 1
   DO WHILE I<= 15
      MI = SUBSTR(STR(I+100,3),2)
      IF TPROD&MI = SPACE(6)
         TPROD&MI = SUBSTR(PROD_DESC,1,6)
      ELSE
         IF TPROD&MI <> SUBSTR(PROD_DESC,1,6)
            I = I + 1
            LOOP
         ENDIF
      ENDIF
      TQTY&MI   = TQTY&MI   + QTY
      TLBS&MI   = TLBS&MI   + MLBS
      TSELL&MI  = TSELL&MI  + TOT_SELL
      TPURCH&MI = TPURCH&MI + TOT_PURCH
      TCOM1&MI  = TCOM1&MI  + MCOM1
      TCOM2&MI  = TCOM2&MI  + MCOM2
      TCOM3&MI  = TCOM3&MI  + MCOM3
      TFRT&MI   = TFRT&MI   + MFRT
      TMISC&MI  = TMISC&MI  + MMISC
      TNET&MI   = TNET&MI   + MNET
      I = 16 
   ENDDO
   ?
   SKIP
ENDDO
?
*** NOW DO THE SUMMARY HERE
?
? LMARGIN + 'SELLING:       ' + TRANSFORM(MTOT_SELL - MCUS_ADJ, '999,999.99')
? LMARGIN + 'PURCHASE:      ' + TRANSFORM(MTOT_PURCH - MSUP_ADJ, '999,999.99')
?? SPACE(5) + TRIM(MSUP_NAME) + ' / ' + TRIM(MREM_NAME) 
? LMARGIN + 'FREIGHT:       ' + TRANSFORM(MTOT_FRT, '999,999.99')
?? SPACE(5) + MFRT_NAME
? LMARGIN + 'COMMISSION:    ' + TRANSFORM(MTOT_COM1+MTOT_COM2+MTOT_COM3, '999,999.99')
? LMARGIN + 'CUS ADJUSTMENT:' + TRANSFORM(MCUS_ADJ, '999,999.99')
? LMARGIN + 'SUP ADJUSTMENT:' + TRANSFORM(MSUP_ADJ, '999,999.99')
? LMARGIN + 'MISCELLANEOUS: ' + TRANSFORM(MTOT_MISC, '999,999.99')
?
? LMARGIN + 'NET:           ' + TRANSFORM(MTOT_NET, '999,999.99')
?
IF MTOT_SELL = 0 .OR. MTOT_NET = 0
   MMARG_PER = 0
ELSE
   MMARG_PER = ROUND(MTOT_NET/MTOT_SELL,4)
ENDIF
? LMARGIN + 'MARGIN %     ' + TRANSFORM(MMARG_PER, '999,999.9999')
?
IF MTOT_NET = 0 .OR. MTOT_LBS = 0
   MMARG_LB = 0
ELSE
   MMARG_LB = ROUND(MTOT_NET/MTOT_LBS,4)
ENDIF
? LMARGIN + 'NET PER/LB   ' + TRANSFORM(MMARG_LB, '999,999.9999')

?
IF TPROD02 <> SPACE(6)
   ?
   ?
   ? '  QTY  CODE       SELL   PURCHASE   COMM #1  COMM #2  COMM #3  FREIGHT    MISC    NET $  NET/QTY'
   ? '  --- ------ ---------  ---------  -------- -------- --------  ------- ------- --------- -------'  
   ?
   I = 1
   DO WHILE I<= 15
      MI = SUBSTR(STR(I+100,3),2)
      IF TPROD&MI = SPACE(6)
         I = 16
         LOOP
      ENDIF
      ? LMARGIN + TRANSFORM(TQTY&MI, '9999') + SPACE(1)
      ?? TPROD&MI + SPACE(1)
      ?? TRANSFORM(TSELL&MI, '99,999.99') + SPACE(2)
      ?? TRANSFORM(TPURCH&MI, '99,999.99') + SPACE(2)
      ?? TRANSFORM(TCOM1&MI, '9,999.99') + SPACE(1)
      ?? TRANSFORM(TCOM2&MI, '9,999.99') + SPACE(1)
      ?? TRANSFORM(TCOM3&MI, '9,999.99') + SPACE(2)
      ?? TRANSFORM(TFRT&MI, '9999.99') + SPACE(1)
      ?? TRANSFORM(TMISC&MI, '9999.99') + SPACE(1)
      ?? TRANSFORM(TNET&MI, '99,999.99') + SPACE(1)
      IF TNET&MI = 0 .OR. TQTY&MI = 0
         TNET_LB = 0
      ELSE
         TNET_LB = ROUND(TNET&MI / TQTY&MI, 4)
      ENDIF
      ?? TRANSFORM(TNET_LB, '99.9999')
      I = I + 1
   ENDDO
   ?
ENDIF
EJECT
SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

RETURN
* EOF: ORD_MARG.PRG

*Formatted by: ToolBox Ver. 1.2  on 3/7/18 at 4:16 PM.
