************
* Program.: CHK_SPRD.PRG
* Author..: GRACE KELLER
* Date....: 10/12/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: CHECK SPREADSHEET FOR DISCREPANCIES
*
* ---SET environment.
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     

SET CENTURY ON
SET DELETED ON
SET TALK OFF
SET ECHO OFF
SET BELL OFF
SET MENU OFF
SET SAFETY OFF
SET ESCAPE ON
SET SCOREBOARD ON
SET STATUS OFF
SET EXCLUSIVE OFF
SET PATH TO \AMERIFOX   
SET DECIMALS TO 5
SET DEVICE TO SCREEN

CLIPPER = .F.
FOXBASE = .T.
MMONO   = .F.

* ---SET COLOR TO values.   (If changed, change other one farther down too)
IF .NOT. MMONO .AND. ISCOLOR()
   SET COLOR TO W+/B,W+/R
ELSE
   SET COLOR TO W/N,N/W
ENDIF

CLOSE ALL
SET DEVICE TO SCREEN

**** FINISHES THE READ WHEN DOING A PAGE DOWN

SELECT A
DO FOX_USE WITH "C:\COMPINFO\SCREEN", .F.
MSCRNSIZE = SCRNSIZE
USE

DO CASE
*** TEST
CASE MSCRNSIZE = 'T'
   DEFINE WINDOW MWINDOW ;
     FROM 2,24 TO 40,252 ;
     FONT "LUCIDA CONSOLE", 18 ;
     COLOR W+/B, W+/R ;
     NONE
*** Jeni
CASE MSCRNSIZE = 'J'
   **GOOD - FROM 2,10 TO 35,200  
   **BETTER-  FROM 2,5 TO 35,210
   DEFINE WINDOW MWINDOW ;
     FROM 2,5 TO 40,210 ;
     FONT "LUCIDA CONSOLE", 16 ;
     COLOR W+/B, W+/R ;
     NONE
*** WIDESCREEN
CASE MSCRNSIZE = 'W'
   DEFINE WINDOW MWINDOW ;
     FROM 5,30 TO 57,272 ;
     FONT "LUCIDA CONSOLE", 20 ;
     COLOR W+/B, W+/R ;
     NONE
*** LAPTOP
CASE MSCRNSIZE = 'L'
   DEFINE WINDOW MWINDOW ;
     FROM 2,23 TO 54,265 ;
     FONT "LUCIDA CONSOLE", 20 ;
     COLOR W+/B, W+/R ;
     NONE
*** OTHER - SQUARE 
OTHERWISE
   DEFINE WINDOW MWINDOW ;
     FROM 5,4 TO 57,200 ;
     FONT "LUCIDA CONSOLE", 19 ;
     COLOR W+/B, W+/R ;
     NONE
ENDCASE

ACTIVATE WINDOW "MWINDOW"

* ---MAIN PROCESSING LOOP
CLEAR
SET COLOR TO W/W,W/W
SET COLOR TO W+/B+,W+/R+
CLEAR


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

* ---Initialize global variables.
SELECT A
DO FOX_USE WITH "COMPANY", .F.
MCOMPANY = TRIM(COMPANY)
MMASTDBF = TRIM(MASTDBF)
MDBFLOC = TRIM(DBFLOC)
USE

SELECT A
DO FOX_USE WITH "&MMASTDBF.CONTROL", .F.
MPROGRAM = TRIM(PROGRAM)
MPROG_CODE = PROG_CODE
USE

IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SELECT A
   DO FOX_USE WITH "C:\COMPINFO\PRINTERS", .F.
   MPRINTER  = TRIM(PRINTER1)
   MPRINTER2 = TRIM(PRINTER2)
   MPRINTER3 = TRIM(PRINTER3)
   USE
ELSE
   MPRINTER  = 'DONOTPRINT'
   MPRINTER2 = 'DONOTPRINT'
   MPRINTER3 = 'DONOTPRINT'
ENDIF  

MPRINTIT  = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER
MPRINTIT2 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER2
MPRINTIT3 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER3


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

STORE 'BROKER SYSTEM' TO MPROGRAM

STORE .T. TO MONO

MPASSWORD = 'ADM99'
MUSER = 'SUPERVISOR'
MSECURITY = .T.

ON KEY LABEL PGUP CLEAR READ
ON KEY LABEL PGDN CLEAR READ

MTITLE = ' - RUN SPREADSHEET ERROR CHECK'
CLEAR
@  1, 0 SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 to 24,79
STORE ' ' TO MFRT_SEL, MSUP_SEL, MCUS_SEL, MCOM_SEL, MNET_SEL, MMISC_SEL
STORE 0 TO MTRAN_MO, MTRAN_YR
STORE 2 TO MACTION
DO WHILE MACTION = 2
   @ 18,5 SAY '       BUSINESS MONTH: ' GET MTRAN_MO PICTURE '##' RANGE 1,12
   @ 20,5 SAY '        BUSINESS YEAR: ' GET MTRAN_YR PICTURE '####' RANGE 1988,2099
   
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   @ 24,12 SAY '1. Continue      2. Edit     3. Cancel'
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
ENDDO
IF MACTION = 3
   QUIT 
ENDIF

@ 4,1 CLEAR TO 20,78
MPRT_ACT = 'C'
MPAGE_LEN = 56

MPAGE_NO = 0
MLINE = 99 

STORE subSTR(str(MTRAN_MO + 100,3),2) TO MTRAN_MO  
STORE STR(MTRAN_YR,4) TO MTRAN_YR
@ 18,5 SAY 'PROCESSING SPREADSHEET CHECKS,  PLEASE WAIT.....'
clear
mline = 1

SELECT A
USE DAILYJRN INDEX JRN_Mo
SEEK MTRAN_YR + MTRAN_MO 
DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO
   
   
   MTOT_PURCH = TOT_PURCH+SUP_PALL
   MTOT_SELL = TOT_SELL + CUS_PALL
   MFRT = FRT_AMT1 + FRT_PALL + FRT_AMT2 + FRT_AMT3
   MCOMM = COMM_AMT + COMM_AMT2 + COMM_AMT3 + SALE_COMM + SALE2_AMT              
   MMISC = MISC_AMT
   M1 = TOT_NET + SALE2_NET
   M2 = MTOT_SELL - MTOT_PURCH - MFRT - MCOMM - MMISC
   IF ROUND(M1,2) <> ROUND(M2,2)
      @ MLINE,2 SAY A->INV_NBR
      @ MLINE,13 SAY A->SALESMAN + '-'
      @ MLINE,16 SAY A->PO_NBR
      @ MLINE,20 SAY '-' + A->PO_SUFFIX
      @ mline,35 say str(recno(),6)
      IF INV_COR = 'I'
         @ MLINE,44 SAY 'INV'
      ELSE
         @ MLINE,44 SAY 'COR ENTRY: ' + SEQ
      ENDIF
      @ MLINE,58 SAY M1 PICTURE '999999.99'
      @ MLINE,69 SAY M2 PICTURE '999999.99'
      MLINE = MLINE + 1
       
   ENDIF
   SKIP
ENDDO   

IF MLINE <> 1 
ELSE
   @ MLINE,2 SAY 'THERE ARE NO DISCREPANCIES ON THE SPREADSHEET !'
ENDIF
wait ' '
CLOSE DATA
QUIT
*Formatted by: ToolBox Ver. 1.2  on 11/5/93 at 10:11 AM.
