**********
* Program.: NEW_COM.PRG
* Author..: Grace Keller
* Date....: 05/18/88
* Notice..: Copyright 1986, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PRINT MONTHLY COMMISSION STATEMENTS
*
MTITLE = ' - PRINT MONTHLY SALESPERSON COMMISSION STATEMENTS'
CLEAR
@  1, 0 SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 to 24,79
STORE CTOD(' ') TO MDATE
STORE 2 TO MACTION
DO WHILE MACTION = 2
   @ 7,5 say '(OPTIONAL) SALESPERSON CODE: ' GET MOPT_CODE                              
   @ 8,5 SAY '(If salesperson not selected, all reports will be printed)'
   @ 11,5 SAY 'ENTER STATEMENT MONTH ENDING DATE: ' GET MDATE
   
   STORE 1 TO MACTION
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2. Edit    3. Cancel'    
   READ   
   @ 24,9 GET MACTION PICTURE '9' RANGE 1,3
   READ
ENDDO
IF MACTION = 3
   RETURN
ENDIF
MACTION = ' '
DO PRT_SET

@ 15,5 say 'PROCESSING........ PLEASE WAIT'
STORE MONTH(MDATE) TO MMONTH
STORE YEAR(MDATE) TO MYEAR

STORE SUBSTR(STR(MMONTH+100,3),2) TO MTRAN_MO
STORE STR(MYEAR,4) TO MYEAR, MTRAN_YR

DO CASE
CASE MTRAN_MO = '01'
   STORE 'JANUARY' TO MMO_NAME
CASE MTRAN_MO = '02'
   STORE 'FEBRUARY' TO MMO_NAME
CASE MTRAN_MO = '03'
   STORE 'MARCH' TO MMO_NAME
CASE MTRAN_MO = '04'
   STORE 'APRIL' TO MMO_NAME
CASE MTRAN_MO = '05'
   STORE 'MAY' TO MMO_NAME
CASE MTRAN_MO = '06'
   STORE 'JUNE' TO MMO_NAME
CASE MTRAN_MO = '07'
   STORE 'JULY' TO MMO_NAME
CASE MTRAN_MO = '08'
   STORE 'AUGUST' TO MMO_NAME
CASE MTRAN_MO = '09'
   STORE 'SEPTEMBER' TO MMO_NAME
CASE MTRAN_MO = '10'
   STORE 'OCTOBER' TO MMO_NAME
CASE MTRAN_MO = '11'
   STORE 'NOVEMBER' TO MMO_NAME
CASE MTRAN_MO = '12'
   STORE 'DECEMBER' TO MMO_NAME
OTHERWISE
   STORE ' ' TO MMO_NAME
ENDCASE
SELECT A
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
DO WHILE .NOT. EOF()
   IF RPT_PRT = ' ' 
      SKIP
      LOOP
   ENDIF
   STORE SALE_CODE TO MSALE_CODE
   STORE 0 TO MNOTPOST&MSALE_CODE, MDEDUCT&MSALE_CODE, MPAID&MSALE_CODE                 
   STORE 0 TO MADVANCE&MSALE_CODE, MREPAID&MSALE_CODE
   SKIP
ENDDO

SELECT F
DO FOX_USE WITH "&MDBFLOC.RESERVE INDEX &MDBFLOC.RESERVE", .F.

SELECT D
DO FOX_USE WITH "&MMASTDBF.CONTROL", .F.
SELECT C
DO FOX_USE WITH "&MMASTDBF.COMLED INDEX &MMASTDBF.COMLED", .F.

SELECT B
DO FOX_USE WITH "DISBJRN INDEX DISBJRN", .F.

**** TOTAL UP ALL THE DISBURSEMENTS
*STORE 0 TO MPAID44, MDEDUCT44, MNOTPOST44 
*STORE 0 TO MPAID55, MDEDUCT55, MNOTPOST55 
*STORE 0 TO MPAID66, MDEDUCT66, MNOTPOST66 
*STORE 0 TO MPAID77, MDEDUCT77, MNOTPOST77 
*STORE 0 TO MPAID88, MDEDUCT88, MNOTPOST88 
*STORE 0 TO MPAID11, MDEDUCT11, MNOTPOST11 
SELECT B
SEEK MYEAR + MTRAN_MO
DO WHILE .NOT. EOF() .AND. JRNL_YR = MYEAR .AND. JRNL_MO = MTRAN_MO
   IF VOID_MAN = 'V'
      SKIP
      LOOP
   ENDIF
   DO CASE
   CASE CATEGORY1 = '7150'
      IF SUBSTR(ACCT_NBR,1,1) <> 'S'
         SKIP
         LOOP
      ENDIF
      STORE SUBSTR(ACCT_NBR,3) TO MACCT_NBR
      IF MACCT_NBR = '33'
         MACCT_NBR = '44'
      ENDIF
      MPAID&MACCT_NBR = MPAID&MACCT_NBR + AMOUNT1
      *  CASE CATEGORY1 = '7301'
      *     STORE SUBSTR(ACCT_NBR,3) TO MACCT_NBR
      *     IF MACCT_NBR = '33'
      *        MACCT_NBR = '44'
      *     ENDIF
      *     MADVANCE&MACCT_NBR = MADVANCE&MACCT_NBR + AMOUNT1
   CASE CATEGORY1 = '7350'
      STORE SUBSTR(ACCT_NBR,3) TO MACCT_NBR
      IF MACCT_NBR = '33'
         MACCT_NBR = '44'
      ENDIF
      MREPAID&MACCT_NBR = MREPAID&MACCT_NBR + AMOUNT1
   CASE VAL(CATEGORY1) >= 8401 .AND. VAL(CATEGORY1) <= 8424
      MDEDUCT&MACCT_NBR = MDEDUCT&MACCT_NBR + AMOUNT1
      
      *  CASE CATEGORY1 = '8401'
      *     MDEDUCT44 = MDEDUCT44 + AMOUNT1
      *  CASE CATEGORY1 = '8402'
      *     MDEDUCT55 = MDEDUCT55 + AMOUNT1
      *  CASE CATEGORY1 = '8403'
      *     MDEDUCT66 = MDEDUCT66 + AMOUNT1
      *  CASE CATEGORY1 = '8404'
      *     MDEDUCT77 = MDEDUCT77 + AMOUNT1
      *  CASE CATEGORY1 = '8420'
      *     MDEDUCT88 = MDEDUCT88 + AMOUNT1
   ENDCASE
   SKIP
ENDDO
USE

SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

SELECT A
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
DO WHILE .NOT. EOF()
   IF MOPT_CODE <> '  '
      IF SALE_CODE <> MOPT_CODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   STORE SALE_CODE TO MCOM_CODE  
   IF RPT_PRT = ' '
      *  IF MCOM_CODE <> '44' .AND. MCOM_CODE <> '55' .AND. MCOM_CODE <> '66' .AND. MCOM_CODE <> '77' .AND. MCOM_CODE <> '88'
      SKIP
      LOOP
   ENDIF
   STORE NAME TO MSAL_NAME
   MSOMETHING = .F.
   SELECT C
   STORE 0 TO MPREV_BAL, MEARNINGS
   SEEK MTRAN_YR + MTRAN_MO + 'S' + MCOM_CODE
   DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO .AND. COM_TYPE = 'S' .AND. COM_CODE = MCOM_CODE
      MSOMETHING = .T.
      IF DTOC(TRAN_DATE) = '  /  /  '  .AND. CK_NBR = SPACE(6)
         STORE AMOUNT TO MPREV_BAL
         SKIP
         LOOP
      ENDIF
      IF CK_NBR = SPACE(6)
         MEARNINGS = MEARNINGS + AMOUNT
      ENDIF
      SKIP
   ENDDO
   **** NOW PRINT THIS OUT
   IF MSOMETHING
      @ 06,30 SAY 'MIDWEST FOOD & POULTRY, INC.'
      @ 08,26 SAY 'COMMISSION STATEMENT AS OF ' + DTOC(MDATE)
      @ 11,35 SAY MSAL_NAME
      
      @ 16,5 SAY 'BALANCE from Last Statement:'
      @ 16,64 say '$'
      @ 16,66 say MPREV_BAL PICTURE '999,999.99'
      @ 16,64 say '_____________'
      
      @ 19,5 SAY 'EARNINGS during ' + MMO_NAME + ':'
      @ 19,43 say '$'
      @ 19,45 say mearnings picture '999,999.99'
      @ 19,43 say '_____________'
      
      @ 23,5 SAY 'GROSS Commissions Paid in ' + mmo_name + ':'
      @ 23,64 say '$' 
      @ 23,66 say MPAID&MCOM_CODE PICTURE '999,999.99'
      @ 23,64 SAY '_____________'
      
      @ 25,5 SAY 'BAD DEBT Reserve Withheld: '
      @ 25,43 say '$'
      @ 25,45 say (mdeduct&MCOM_CODE * -1) picture '999,999.99'
      @ 25,43 say '_____________'
      
      @ 27,5 say 'NET Commissions Paid:'
      @ 27,43 SAY '$'
      @ 27,45 SAY MPAID&MCOM_CODE + mdeduct&MCOM_CODE PICTURE '999,999.99'
      @ 27,43 SAY '_____________'
      SELECT F
      SUM AMOUNT TO MAMOUNT FOR MCOM_CODE = SALESMAN .AND. TRAN_MO = MTRAN_MO .AND. CATEGORY = '7301'                     
      *     IF MADVANCE&MCOM_CODE <> 0
      IF MAMOUNT <> 0
         @ 29,5 say '       ADVANCES Paid:'
         @ 29,43 SAY '$'
         @ 29,45 SAY MAMOUNT PICTURE '999,999.99'
         @ 29,43 SAY '_____________'
      ENDIF
      IF MREPAID&MCOM_CODE <> 0
         @ 31,5 say '   ADVANCES Withheld:'
         @ 31,43 SAY '$'
         @ 31,45 SAY MREPAID&MCOM_CODE PICTURE '999,999.99'
         @ 31,43 SAY '_____________'
      ENDIF
      @ 33,5 say 'BALANCE:'
      MBALANCE = MPREV_BAL + MEARNINGS - MPAID&MCOM_CODE - MADVANCE&MCOM_CODE - MREPAID&MCOM_CODE
      @ 33,64 SAY '$'
      @ 33,66 SAY MBALANCE PICTURE '999,999.99'
      @ 33,64 SAY '_____________'
      @ 36,5 SAY 'BAD DEBT Reserve Account TOTAL:'
      SELECT F
      SUM AMOUNT TO MAMOUNT FOR MCOM_CODE = SALESMAN .AND. TRAN_DATE <= MDATE .AND. ACT_CODE <> ' ' .AND. ACT_CODE <> 'W'
      SUM AMOUNT TO MWITH FOR MCOM_CODE = SALESMAN .AND. TRAN_DATE <= MDATE .AND. ACT_CODE = 'W'
      MAMOUNT = MAMOUNT - MWITH 
      @ 36,64 SAY '$'
      @ 36,66 SAY MAMOUNT PICTURE '999,999.99'
      @ 36,64 SAY '_____________'
      
      EJECT
   ENDIF
   SELECT A
   SKIP
ENDDO
SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

CLOSE DATA

* EOF: NEW_COM.PRG
*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 1:22 PM.
