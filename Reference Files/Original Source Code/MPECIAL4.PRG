************
* Program.: SPECIAL4.PRG
* Author..: GRACE KELLER
* Date....: 
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: REPORT SPECIAL4
*
* ---SET environment.
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     

CLEAR
@ 00,00 SAY MCOMPANY
@ 01,68 SAY DATE()
@ 01,00 SAY MPROGRAM + ' - REPORT SPECIAL4 - PRODUCT LISTING'
@ 2,0 to 24,79

@ 4,1 CLEAR TO 22,78
@ 24,0 CLEAR
SELECT C
USE TEMPPROD EXCLUSIVE
DELETE ALL
PACK
INDEX ON STR(YEAR(SHIP_DATE),4)+SUBSTR(DTOC(SHIP_DATE),1,2)+SUBSTR(DTOC(SHIP_DATE),4,2)+SALESMAN+PO_NBR+PO_SUFFIX TO TEMPPROD
DO FILELOCK
STORE ' ' TO MCHOICE
**** GET FIRST AND LAST DATES FOR THIS REPORT
STORE CTOD(' ') TO MSTART, MLAST
STORE 'P' TO MDISP_PRT
STORE SPACE(10) TO MPROD
STORE ' ' TO MCHOICE1, MCHOICE2, MCHOICE3, MCHOICE4
STORE SPACE(2) TO MTRAN_MO
STORE SPACE(4) TO MTRAN_YR
STORE CTOD('') TO MBEGIN, MEND
STORE 'D' TO MTOT_DET
STORE 2 TO MACTION
STORE ' ' TO MCUS_TYPE

DO WHILE MACTION = 2
   @ 03,5 SAY 'Totals by Product for: ' 
   @ 5,2 say 'Begin Ship Date: ' get mbegin
   @ 7,2 say 'End   Ship Date: ' get mend
   @ 9,2 say 'Select Order going to Customers (C) or Inventory (I) or Both(B):'
   @ 9,67 GET MCUS_TYPE PICTURE '@!'
   @ 13,1 SAY 'PRODUCT CODE: ' get mprod picture '@!'
   @ 14,1 say '(Optional - Leave product blank if report for all products.)'
   @ 17,1 SAY 'Optionally select specific Suppliers - select with an "X"'
   @ 18,2 SAY 'Remit to     Supplier:'
   @ 19,2 SAY 'Shipped from Supplier:'
   @ 18,25 GET MCHOICE1 PICTURE '@!'
   @ 19,25 GET MCHOICE2 PICTURE '@!'
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'                     
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
ENDDO
IF MACTION = 3
   RETURN
ENDIF  
STORE SPACE(4) TO MBBUYCODE, MRSUPCODE, MBUY_CODE, MSUP_CODE

IF MCHOICE1 = 'X'
   CLEAR
   MWAIT = ' '
   @ 5,1 SAY 'PRESS ENTER TO SELECT REMIT TO SUPPLIER' GET MWAIT
   READ
   MNAME_FD = .F.
   DO RSUPSEL3
   IF .NOT. MNAME_FD
      MCHOICE1 = ' '
   ELSE
      STORE RSUPCODE TO MRSUPCODE
      STORE NAME TO MREM_NAME
      STORE CITY TO MREM_CITY
      STORE STATE TO MREM_STATE
   ENDIF
ENDIF

IF MCHOICE2 = 'X'
   CLEAR
   MWAIT = ' '
   @ 5,1 SAY 'PRESS ENTER TO SELECT SHIPPED FROM SUPPLIER' GET MWAIT
   READ
   MNAME_FD = .F.
   SET PROC TO SUP_PROC
   DO SUP_SEL1
   IF MNAME_FD 
      STORE SUP_CODE TO MSUP_CODE
      STORE NAME TO MSUP_NAME
      STORE CITY TO MSUP_CITY
      STORE STATE TO MSUP_STATE
   ELSE
      STORE ' ' TO MCHOICE2
   ENDIF
   SET PROC TO
   USE
ENDIF

IF MRSUPCODE = SPACE(4) .AND. MSUP_CODE = SPACE(4)
   MNAME = 'NO SUPPLIER SELECTED'
   MCITY = SPACE(20)
   MSTATE = SPACE(2)
ENDIF
IF MCUS_TYPE <> 'C' .AND. MCUS_TYPE <> 'I' .AND. MCUS_TYPE <> 'B'
   MCUS_TYPE = 'C'
ENDIF

@ 4,1 CLEAR TO 22,78
@ 24,0 CLEAR

MTITLE = ' - PRODUCT LISTING'
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 to 25,79

SELECT C
DO FILELOCK

*** REPORT IS TOTALED BY SUPPLIER/BY PRODUCT
MPRT_ACT = 'C'

IF MDISP_PRT = 'P'
   DO PRT_SET
   
   IF MPRT_ACT <> 'C'
      RETURN
   ENDIF
   MPAGE_LEN = 56
ELSE
   MPAGE_LEN = 20
ENDIF

SELECT A 
DO FOX_USE WITH "PO_HEAD INDEX PO_SHIP", .F.
SELECT B
DO FOX_USE WITH "PO_DTL INDEX  PO_DTL", .F.
SELECT E
DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_CODE", .F.

MSUB = 0
STORE SUBSTR(DTOC(MBEGIN),7) TO MTRAN_YR
STORE SUBSTR(DTOC(MBEGIN),1,2) TO MTRAN_MO
SELECT A
SEEK MTRAN_YR + MTRAN_MO
DO WHILE .NOT. EOF() .AND. SHIP_DATE < MBEGIN    
   SKIP
ENDDO

MPAGE_NO = 0
MLINE = 99 
@ 19,16 SAY 'PROCESSING........'
IF MDISP_PRT = 'P'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

ENDIF

DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MEND   
   IF MRSUPCODE <> SPACE(4)
      IF RSUPCODE <> MRSUPCODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   IF MSUP_CODE <> SPACE(4)
      IF SUP_CODE <> MSUP_CODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   IF MBBUYCODE <> SPACE(4)
      IF BBUYCODE <> MBBUYCODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   IF MBUY_CODE <> SPACE(4)
      IF BUY_CODE <> MBUY_CODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   
   *IF RSUPCODE = 'INVN' .AND. BBUYCODE = 'INVN'
   *   SKIP
   *   LOOP
   *ENDIF
   
   DO CASE
   CASE MCUS_TYPE = 'B'
   CASE MCUS_TYPE = 'C'
      IF BBUYCODE = 'INVN'
         SKIP
         LOOP
      ENDIF
   OTHERWISE
      IF BBUYCODE <> 'INVN'
         SKIP
         LOOP
      ENDIF
   ENDCASE
   
   
   IF TOT_SELL = 0 .AND. TOT_PURCH = 0
      SKIP
      LOOP
   ENDIF
   
   IF BBUYCODE = 'NONE'
      SKIP
      LOOP
   ENDIF
   
   SELECT E
   SEEK A->BUY_CODE
   STORE NAME TO MCUST_NAME
   
   SELECT B
   SEEK A->SALESMAN + A->PO_NBR + A->PO_SUFFIX
   DO WHILE .NOT. EOF() .AND. SALESMAN = A->SALESMAN .AND. PO_NBR = A->PO_NBR .AND. PO_SUFFIX = A->PO_SUFFIX
      IF PROD_DESC = SPACE(4)
         SKIP
         LOOP
      ENDIF
      IF MPROD <> SPACE(10)
         IF MPROD <> PROD_DESC
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      SELECT C
      APPEND BLANK
      REPLACE BBUYCODE  WITH A->BBUYCODE
      REPLACE BUYER_PO  WITH A->BUYER_PO
      REPLACE PROD_DESC WITH B->PROD_DESC
      REPLACE SALESMAN WITH B->SALESMAN
      REPLACE PO_NBR   WITH B->PO_NBR
      REPLACE PO_SUFFIX WITH B->PO_SUFFIX
      REPLACE LBS_SOLD WITH B->QTY
      REPLACE INV_PRI WITH B->PUR_PRICE
      REPLACE TOT_SELL WITH B->TOT_PURCH
      REPLACE SHIP_DATE WITH A->SHIP_DATE
      REPLACE CUST_NAME WITH MCUST_NAME
      REPLACE PACKED    WITH B->PACKED
      SELECT B
      SKIP
   ENDDO
   SELECT A
   SKIP
ENDDO
SELECT A
USE
SELECT B
USE

MFIRST = .T.
MTOT_SELL = 0
MTOT_LBS  = 0
MTOT_QTY  = 0
SELECT C
GOTO TOP
DO WHILE .NOT. EOF()
   STORE SALESMAN TO MSALESMAN   
   STORE PO_NBR TO MPO_NBR
   STORE PO_SUFFIX TO MPO_SUFFIX
   STORE SHIP_DATE TO MSHIP_DATE
   MPRT_PO = .T.
   DO WHILE .NOT. EOF() .AND. SHIP_DATE = MSHIP_DATE .AND. PO_NBR = MPO_NBR .AND. SALESMAN = MSALESMAN .AND. PO_SUFFIX = MPO_SUFFIX
      
      IF MLINE > MPAGE_LEN
         IF MDISP_PRT = 'D'
            IF MLINE = 99
               CLEAR
            ELSE
               MCONT = 'C'
               @ 24,1 SAY "PRESS 'ENTER' TO CONTINUE OR 'A' TO CANCEL REPORT " GET MCONT PICTURE '@!'
               READ
               IF MCONT = 'A'
                  SELECT C
                  GOTO BOTTOM
                  SKIP
                  LOOP
               ELSE
                  CLEAR
               ENDIF
            ENDIF
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 1,25 SAY MCOMPANY + ' - Report: Spec4'
         @ 1,1 SAY 'Page'
         @ 1,06 say mpage_no picture '99'
         @ 1,58 SAY DTOC(DATE())
         @ 2,16 SAY '         PRODUCT TOTALS FOR ' + DTOC(MBEGIN) + ' - ' + DTOC(MEND)
         MLINE = 3
         IF MRSUPCODE <> SPACE(4)
            @ MLINE,16 SAY '  REMIT TO   SUPPLIER: ' + MREM_NAME
            MLINE = MLINE + 1
         ENDIF
         IF MSUP_CODE <> SPACE(4)
            @ MLINE,16 SAY 'SHIPPED FROM SUPPLIER: ' + MSUP_NAME
            MLINE = MLINE + 1
         ENDIF
         
         IF MBBUYCODE <> SPACE(4)
            @ MLINE,16 SAY '     BILL TO CUSTOMER: ' + MBIL_NAME
            MLINE = MLINE + 1
         ENDIF
         IF MBUY_CODE <> SPACE(4)
            @ MLINE,16 SAY '     SHIP TO CUSTOMER: ' + MBUY_NAME
            MLINE = MLINE + 1
         ENDIF
         MLINE = MLINE + 2
         @ MLINE,1 SAY 'PO NBR      SHIP DATE          CUST PO#             CUSTOMER'
         MLINE = MLINE + 1        
         @ MLINE,1 SAY 'PRODUCT           QTY       POUNDS      PRICE         AMOUNT'
         **             XX-XXXX-X  XX/XX/XXXX   XXXXXXXXXXXX            
         **             XXXX           XXXXXX    XX,XXX,XXX   XX.XXXX       XXXXX.XX
         ***            1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
         ***                    10        20        30        40        50        60        70        80        90         
         IF MDISP_PRT = 'P'
            @ MLINE,01 SAY REPLICATE('_',60)
         ENDIF
         MLINE = MLINE + 2
      ENDIF
      IF MPRT_PO
         @ MLINE,1 SAY SALESMAN + '-' + PO_NBR
         IF PO_SUFFIX <> ' '
            @ MLINE,8 SAY '-' + PO_SUFFIX
         ENDIF
         @ MLINE,12 SAY SHIP_DATE
         STORE TRIM(BUYER_PO) TO MBUYER_PO
         STORE LEN(MBUYER_PO) TO MLEN
         **@ MLINE,37-MLEN SAY MBUYER_PO
         @ MLINE,32 SAY BUYER_PO
         @ MLINE,53 SAY CUST_NAME
         MLINE = MLINE + 1
         MPRT_PO = .F.
      ENDIF
      
      @ MLINE,1 SAY PROD_DESC
      @ MLINE,16 SAY LBS_SOLD PICTURE '999999'
      IF SUBSTR(PACKED,1,1) = 'B'
         MCALC_LBS = ROUND(VAL(SUBSTR(PACKED,2)) * LBS_SOLD,4)
      ELSE
         MCALC_LBS = LBS_SOLD
      ENDIF
      @ MLINE,26 SAY MCALC_LBS PICTURE '99,999,999'
      @ MLINE,39 SAY INV_PRI  PICTURE '99.9999'
      @ MLINE,53 SAY TOT_SELL PICTURE '99999.99'
      MTOT_SELL = MTOT_SELL + TOT_SELL
      MTOT_LBS  = MTOT_LBS + MCALC_LBS
      MTOT_QTY  = MTOT_QTY + LBS_SOLD
      MLINE = MLINE + 1
      SKIP
   ENDDO
   MLINE = MLINE + 1
ENDDO

IF MDISP_PRT = 'P'
   MLINE = MLINE + 1
   **@ mline+1,1 say ' '
   @ MLINE,1 SAY 'TOTAL:'
   @ MLINE,16 SAY MTOT_QTY PICTURE '999999'
   @ MLINE,26 SAY MTOT_LBS PICTURE '99,999,999'
   @ MLINE,53 SAY MTOT_SELL PICTURE '9999999.99'
   @ mline+1,1 say ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
ELSE
   @ 23,0 CLEAR
   @ 23,1 SAY 'TOTAL:'
   @ 23,16 SAY MTOT_QTY PICTURE '999999'
   @ 23,26 SAY MTOT_LBS PICTURE '99,999,999'
   @ 23,53 SAY MTOT_SELL PICTURE '9999999.99'
   MPRT_SEL = ' '
   @ 24,00 SAY 'End Of Report - Press Return to Continue ' GET MPRT_SEL
   READ
ENDIF

CLOSE DATA
RETURN  

*Formatted by: ToolBox Ver. 1.2  on 7/23/14 at 2:55 PM.
