**********
* Program.: PO_SHORT.PRG
* Author..: Grace Keller
* Date....: 11/03/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PURCHASE ORDER SHORTWEIGHTS
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
RELEASE MQTY
RELEASE MFR_FZ
RELEASE MGRADE
RELEASE MPAK  
RELEASE MCLASS
RELEASE MPROD
RELEASE MSIZE
RELEASE MPACKSPEC
RELEASE MLBS
RELEASE MPURC_PRI
RELEASE MSELL_PRI
RELEASE MPURC_TOT
RELEASE MSELL_TOT
RELEASE MSHRT_BOX
RELEASE MSHRT_LBS
RELEASE MBILL_PRI
RELEASE MPAK1  
RELEASE MPAK2  
RELEASE MBOX_SZ
RELEASE MOLD_LOT
RELEASE MOLD_LBS
RELEASE MOLD_QTY
RELEASE MOLD_PROD
RELEASE MIN_LOT
RELEASE MOUT_LOT
RELEASE MOLD_IN
RELEASE MOLD_OUT
RELEASE MSTOR_ITEM
RELEASE MPAK_YR
RELEASE MPAK_DAY
RELEASE Mout_YR
RELEASE Mout_DAY

DIMENSION MQTY(7)
DIMENSION MFR_FZ(7)
DIMENSION MGRADE(7)
DIMENSION MPAK(7)  
DIMENSION MCLASS(7)
DIMENSION MPROD(7)
DIMENSION MSIZE(7)
DIMENSION MPACKSPEC(7)
DIMENSION MLBS(7)
DIMENSION MPURC_PRI(7)
DIMENSION MSELL_PRI(7)
DIMENSION MPURC_TOT(7)
DIMENSION MSELL_TOT(7)
DIMENSION MSHRT_BOX(7)
DIMENSION MSHRT_LBS(7)
DIMENSION MBILL_PRI(7)
DIMENSION MPAK1(7)  
DIMENSION MPAK2(7)  
DIMENSION MBOX_SZ(7)
DIMENSION MOLD_LOT(7)
DIMENSION MOLD_LBS(7)
DIMENSION MOLD_QTY(7)
DIMENSION MOLD_PROD(7)
DIMENSION MIN_LOT(7)
DIMENSION MOUT_LOT(7)
DIMENSION MOLD_IN(7)
DIMENSION MOLD_OUT(7)
DIMENSION MSTOR_ITEM(7)
DIMENSION MPAK_YR(7)
DIMENSION MPAK_DAY(7)
DIMENSION Mout_YR(7)
DIMENSION Mout_DAY(7)

SELECT B
SET PROC TO PO_PROC
DO STORHEAD
STORE SUP_CODE TO MSUP_CODE
STORE BUY_CODE TO MBUY_CODE
STORE SALESMAN TO MSALESMAN
STORE RSUPCODE TO SRSUPCODE
STORE BBUYCODE TO SBBUYCODE
STORE FRT_CODE1 TO SFRT_CODE1
DO HEAD_TOT
DO SAVE_TOT
STORE MTOT_SELL TO MSAV_SELL
STORE MTOT_PURCH TO MSAV_PURCH
STORE MTOT_LBS TO MSAV_LBS
MCHG_ITM = .F.
MADD_ITM = .F.
SELECT C
SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
IF .NOT. EOF()
   STORE RECNO() TO MRECNO, MFST_REC
ELSE 
   STORE 0 TO MRECNO, MFST_REC
ENDIF

MMORE_ITM = .T.  
MPAGE = 1
@ 02,55 SAY 'INV NBR: ' + MINV_NBR

@ 3,0 CLEAR
IF MSALESMAN <> '  '
   MSAY_PO = MSALESMAN + '-' + MPO_NBR
ELSE
   MSAY_PO = MPO_NBR
ENDIF
IF MPO_SUFFIX <> ' '
   MSAY_PO = MSAY_PO + '-' + MPO_SUFFIX
ENDIF
MTITLE = ' - DISPLAY SHORTWEIGHTS FOR PO NBR ' + MSAY_PO
DO TEXT2ND

DO WHILE MMORE_ITM
   MMAX_ITM = 0
   MNBR_ITM = 1
   SELECT C
   IF .NOT. EOF()
      GOTO MRECNO
   ENDIF
   DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX .AND. VAL(ITEM_NBR) <= (MPAGE * 15)    
      DO STORITM
      IF SHORT_FLG = 'Y'
         STORE 'S' TO MFLAG(MNBR_ITM)
      ELSE
         STORE ' ' TO MFLAG(MNBR_ITM)
      ENDIF
      MMAX_ITM = MMAX_ITM + 1
      MNBR_ITM = MNBR_ITM + 1
      SKIP
   ENDDO
   STORE RECNO() TO MRECNO
   IF .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
      MBLURP = .T.
   ELSE
      MBLURP = .F.
   ENDIF
   @ 3,71 SAY 'PAGE:'
   @ 3,77 SAY STR(MPAGE,2)
   MLINE = 08 
   MNBR_ITM = 1
   DO WHILE MNBR_ITM <= MMAX_ITM
      DO SAYITM 
      @ MLINE,0 SAY MFLAG(MNBR_ITM)
      MLINE = MLINE + 1
      MNBR_ITM = MNBR_ITM + 1
   ENDDO
   IF MBLURP
      @ 23,67 SAY 'More Items...'
   ELSE
      @ 23,67 TO 23,79
   ENDIF
   
   MLINE = 08 
   MNBR_ITM = 1
   
   MNEXT_ITM = .T.
   DO WHILE MLINE <= 22 .AND. MNBR_ITM <= MMAX_ITM
      *     STORE ' ' TO MPICK
      @ MLINE,0 GET MFLAG(MNBR_ITM) PICTURE '@!'
      READ
      STORE MFLAG(MNBR_ITM) TO MPICK
      IF MPICK = 'X'
         **** I IS THE ITEM NUMBER
         **** X IS THE SUBSCRIPT NUMBER
         I = ((MPAGE - 1) * 15) + (MLINE - 7)
         X = MLINE - 7
         SAVE SCREEN TO MSHRT_SCRN
         @ 8,0 CLEAR TO 22,79
         @ 24,0 CLEAR
         STORE 1 TO MACTION
         @ 24,0 SAY 'Action: ' + STR(MACTION,1)
         @ 24,12 SAY '1. Continue'
         
         @ 9,2 SAY MQTY(MNBR_ITM) PICTURE '9999'
         @ 9,7 SAY MFR_FZ(MNBR_ITM) PICTURE '@!'
         @ 9,10 SAY MGRADE(MNBR_ITM) PICTURE '@!'
         @ 9,12 SAY MPAK(MNBR_ITM) PICTURE '@!'
         @ 9,15 SAY MPROD(MNBR_ITM) PICTURE '@!'
         @ 9,26 SAY MSIZE(MNBR_ITM) PICTURE '@!'
         @ 9,32 SAY MPACKSPEC(MNBR_ITM) PICTURE '@!'
         @ 9,37 SAY MLBS(MNBR_ITM) PICTURE '999999.99'
         @ 9,48 SAY MPURC_PRI(MNBR_ITM) PICTURE '9.9999'
         @ 9,56 SAY MSELL_PRI(MNBR_ITM) PICTURE '9.9999'
         @ 9,63 SAY MPURC_TOT(MNBR_ITM) PICTURE '99999.99'
         @ 9,72 SAY MSELL_TOT(MNBR_ITM) PICTURE '99999.99'
         @ 10,0 TO 10,79
         @ 12,02 SAY 'SHORT LBS/BOX'
         @ 12,22 SAY 'TOTAL SHORT LBS'
         @ 12,42 SAY 'SHORT PURCHASE'    
         @ 12,61 SAY 'SHORT SELLING'
         STORE MSHRT_BOX(MNBR_ITM) TO MLBS_BOX
         STORE MSHRT_LBS(MNBR_ITM) TO MSW_LBS
         *** MPURCH_DIF = MSW_LBS * MPURC_PRI(MNBR_ITM)
         *** MPURCH_DIF = ROUND(MPURCH_DIF,2)
         *** MSELL_DIF = MSW_LBS * MSELL_PRI(MNBR_ITM)
         *** MSELL_DIF = ROUND(MSELL_DIF,2)
         MVAL1 = MSW_LBS * MPURC_PRI(MNBR_ITM) 
         IF MVAL1 <> 0
            MVAL = INT(MVAL1*100)
            IF (ABS(MVAL1) * 100) - ABS(MVAL) > .49
               IF MVAL1 >= 0
                  MVAL1 = (MVAL + 1) / 100
               ELSE
                  MVAL1 = (MVAL - 1) / 100
               ENDIF
            ELSE
               MVAL1 = MVAL / 100
            ENDIF
         ENDIF
         
         MPURCH_DIF = MVAL1
         
         MVAL1 = MSW_LBS * MSELL_PRI(MNBR_ITM) 
         
         IF MVAL1 <> 0
            MVAL = INT(MVAL1*100)
            IF (ABS(MVAL1) * 100) - ABS(MVAL) > .49
               IF MVAL1 >= 0
                  MVAL1 = (MVAL + 1) / 100
               ELSE
                  MVAL1 = (MVAL - 1) / 100
               ENDIF
            ELSE
               MVAL1 = MVAL / 100
            ENDIF
         ENDIF
         
         MSELL_DIF = MVAL1
         
         @ 13,05 SAY MLBS_BOX PICTURE '99999.99'
         @ 13,25 SAY MSW_LBS PICTURE '99999.99'
         @ 13,44 SAY MPURCH_DIF PICTURE '99,999.99'
         @ 13,62 SAY MSELL_DIF PICTURE '99,999.99'
         @ 24,8 GET MACTION PICTURE '#' RANGE 1,1
         READ
         RESTORE SCREEN FROM MSHRT_SCRN
      ENDIF
      MLINE = MLINE + 1
      MNBR_ITM = MNBR_ITM + 1
      
   ENDDO
   
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   IF MBLURP
      @ 24,12 SAY '1. Next Itm Pg.     2. Edit     3. Finished'
   ELSE
      @ 24,12 SAY '1. Finished     2. Edit'
   ENDIF
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
   IF MBLURP
      DO CASE
      CASE MACTION = 1
         @ 8,0 CLEAR TO 22,79 
         MPAGE = MPAGE + 1
         LOOP      
      CASE MACTION = 2
         MNBR_ITM = 1
         STORE MFST_REC TO MRECNO
         LOOP
      CASE MACTION = 3
         IF .NOT. MGO_BACK
            DO FRT_VIEW
         ENDIF
         MMORE_ITM = .F.
      ENDCASE
   ELSE
      DO CASE      
      CASE MACTION = 1
         MLAST_PG = .T.
         IF .NOT. MGO_BACK
            DO FRT_VIEW
         ENDIF
         MMORE_ITM = .F.
      CASE MACTION = 2
         STORE MFST_REC TO MRECNO
         MNBR_ITM = 1
         LOOP        
      ENDCASE 
   ENDIF
ENDDO 

RETURN
* EOF: SW_VIEW.PRG
*Formatted by: ToolBox Ver. 1.2  on 12/13/94 at 10:50 AM.
