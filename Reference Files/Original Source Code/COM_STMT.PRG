**********
* Program.: COM_STMT.PRG
* Author..: Grace Keller
* Date....: 05/18/88
* Notice..: Copyright 1986, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PRINT MONTHLY COMMISSION STATEMENTS
*
MTITLE = ' - PRINT MONTHLY SALESPERSON COMMISSION STATEMENTS'
CLEAR
@  1, 0 SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 to 24,79
STORE CTOD(' ') TO MDATE
STORE 2 TO MACTION
DO WHILE MACTION = 2
   @ 10,5 SAY 'ENTER STATEMENT MONTH ENDING DATE: ' GET MDATE
   
   STORE 1 TO MACTION
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2. Edit    3. Cancel'    
   READ   
   @ 24,9 GET MACTION PICTURE '9' RANGE 1,3
   READ
ENDDO
IF MACTION = 3
   RETURN
ENDIF
MACTION = ' '
DO PRT_SET

@ 15,5 say 'PROCESSING........ PLEASE WAIT'
STORE MONTH(MDATE) TO MMONTH
STORE YEAR(MDATE) TO MYEAR

MNEXT_MO = MMONTH + 1
IF MNEXT_MO = 13
   MNEXT_MO = 1
   MNEXT_YEAR = MNEXT_YEAR + 1
ELSE
   STORE MYEAR TO MNEXT_YEAR
ENDIF
STORE SUBSTR(STR(MMONTH+100,3),2) TO MTRAN_MO
STORE STR(MYEAR,4) TO MYEAR
STORE SUBSTR(STR(MNEXT_MO+100,3),2) TO MNEXT_MO 
STORE STR(MNEXT_YEAR,4) TO MNEXT_YEAR

DO CASE
CASE MTRAN_MO = '01'
   STORE 'JANUARY' TO MMO_NAME
CASE MTRAN_MO = '02'
   STORE 'FEBRUARY' TO MMO_NAME
CASE MTRAN_MO = '03'
   STORE 'MARCH' TO MMO_NAME
CASE MTRAN_MO = '04'
   STORE 'APRIL' TO MMO_NAME
CASE MTRAN_MO = '05'
   STORE 'MAY' TO MMO_NAME
CASE MTRAN_MO = '06'
   STORE 'JUNE' TO MMO_NAME
CASE MTRAN_MO = '07'
   STORE 'JULY' TO MMO_NAME
CASE MTRAN_MO = '08'
   STORE 'AUGUST' TO MMO_NAME
CASE MTRAN_MO = '09'
   STORE 'SEPTEMBER' TO MMO_NAME
CASE MTRAN_MO = '10'
   STORE 'OCTOBER' TO MMO_NAME
CASE MTRAN_MO = '11'
   STORE 'NOVEMBER' TO MMO_NAME
CASE MTRAN_MO = '12'
   STORE 'DECEMBER' TO MMO_NAME
OTHERWISE
   STORE ' ' TO MMO_NAME
ENDCASE
SELECT A
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
DO WHILE .NOT. EOF()
   IF RPT_PRT = ' ' 
      SKIP
      LOOP
   ENDIF
   STORE SALE_CODE TO MSALE_CODE
   STORE 0 TO MNOTPOST&MSALE_CODE, MDEDUCT&MSALE_CODE, MPAID&MSALE_CODE
   SKIP
ENDDO

SELECT F
DO FOX_USE WITH "&MDBFLOC.RESERVE INDEX &MDBFLOC.RESERVE", .F.

SELECT D
DO FOX_USE WITH "&MMASTDBF.CONTROL", .F.
SELECT C
DO FOX_USE WITH "&MMASTDBF.COMLED INDEX &MMASTDBF.COMLED", .F.

SELECT B
DO FOX_USE WITH "DISBJRN INDEX DISBJRN", .F.

**** TOTAL UP ALL THE DISBURSEMENTS
*STORE 0 TO MPAID44, MDEDUCT44, MNOTPOST44 
*STORE 0 TO MPAID55, MDEDUCT55, MNOTPOST55 
*STORE 0 TO MPAID66, MDEDUCT66, MNOTPOST66 
*STORE 0 TO MPAID77, MDEDUCT77, MNOTPOST77 
*STORE 0 TO MPAID88, MDEDUCT88, MNOTPOST88 
*STORE 0 TO MPAID11, MDEDUCT11, MNOTPOST11 
STORE MTRAN_MO + '/' + '15' + '/' + MYEAR TO MFST_DATE
STORE MNEXT_MO + '/' + '15' + '/' + MNEXT_YEAR TO MEND_DATE
STORE CTOD(MFST_DATE) TO MFST_DATE
STORE CTOD(MEND_DATE) TO MEND_DATE
SELECT B
SEEK MYEAR + MTRAN_MO
*DO WHILE .NOT. EOF() .AND. JRNL_YR = MYEAR .AND. JRNL_MO = MTRAN_MO
DO WHILE .NOT. EOF()
   IF VOID_MAN = 'V'
      SKIP
      LOOP
   ENDIF
   STORE JRNL_MO + '/' + JRNL_DAY + '/' + JRNL_YR TO MJRNL_DATE
   STORE CTOD(MJRNL_DATE) TO MJRNL_DATE
   IF MJRNL_DATE <= MFST_DATE .OR. MJRNL_DATE > MEND_DATE
      SKIP
      LOOP
   ENDIF
   DO CASE
   CASE CATEGORY1 = '7150'
      IF SUBSTR(ACCT_NBR,1,1) <> 'S'
         SKIP
         LOOP
      ENDIF
      STORE SUBSTR(ACCT_NBR,3) TO MACCT_NBR
      IF MACCT_NBR = '33'
         MACCT_NBR = '44'
      ENDIF
      MPAID&MACCT_NBR = MPAID&MACCT_NBR + AMOUNT1
   CASE VAL(CATEGORY1) >= 8401 .AND. VAL(CATEGORY1) <= 8424
      MDEDUCT&MACCT_NBR = MDEDUCT&MACCT_NBR + AMOUNT1
      IF POST_FLG = ' '
         MNOTPOST&MACCT_NBR = MNOTPOST&MACCT_NBR + AMOUNT1
      ENDIF
   ENDCASE
   *  CASE CATEGORY1 = '8401'
   *     MDEDUCT44 = MDEDUCT44 + AMOUNT1
   *     IF POST_FLG = ' '
   *        MNOTPOST44 = MNOTPOST44 + AMOUNT1
   *     ENDIF
   *  CASE CATEGORY1 = '8402'
   *     MDEDUCT55 = MDEDUCT55 + AMOUNT1
   *     IF POST_FLG = ' '
   *        MNOTPOST55 = MNOTPOST55 + AMOUNT1
   *     ENDIF
   *  CASE CATEGORY1 = '8403'
   *     MDEDUCT66 = MDEDUCT66 + AMOUNT1
   *     IF POST_FLG = ' '
   *        MNOTPOST66 = MNOTPOST66 + AMOUNT1
   *     ENDIF
   *  CASE CATEGORY1 = '8404'
   *     MDEDUCT77 = MDEDUCT77 + AMOUNT1
   *     IF POST_FLG = ' '
   *        MNOTPOST77 = MNOTPOST77 + AMOUNT1
   *     ENDIF
   *  CASE CATEGORY1 = '8420'
   *     MDEDUCT88 = MDEDUCT88 + AMOUNT1
   *     IF POST_FLG = ' '
   *        MNOTPOST88 = MNOTPOST88 + AMOUNT1
   *     ENDIF
   *  ENDCASE
   SKIP
ENDDO
USE

SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

SELECT A
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
DO WHILE .NOT. EOF()
   STORE SALE_CODE TO MCOM_CODE  
   IF RPT_PRT = ' '
      SKIP
      LOOP
   ENDIF
   *  IF MCOM_CODE <> '44' .AND. MCOM_CODE <> '55' .AND. MCOM_CODE <> '66' .AND. MCOM_CODE <> '77' .AND. MCOM_CODE <> '88'
   *     SKIP
   *     LOOP
   *  ENDIF
   STORE RESERVE TO MRESERVE
   STORE INTEREST TO MINTEREST
   STORE WITHDRAW TO MWITHDRAW
   STORE NAME TO MSAL_NAME
   MSOMETHING = .F.
   SELECT C
   STORE 0 TO MPREV_BAL, MEARNINGS
   SEEK MTRAN_MO + 'S' + MCOM_CODE
   DO WHILE .NOT. EOF() .AND. TRAN_MO = MTRAN_MO .AND. COM_TYPE = 'S' .AND. COM_CODE = MCOM_CODE
      MSOMETHING = .T.
      IF DTOC(TRAN_DATE) = '  /  /  '  .AND. CK_NBR = SPACE(7)
         STORE AMOUNT TO MPREV_BAL
         SKIP
         LOOP
      ENDIF
      IF CK_NBR = SPACE(7)
         MEARNINGS = MEARNINGS + AMOUNT
      ENDIF
      SKIP
   ENDDO
   **** NOW PRINT THIS OUT
   IF MSOMETHING
      @ 06,30 SAY MCOMPANY   
      @ 08,26 SAY 'COMMISSION STATEMENT AS OF ' + DTOC(MDATE)
      @ 11,35 SAY MSAL_NAME
      
      @ 16,5 SAY 'BALANCE from Last Statement:'
      @ 16,64 say '$'
      @ 16,66 say MPREV_BAL PICTURE '999,999.99'
      @ 16,64 say '_____________'
      
      @ 19,5 SAY 'EARNINGS during ' + MMO_NAME + ':'
      @ 19,43 say '$'
      @ 19,45 say mearnings picture '999,999.99'
      @ 19,43 say '_____________'
      
      @ 23,5 SAY 'GROSS Commissions Paid for ' + mmo_name + ':'
      @ 23,64 say '$' 
      @ 23,66 say MPAID&MCOM_CODE PICTURE '999,999.99'
      @ 23,64 SAY '_____________'
      
      @ 25,5 SAY 'BAD DEBT Reserve Withheld: '
      @ 25,43 say '$'
      @ 25,45 say (mdeduct&MCOM_CODE * -1) picture '999,999.99'
      @ 25,43 say '_____________'
      
      @ 27,5 say 'NET Commissions Paid:'
      @ 27,43 SAY '$'
      @ 27,45 SAY MPAID&MCOM_CODE + mdeduct&MCOM_CODE PICTURE '999,999.99'
      @ 27,43 SAY '_____________'
      
      @ 30,5 say 'BALANCE:'
      MBALANCE = MPREV_BAL + MEARNINGS - MPAID&MCOM_CODE
      @ 30,64 SAY '$'
      @ 30,66 SAY MBALANCE PICTURE '999,999.99'
      @ 30,64 SAY '_____________'
      
      @ 35,5 SAY 'BAD DEBT Reserve Account TOTAL:'
      SELECT D
      *     STORE RESERVE&MCOM_CODE TO MRESERVE
      *     STORE INT&MCOM_CODE TO MINTEREST
      *     STORE WITH&MCOM_CODE TO MWITHDRAW
      
      *     DO CASE
      *     CASE MCOM_CODE = '44'
      *        STORE RESERVE44 TO MRESERVE
      *        STORE INT44 TO MINTEREST
      *        STORE WITH44 TO MWITHDRAW
      *     CASE MCOM_CODE = '55'
      *        STORE RESERVE55 TO MRESERVE
      *        STORE INT55 TO MINTEREST
      *        STORE WITH55 TO MWITHDRAW
      *     CASE MCOM_CODE = '66'  
      *        STORE RESERVE66 TO MRESERVE
      *        STORE INT66 TO MINTEREST
      *        STORE WITH66 TO MWITHDRAW
      *     CASE MCOM_CODE = '77'
      *        STORE RESERVE77 TO MRESERVE
      *        STORE INT77 TO MINTEREST
      *        STORE WITH77 TO MWITHDRAW
      *     CASE MCOM_CODE = '88'
      *        STORE RESERVE88 TO MRESERVE
      *        STORE INT88 TO MINTEREST
      *        STORE WITH88 TO MWITHDRAW
      *     OTHERWISE
      *        STORE 0 TO MRESERVE, MINTEREST, MWITHDRAW
      *     ENDCASE
      @ 35,64 SAY '$'
      @ 35,66 SAY MRESERVE - MNOTPOST&MCOM_CODE + MINTEREST - MWITHDRAW PICTURE '999,999.99'
      @ 35,64 SAY '_____________'
      EJECT
   ENDIF
   SELECT A
   SKIP
ENDDO

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

CLOSE DATA

* EOF: COM_STMT.PRG
*Formatted by: ToolBox Ver. 1.2  on 12/8/15 at 1:39 PM.
