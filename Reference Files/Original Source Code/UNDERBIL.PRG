**********
* Program.: UNDERBIL.PRG
* Author..: Grace Keller
* Date....: 03/08/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: ENTER UNDERBILLINGS         
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
*DIMENSION MSAVE_PRI(15)
DIMENSION MUPDRCD(15)
SELECT B
DO STORHEAD
STORE SUP_CODE TO MSUP_CODE
STORE BUY_CODE TO MBUY_CODE
STORE SALESMAN TO MSALESMAN
STORE INV_NBR TO MINV_NBR
STORE BILL_ADJ TO MSAVE_ADJ
STORE CUS_PALL TO MCUS_PALL
STORE SUP_PALL TO MSUP_PALL
DO SAVE_TOT
STORE RSUPCODE TO SRSUPCODE
STORE BBUYCODE TO SBBUYCODE
STORE FRT_CODE1 TO SFRT_CODE1
STORE SALESMAN TO SSALESMAN
STORE COM_CODE TO SCOM_CODE
STORE COM_CODE2 TO SCOM_CODE2
STORE COM_CODE3 TO SCOM_CODE3
STORE SAL_CODE2 TO SSAL_CODE2
STORE SAL_CODE3 TO SSAL_CODE3
STORE 0 TO MMISCAMT1, MMISCAMT2, MMISCAMT3  
STORE 0 TO SMISCAMT1, SMISCAMT2, SMISCAMT3  
RELEASE MQTY
RELEASE MFR_FZ
RELEASE MGRADE
RELEASE MPAK  
RELEASE MCLASS
RELEASE MPROD
RELEASE MSIZE
RELEASE MPACKSPEC
RELEASE MLBS
RELEASE MPURC_PRI
RELEASE MSELL_PRI
RELEASE MPURC_TOT
RELEASE MSELL_TOT
RELEASE MSHRT_BOX
RELEASE MSHRT_LBS
RELEASE MBILL_PRI
RELEASE MPAK1  
RELEASE MPAK2  
RELEASE MBOX_SZ
RELEASE MOLD_LOT
RELEASE MOLD_LBS
RELEASE MOLD_QTY
RELEASE MOLD_PROD
RELEASE MIN_LOT
RELEASE MOUT_LOT
RELEASE MOLD_IN
RELEASE MOLD_OUT
RELEASE MSTOR_ITEM
RELEASE MPAK_YR
RELEASE MPAK_DAY

DIMENSION MQTY(7)
DIMENSION MFR_FZ(7)
DIMENSION MGRADE(7)
DIMENSION MPAK(7)  
DIMENSION MCLASS(7)
DIMENSION MPROD(7)
DIMENSION MSIZE(7)
DIMENSION MPACKSPEC(7)
DIMENSION MLBS(7)
DIMENSION MPURC_PRI(7)
DIMENSION MSELL_PRI(7)
DIMENSION MPURC_TOT(7)
DIMENSION MSELL_TOT(7)
DIMENSION MSHRT_BOX(7)
DIMENSION MSHRT_LBS(7)
DIMENSION MBILL_PRI(7)
DIMENSION MPAK1(7)  
DIMENSION MPAK2(7)  
DIMENSION MBOX_SZ(7)
DIMENSION MOLD_LOT(7)
DIMENSION MOLD_LBS(7)
DIMENSION MOLD_QTY(7)
DIMENSION MOLD_PROD(7)
DIMENSION MIN_LOT(7)
DIMENSION MOUT_LOT(7)
DIMENSION MOLD_IN(7)
DIMENSION MOLD_OUT(7)
DIMENSION MSTOR_ITEM(7)
DIMENSION MPAK_YR(7)
DIMENSION MPAK_DAY(7)

MCHG_ITM = .F.
MADD_ITM = .F.
SELECT C
SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
IF .NOT. EOF()
   STORE RECNO() TO MRECNO
ELSE 
   STORE 0 TO MRECNO
ENDIF

MMORE_ITM = .T.  
MPAGE = 1
@ 02,55 SAY 'INV NBR: ' + MINV_NBR
@ 3,0 CLEAR
IF MSALESMAN <> '  '
   MSAY_PO = MSALESMAN + '-' + MPO_NBR
ELSE
   MSAY_PO = MPO_NBR
ENDIF
IF MPO_SUFFIX <> ' '
   MSAY_PO = MSAY_PO + '-' + MPO_SUFFIX
ENDIF
MTITLE = ' - ENTER BILLING PRICES FOR PO NBR ' + MSAY_PO
DO TEXT2ND

DO WHILE MMORE_ITM
   MMAX_ITM = 0
   MNBR_ITM = 1
   SELECT C
   IF .NOT. EOF()
      GOTO MRECNO
   ENDIF
   DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX .AND. VAL(ITEM_NBR) <= (MPAGE * 15)    
      DO STORITM
*     STORE MPURC_PRI(MNBR_ITM) TO MSAVE_PRI(MNBR_ITM)
      STORE RECNO() TO MUPDRCD(MNBR_ITM)
      IF BILL_PRI <> 0
         STORE BILL_PRI TO MPURC_PRI(MNBR_ITM)
         STORE TOT_BILL TO MPURC_TOT(MNBR_ITM)

*        MPURC_TOT(MNBR_ITM) = MLBS(MNBR_ITM) * MPURC_PRI(MNBR_ITM)
*        MPURC_TOT(MNBR_ITM) = ROUND(MPURC_TOT(MNBR_ITM),2)
*        MSW = ROUND(BILL_PRI * MSHRT_LBS(MNBR_ITM),2)
*        MPURC_TOT(MNBR_ITM) = MPURC_TOT(MNBR_ITM) - MSW
         
      ENDIF
      STORE ' ' TO MFLAG(MNBR_ITM)
      MMAX_ITM = MMAX_ITM + 1
      MNBR_ITM = MNBR_ITM + 1
      SKIP
   ENDDO
   STORE RECNO() TO MRECNO
   IF .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
      MBLURP = .T.
   ELSE
      MBLURP = .F.
   ENDIF
   @ 3,77 SAY STR(MPAGE,2)
   MLINE = 08 
   MNBR_ITM = 1
   DO WHILE MNBR_ITM <= MMAX_ITM
      DO SAYITM 
      @ MLINE,0 SAY MFLAG(MNBR_ITM)
      MLINE = MLINE + 1
      MNBR_ITM = MNBR_ITM + 1
   ENDDO
   IF MBLURP
      @ 23,67 SAY 'More Items...'
   ELSE
      @ 23,67 TO 23,79
   ENDIF
   
   MLINE = 08 
   MNBR_ITM = 1
   
   MNEXT_ITM = .T.
   DO WHILE MLINE <= 22 .AND. MNBR_ITM <= MMAX_ITM
      *     STORE ' ' TO MPICK
      @ MLINE,0 GET MFLAG(MNBR_ITM) PICTURE '@!'
      READ
      STORE MFLAG(MNBR_ITM) TO MPICK
      IF MPICK = 'X' .OR. MPICK = 'C'
         **** I IS THE ITEM NUMBER
         **** X IS THE SUBSCRIPT NUMBER
         I = ((MPAGE - 1) * 15) + (MLINE - 7)
         X = MLINE - 7
         SAVE SCREEN TO MSHRT_SCRN
         DO SHORTBIL
         RESTORE SCREEN FROM MSHRT_SCRN
         DO SAYITM
      ENDIF
      @ MLINE,0 SAY ' '
      MLINE = MLINE + 1
      MNBR_ITM = MNBR_ITM + 1
      
   ENDDO
   
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   IF MBLURP
      @ 24,12 SAY '1. Next Itm Pg.     2. Edit     3. Finished'
   ELSE
      @ 24,12 SAY '1. Finished     2. Edit'
   ENDIF
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
   IF MBLURP
      DO CASE
      CASE MACTION = 1
         @ 8,0 CLEAR TO 22,79 
         MPAGE = MPAGE + 1
         LOOP      
      CASE MACTION = 2
         LOOP
      CASE MACTION = 3
         MMORE_ITM = .F.
         MBILL_ADJ = 0
         DO TOTUNDER
         MLAST_PG = .T.
         DO FRT_VIEW
         **** MAKE THE JOURNAL ENTRIES
         DO JRN_SAME
      ENDCASE
   ELSE
      DO CASE      
      CASE MACTION = 1
         MMORE_ITM = .F.
         MBILL_ADJ = 0
         DO TOTUNDER
         MLAST_PG = .T.
         DO FRT_VIEW
         **** MAKE THE JOURNAL ENTRIES
         DO JRN_SAME
      CASE MACTION = 2
         LOOP        
      ENDCASE 
   ENDIF
ENDDO 

RETURN
* EOF: UNDERBIL.PRG
*Formatted by: dANALYST Ver. 7.3a on March 9, 1988 at 10:21 AM.
