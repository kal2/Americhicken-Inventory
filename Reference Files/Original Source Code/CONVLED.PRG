*************
* Program.: CONVLED.PRG
* Author..: Grace Keller
* Date....: 04/29/88
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: CONSOLIDATE LEDGER ACCOUNTS    
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
MTITLE = ' - CONSOLIDATE LEDGER ACCOUNTS'

CLEAR
@ 01,00 SAY MCOMPANY
@ 01,68 SAY DATE()
@  2,0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
STORE ' ' TO MSUP_SEL, MCUS_SEL, MBBK_SEL
STORE 0 TO MTRAN_MO, MTRAN_YR
STORE 2 TO MACTION
DO WHILE MACTION = 2
   @ 05,5 SAY "SELECT WITH AN 'X' THE LEDGER ENTRIES TO CONSOLIDATE"
   @ 09,5 SAY '     PURCHASE LEDGER: ' GET MSUP_SEL PICTURE '@!'
   @ 11,5 SAY '        SALES LEDGER: ' GET MCUS_SEL PICTURE '@!'
   @ 13,5 SAY '     BILLBACK LEDGER: ' GET MBBK_SEL PICTURE '@!'
   @ 17,5 SAY '       ACTIVITY MONTH: ' GET MTRAN_MO PICTURE '99' RANGE 1,12
   @ 19,5 SAY '        ACTIVITY YEAR: ' GET MTRAN_YR PICTURE '####' RANGE 1988,2099
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   @ 24,12 SAY '1. Continue      2. Edit     3. Cancel'
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
   DO CASE
      
   CASE MSUP_SEL <> ' ' .AND. MSUP_SEL <> 'X' 
      @ 24,0 CLEAR
      STORE ' ' TO MWAIT
      @ 24,1 SAY "PURCHASE SELECTION MUST BE A BLANK OR 'X' - PLEASE REENTER " GET MWAIT
      READ
      @ 24,0 CLEAR
      MACTION = 2
      LOOP
      
   CASE MCUS_SEL <> ' ' .AND. MCUS_SEL <> 'X'
      @ 24,0 CLEAR
      STORE ' ' TO MWAIT
      @ 24,1 SAY "SALES SELECTION MUST BE A BLANK OR 'X' - PLEASE REENTER " GET MWAIT
      READ
      @ 24,0 CLEAR
      MACTION = 2
      LOOP
      
   CASE MBBK_SEL <> ' ' .AND. MBBK_SEL <> 'X'
      @ 24,0 CLEAR
      STORE ' ' TO MWAIT
      @ 24,1 SAY "BILLBACK SELECTION MUST BE A BLANK OR 'X' - PLEASE REENTER " GET MWAIT
      READ
      @ 24,0 CLEAR
      MACTION = 2
      LOOP
      
      
   ENDCASE
ENDDO
STORE SUBSTR(STR(MTRAN_MO + 100,3),2) TO MTRAN_MO
STORE STR(MTRAN_YR,4) TO MTRAN_YR

DO CASE 
   
CASE MSUP_SEL = 'X'
   SELECT A
   DO FOX_USE WITH "SUPLED", .F.
   INDEX ON TRAN_YR + TRAN_MO + RSUPCODE TO TMP_IDX
   USE       
   DO FOX_USE WITH "SUPLED INDEX TMP_IDX, SUPLED, SUPMATCH", .F.
   SELECT B
   DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
   SELECT A
   SEEK MTRAN_YR + MTRAN_MO
   IF EOF()
      SET DEVICE TO SCREEN
      @ 4,1 CLEAR TO 20,78
      STORE ' ' TO MWAIT
      @ 10,1 SAY 'NO LEDGER ACTIVITY TO CONSOLIDATE FOR THIS MONTH - PRESS RETURN ' GET MWAIT
      READ
      RETURN
   ENDIF
   @ 19,5 SAY 'CONSOLIDATING......PLEASE WAIT'
   DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO
      
      STORE RSUPCODE TO MRSUPCODE
      SELECT B
      SEEK MRSUPCODE
      IF EOF()
         STORE SPACE(4) TO MLED_CODE 
      ELSE
         STORE LED_CODE TO MLED_CODE
      ENDIF
      SELECT A
      DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO .AND. RSUPCODE = MRSUPCODE
         DO FILELOCK
         IF MLED_CODE = SPACE(4)
            REPLACE LED_CODE WITH RSUPCODE
         ELSE
            REPLACE LED_CODE WITH MLED_CODE
         ENDIF
         UNLOCK
         SKIP
      ENDDO
   ENDDO
   
CASE MCUS_SEL = 'X'
   SELECT A
   DO FOX_USE WITH "CUSLED", .F.
   INDEX ON TRAN_YR + TRAN_MO + BBUYCODE TO  TMP_IDX
   USE
   DO FOX_USE WITH "CUSLED INDEX TMP_IDX, CUSLED, CUSMATCH", .F.
   SELECT B
   DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
   
   SELECT A
   SEEK MTRAN_YR + MTRAN_MO
   
   IF EOF()
      SET DEVICE TO SCREEN
      @ 4,1 CLEAR TO 20,78
      STORE ' ' TO MWAIT
      @ 10,1 SAY 'NO LEDGER ACTIVITY TO CONSOLIDATE FOR THIS MONTH - PRESS RETURN ' GET MWAIT
      READ
      RETURN
   ENDIF
   @ 19,5 SAY 'CONSOLIDATING......PLEASE WAIT'
   DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO
      
      STORE BBUYCODE TO MBBUYCODE
      SELECT B
      SEEK MBBUYCODE
      IF EOF()
         STORE SPACE(4) TO MLED_CODE 
      ELSE
         STORE LED_CODE TO MLED_CODE
      ENDIF
      SELECT A
      DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO .AND. BBUYCODE = MBBUYCODE
         DO FILELOCK
         IF MLED_CODE = SPACE(4)
            REPLACE LED_CODE WITH BBUYCODE
         ELSE
            REPLACE LED_CODE WITH MLED_CODE
         ENDIF
         UNLOCK
         SKIP
      ENDDO
   ENDDO
   
CASE MBBK_SEL = 'X'
   SELECT A
   DO FOX_USE WITH "BBKLED", .F.
   INDEX ON TRAN_YR + TRAN_MO + COM_CODE TO TMP_IDX
   USE       
   
   DO FOX_USE WITH "BBKLED INDEX TMP_IDX, BBKLED, BBKPD", .F.
   SELECT B
   DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
   
   SELECT A
   SEEK MTRAN_YR + MTRAN_MO
   IF EOF()
      SET DEVICE TO SCREEN
      @ 4,1 CLEAR TO 20,78
      STORE ' ' TO MWAIT
      @ 10,1 SAY 'NO LEDGER ACTIVITY TO CONSOLIDATE FOR THIS MONTH - PRESS RETURN ' GET MWAIT
      READ
      RETURN
   ENDIF
   @ 19,5 SAY 'CONSOLIDATING......PLEASE WAIT'
   DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO
      
      STORE COM_CODE TO MCOM_CODE
      SELECT B
      SEEK MCOM_CODE
      IF EOF()
         STORE SPACE(2) TO MLED_CODE 
      ELSE
         STORE LED_CODE TO MLED_CODE
      ENDIF
      
      SELECT A
      DO WHILE .NOT. EOF() .AND. TRAN_YR = MTRAN_YR .AND. TRAN_MO = MTRAN_MO .AND. COM_CODE = MCOM_CODE
         DO FILELOCK
         IF MLED_CODE = SPACE(2)
            REPLACE LED_CODE WITH COM_CODE
         ELSE
            REPLACE LED_CODE WITH MLED_CODE
         ENDIF
         UNLOCK
         SKIP
      ENDDO
   ENDDO
   
   
ENDCASE
RETURN
* EOF: CONVLED.PRG

*Formatted by: ToolBox Ver. 1.2  on 12/14/9 at 2:43 PM.
