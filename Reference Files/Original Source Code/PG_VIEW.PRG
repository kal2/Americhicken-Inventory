**********
* Program.: PG_VIEW.PRG
* Author..: Grace Keller
* Date....: 10/19/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PURCHASE ORDER VIEW- MULTIPLE PAGES
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
RELEASE MQTY
RELEASE MFR_FZ
RELEASE MGRADE
RELEASE MPAK  
RELEASE MCLASS
RELEASE MPROD
RELEASE MSIZE
RELEASE MPACKSPEC
RELEASE MLBS
RELEASE MPURC_PRI
RELEASE MSELL_PRI
RELEASE MPURC_TOT
RELEASE MSELL_TOT
RELEASE MSHRT_BOX
RELEASE MSHRT_LBS
RELEASE MBILL_PRI
RELEASE MPAK1  
RELEASE MPAK2  
RELEASE MBOX_SZ
RELEASE MOLD_LOT
RELEASE MOLD_LBS
RELEASE MOLD_QTY
RELEASE MOLD_PROD
RELEASE MIN_LOT
RELEASE MOUT_LOT
RELEASE MOLD_IN
RELEASE MOLD_OUT
RELEASE MSTOR_ITEM
RELEASE MPAK_YR
RELEASE MPAK_DAY
RELEASE Mout_YR
RELEASE Mout_DAY

DIMENSION MQTY(7)
DIMENSION MFR_FZ(7)
DIMENSION MGRADE(7)
DIMENSION MPAK(7)  
DIMENSION MCLASS(7)
DIMENSION MPROD(7)
DIMENSION MSIZE(7)
DIMENSION MPACKSPEC(7)
DIMENSION MLBS(7)
DIMENSION MPURC_PRI(7)
DIMENSION MSELL_PRI(7)
DIMENSION MPURC_TOT(7)
DIMENSION MSELL_TOT(7)
DIMENSION MSHRT_BOX(7)
DIMENSION MSHRT_LBS(7)
DIMENSION MBILL_PRI(7)
DIMENSION MPAK1(7)  
DIMENSION MPAK2(7)  
DIMENSION MBOX_SZ(7)
DIMENSION MOLD_LOT(7)
DIMENSION MOLD_LBS(7)
DIMENSION MOLD_QTY(7)
DIMENSION MOLD_PROD(7)
DIMENSION MIN_LOT(7)
DIMENSION MOUT_LOT(7)
DIMENSION MOLD_IN(7)
DIMENSION MOLD_OUT(7)
DIMENSION MSTOR_ITEM(7)
DIMENSION MHIST(7)
DIMENSION MITEM(7)
DIMENSION MSAVEREC(7)
DIMENSION MPAK_YR(7)
DIMENSION MPAK_DAY(7)
DIMENSION Mout_YR(7)
DIMENSION Mout_DAY(7)
MMORE_ITM = .T.
MPAGE = 1
SELECT D
DO FOX_USE WITH "HIST_DTL INDEX HIST_DTL", .F.
SELECT C
SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
IF EOF()
   STORE 0 TO MRECNO
ELSE
   STORE RECNO() TO MRECNO
ENDIF

@ 3,0 CLEAR
DO TEXT2ND
@ 3,65 SAY 'ITEMS: PAGE '
IF MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
   MPAGEITMS = 7
ELSE
   MPAGEITMS = 15
ENDIF

DO WHILE MMORE_ITM
   MMAX_ITM = 0
   MNBR_ITM = 1
   SELECT C
   IF .NOT. EOF()
      GOTO MRECNO
   ENDIF
   @ 23,67 CLEAR TO 23,79
   DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX .AND. VAL(ITEM_NBR) <= (MPAGE * MPAGEITMS)    
      DO STORITM
      STORE ITEM_NBR TO MX
      STORE RECNO() TO MSAVEREC(MNBR_ITM)
      SELECT D
      SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX + MX
      IF EOF()
         STORE ' ' TO MHIST(MNBR_ITM) 
         STORE SPACE(2) TO MITEM(MNBR_ITM)
      ELSE
         STORE 'H' TO MHIST(MNBR_ITM)
         STORE MX TO MITEM(MNBR_ITM)
      ENDIF
      SELECT C
      MMAX_ITM = MMAX_ITM + 1
      MNBR_ITM = MNBR_ITM + 1
      SKIP
   ENDDO
   STORE RECNO() TO MRECNO
   IF .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
      MBLURP = .T.
   ELSE
      MBLURP = .F.
   ENDIF
   @ 3,77 SAY STR(MPAGE,2)

   MLINE = 08
   MNBR_ITM = 1

   DO WHILE MNBR_ITM <= MMAX_ITM
      @ MLINE,0 SAY MHIST(MNBR_ITM)
      DO SAYITM 
      
      IF MCOMPANY = 'DIVISION 15' .OR. MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
         MLINE = MLINE + 2
      ELSE
         MLINE = MLINE + 1
      ENDIF
      MNBR_ITM = MNBR_ITM + 1
   ENDDO

   IF MBLURP
      @ 23,67 SAY 'More Items...'
   ELSE
      @ 23,67 SAY '             '
   ENDIF
   
   MLINE = 08 
   MNBR_ITM = 1
   
   MNEXT_ITM = .T.
   DO WHILE MLINE <= 22 .AND. MNBR_ITM <= MMAX_ITM
      IF MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
         DO HIGHITM
      ENDIF
      @ MLINE,0 GET MHIST(MNBR_ITM) PICTURE '@!'
      READ
      IF MHIST(MNBR_ITM) = 'X' .OR. MHIST(MNBR_ITM) = 'V'
         STORE MLINE TO MSAVE_LINE 
         STORE MNBR_ITM TO MSAVE_ITM
         SELECT C
         SET PROC TO PO_PROC
         GOTO MSAVEREC(MNBR_ITM)
         SAVE SCREEN TO MSCREEN
         DO ITM_HIST
         RESTORE SCREEN FROM MSCREEN
         STORE MSAVE_LINE TO MLINE
         STORE MSAVE_ITM TO MNBR_ITM
         IF MCOMPANY = 'DIVISION 15' .OR. MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
            SET PROC TO I_PROC
         ENDIF
      ENDIF
      @ MLINE,0 SAY MHIST(MNBR_ITM)
      DO SAYITM
      IF MCOMPANY = 'DIVISION 15' .OR. MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
         MLINE = MLINE + 2
      ELSE
         MLINE = MLINE + 1
      ENDIF
      MNBR_ITM = MNBR_ITM + 1
   ENDDO
   
   STORE 1 TO MACTION
   @ 25,0 CLEAR
   @ 25,0 SAY 'Action: ' + STR(MACTION,1)
   IF MBLURP
      @ 25,12 SAY '1. Next Itm Pg.   2. Continue    3. Previous Pg.   4. Finished'
   ELSE
      @ 25,12 SAY '1. Continue      2. Previous Pg.     3. Finished with View'
   ENDIF

   @ 25,8 GET MACTION PICTURE '#' RANGE 1,4
   
   READ
   IF MBLURP
      DO CASE
      CASE MACTION = 1
         @ 8,0 CLEAR TO 23,80 
         MPAGE = MPAGE + 1
         LOOP      
      CASE MACTION = 2
         MGOTO_PG = 3
         *  DO MISCVIEW  
         *  DO FRT_VIEW
      CASE MACTION = 3
         MGOTO_PG = 1
      CASE MACTION = 4
         MGOTO_PG = 99
      ENDCASE
      MMORE_ITM = .F.
   ELSE
      IF MACTION = 1
         MGOTO_PG = 3
         *  DO MISCVIEW
         *  DO FRT_VIEW
      ENDIF
      IF MACTION = 2
         MGOTO_PG = 1
      ENDIF
      IF MACTION = 3
         MGOTO_PG = 99
      ENDIF
      MMORE_ITM = .F.
   ENDIF
ENDDO 

RETURN
* EOF: PG_VIEW.PRG
*Formatted by: ToolBox Ver. 1.2  on 6/28/2 at 10:12 AM.
