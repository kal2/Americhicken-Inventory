**********
* Program.: PO_VIEW.PRG
* Author..: Grace Keller
* Date....: 10/19/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PURCHASE ORDER VIEW
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
STORE DATE() TO MDATE
STORE TIME() TO MTIME
SET PROC TO PO_PROC
SELECT B
DO STORHEAD
STORE SUP_CODE TO MSUP_CODE
STORE BUY_CODE TO MBUY_CODE
STORE RSUPCODE TO MRSUPCODE
STORE BBUYCODE TO MBBUYCODE
STORE SALESMAN TO MSALESMAN
STORE INV_NBR TO MINV_NBR
DO HEAD_TOT
STORE MTOT_SELL TO MSAV_SELL
STORE MTOT_PURCH TO MSAV_PURCH
STORE MTOT_LBS TO MSAV_LBS
MCHG_ITM = .F.
MADD_ITM = .F.
SELECT A
DO FOX_USE WITH "&MDBFLOC.SUPPLIER INDEX &MDBFLOC.SUP_CODE", .F.
SEEK MSUP_CODE

IF .NOT. EOF()
   STORE NAME TO MSUP_NAME, MSAV_SUP
   STORE STREET TO MSUP_STRT  
   STORE CITY TO MSUP_CITY       
   STORE STATE TO MSUP_ST    
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MSUP_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MSUP_ZIP 
   ENDIF
ELSE 
   IF MSUP_CODE = 'NONE'
      STORE 'NONE' TO MSUP_NAME, MSAV_SUP
   ELSE
      STORE 'SHIPPED FROM NOT ON FILE' TO MSUP_NAME, MSAV_SUP
   ENDIF
   STORE SPACE(28) TO MSUP_STRT
   STORE SPACE(20) TO MSUP_CITY
   STORE SPACE(2) TO MSUP_ST    
   STORE SPACE(10) TO MSUP_ZIP
ENDIF

DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
SEEK MRSUPCODE
IF .NOT. EOF()
   STORE NAME TO MRSUPNAME, MSAV_RSUP
   STORE STREET TO MRSUP_STRT  
   STORE CITY TO MRSUP_CITY       
   STORE STATE TO MRSUP_ST   
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MRSUP_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MRSUP_ZIP 
   ENDIF
ELSE 
   IF MRSUPCODE = 'NONE'
      STORE 'NONE' TO MRSUPNAME, MSAV_RSUP
   ELSE
      STORE 'REMIT TO NOT ON FILE' TO MRSUPNAME, MSAV_RSUP
   ENDIF
   STORE SPACE(28) TO MRSUP_STRT
   STORE SPACE(20) TO MRSUP_CITY
   STORE SPACE(2) TO MRSUP_ST   
   STORE SPACE(10) TO MRSUP_ZIP
ENDIF

SELECT A
DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_CODE", .F.
SEEK MBUY_CODE
IF .NOT. EOF()
   STORE NAME TO MBUY_NAME, MSAV_BUY
   STORE STREET TO MBUY_STRT  
   STORE CITY TO MBUY_CITY       
   STORE STATE TO MBUY_ST    
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MBUY_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MBUY_ZIP 
   ENDIF
ELSE 
   IF MBUY_CODE = 'NONE'
      STORE 'NONE' TO MBUY_NAME, MSAV_BUY
   ELSE
      STORE 'SHIP TO NOT ON FILE' TO MBUY_NAME, MSAV_BUY
   ENDIF
   STORE SPACE(28) TO MBUY_STRT
   STORE SPACE(20) TO MBUY_CITY
   STORE SPACE(2) TO MBUY_ST   
   STORE SPACE(10) TO MBUY_ZIP
ENDIF

SELECT A
DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
SEEK MBBUYCODE
IF .NOT. EOF()
   STORE NAME TO MBBUYNAME, MSAV_BBUY
   STORE STREET TO MBBUY_STRT  
   STORE CITY TO MBBUY_CITY       
   STORE STATE TO MBBUY_ST      
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MBBUY_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MBBUY_ZIP 
   ENDIF
ELSE 
   IF MBBUYCODE = 'NONE'
      STORE 'NONE' TO MBBUYNAME, MSAV_BBUY
   ELSE
      STORE 'BILL TO NOT ON FILE' TO MBBUYNAME, MSAV_BBUY
   ENDIF
   STORE SPACE(28) TO MBBUY_STRT
   STORE SPACE(20) TO MBBUY_CITY
   STORE SPACE(2) TO MBBUY_ST   
   STORE SPACE(10) TO MBBUY_ZIP
ENDIF

SELECT B
STORE MAIN_SHIP TO MMAIN_SHIP
SELECT A
DO FOX_USE WITH "SHIPWITH INDEX SHIPWITH", .F.
IF MMAIN_SHIP = 'Y'
   SEEK B->SALESMAN + B->PO_NBR + B->PO_SUFFIX
   STORE PO_SHIP1 TO MPO_SHIP1
   STORE PO_SHIP2 TO MPO_SHIP2
   STORE PO_SHIP3 TO MPO_SHIP3
   STORE PO_SHIP4 TO MPO_SHIP4
   STORE PO_SHIP5 TO MPO_SHIP5
   STORE PO_SHIP6 TO MPO_SHIP6
   STORE PO_SUFF1 TO MPO_SUFF1
   STORE PO_SUFF2 TO MPO_SUFF2
   STORE PO_SUFF3 TO MPO_SUFF3
   STORE PO_SUFF4 TO MPO_SUFF4
   STORE PO_SUFF5 TO MPO_SUFF5
   STORE PO_SUFF6 TO MPO_SUFF6
ELSE
   IF B->SHIP_NBR <> SPACE(4)
      STORE 'N' TO MMAIN_SHIP
      SEEK B->SALESMAN + B->SHIP_NBR + B->SHIP_SUFF
      STORE PO_NBR    TO MPO_SHIP1
      STORE PO_SUFFIX TO MPO_SUFF1
      I = 2
      M = 1 
      DO WHILE M<= 6
         MI = STR(I,1)
         MM = STR(M,1)
         IF PO_SHIP&MM = B->PO_NBR .AND. PO_SUFF&MM = B->PO_SUFFIX
            M = M + 1
            LOOP
         ENDIF
         STORE PO_SHIP&MM TO MPO_SHIP&MI 
         STORE PO_SUFF&MM TO MPO_SUFF&MI
         I = I + 1
         M = M + 1
      ENDDO
   ELSE
      STORE SPACE(4) TO MPO_SHIP1, MPO_SHIP2, MPO_SHIP3, MPO_SHIP3, MPO_SHIP4, MPO_SHIP5, MPO_SHIP6
      STORE SPACE(1) TO MPO_SUFF1, MPO_SUFF2, MPO_SUFF3, MPO_SUFF3, MPO_SUFF4, MPO_SUFF5, MPO_SUFF6
   ENDIF
ENDIF
USE

SELECT B

MCONT = .T.
CLEAR
DO WHILE MCONT
   CLEAR
   MTITLE = ' - VIEW PO'    
   SET PROC TO PO_PROC
   DO TEXTPO2
   IF B->NOTES_FLG <> ' '
      @ 1,28 SAY '(-NOTES ON FILE-)'
   ENDIF
   DO SAYPO3   
   
   DO TEXTPO3
   
   **** GET SUPPLIER SHIPPED FROM ADDRESS
   @ 13,1  SAY MSUP_NAME
   IF MSUP_NAME <> 'NONE'                 
      @ 14,1  SAY MSUP_STRT  
      @ 15,1 SAY  SPACE(35)
      IF MSUP_CITY <> SPACE(20) .OR. MSUP_ST <> SPACE(2)
         @ 15,1  SAY TRIM(MSUP_CITY) + ', ' + MSUP_ST + '  ' + MSUP_ZIP
      ENDIF
   ENDIF
   @ 13,40 SAY MRSUPNAME
   IF MRSUPNAME <> 'NONE'
      @ 14,40 SAY MRSUP_STRT
      @ 15,40 SAY SPACE(35)
      IF MRSUP_CITY <> SPACE(20) .OR. MRSUP_ST  <> SPACE(2)
         @ 15,40 SAY TRIM(MRSUP_CITY) + ', ' + MRSUP_ST + '  ' + MRSUP_ZIP
      ENDIF
   ENDIF
   
   ***** NOW GET SHIP TO CUSTOMER
   @ 20,1  SAY MBUY_NAME
   IF MBUY_NAME <> 'NONE'
      @ 21,1  SAY MBUY_STRT
      @ 22,1 SAY SPACE(35)
      IF MBUY_CITY <> SPACE(20) .OR. MBUY_ST <> SPACE(2)
         @ 22,1  SAY TRIM(MBUY_CITY) + ', ' + MBUY_ST + '  ' + MBUY_ZIP
      ENDIF
   ENDIF
   
   @ 20,40 SAY MBBUYNAME
   IF MBBUYNAME <> 'NONE'
      @ 21,40 SAY MBBUY_STRT
      @ 22,40 SAY SPACE(35)
      IF MBBUY_CITY <> SPACE(20) .OR. MBBUY_ST <> SPACE(2)
         @ 22,40 SAY TRIM(MBBUY_CITY) + ', ' + MBBUY_ST + '  ' + MBBUY_ZIP
      ENDIF
   ENDIF
   
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   @ 24,12 SAY '1. Item Page     2. Finished with View    3. Update Notes'
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
   IF MACTION = 3
      SAVE SCREEN TO MGRACE
      DO UPDNOTES
      RESTORE SCREEN FROM MGRACE
      STORE 1 TO MACTION
      @ 24,0 CLEAR
      @ 24,0 SAY 'Action: '
      @ 24,12 SAY '1. Item Page     2. Finished with View'
      @ 24,8 GET MACTION PICTURE '#' RANGE 1,2
      READ
   ENDIF
   
   DO CASE      
   CASE MACTION = 2 
      MCONT = .F.
      MGOTO_PG = 99
      LOOP
   CASE MACTION = 1
      *     DO PG_VIEW
      MGOTO_PG = 2
      MCONT = .F.
   ENDCASE 
ENDDO 

RETURN
* EOF: PO_VIEW.PRG
*Formatted by: ToolBox Ver. 1.2  on 11/21/89 at 1:16 PM.
