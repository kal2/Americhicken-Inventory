************
* Program.: LBS_SUM.PRG
* Author..: GRACE KELLER
* Date....: 05/02/94
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: POUNDS BY PRODUCT SUMMARY            
*
MTITLE = ' - POUNDS BY PRODUCT SUMMARY'
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET FIRST AND LAST DATES FOR THIS REPORT
STORE CTOD(' ') TO MSTART, MLAST
STORE 'P' TO MDISP_PRT
STORE SPACE(10) TO MPROD
MRECALC = 'Y'
MPRT_CRED = 'Y'
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 11,2 say '        BEGINNING DATE: '
   @ 11,27 GET MSTART
   @ 13,2 SAY '           ENDING DATE: '
   @ 13,27 GET MLAST
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'                     
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF MRECALC = 'Y'
         IF DTOC(MSTART) = '  /  /  ' .AND. DTOC(MLAST) = '  /  /  '
            MACTION = 3
            LOOP
         ENDIF
         IF (DTOC(MSTART) <> '  /  /  ' .AND. DTOC(MLAST) = '  /  /  ') .OR. (DTOC(MSTART) = '  /  /  ' .AND. DTOC(MLAST) <> '  /  /  ')
            @ 24,0 CLEAR
            mwait = ' '
            @ 24,1 SAY 'Only One Date Entered - Both Begin and End Dates Must be Entered ' GET MWAIT
            READ
            MACTION = 2
            @ 24,0 clear
            LOOP 
         ENDIF
      ENDIF
   ENDIF
ENDDO
IF MACTION = 3
   RETURN 
ENDIF  
SELECT D 
DO FOX_USE WITH "&MDBFLOC.PRODUCTS INDEX  &MDBFLOC.PRODUCTS", .F.

SELECT C
USE TEMPPROD EXCLUSIVE         
DELETE ALL
PACK
INDEX ON PROD_DESC TO TEMPPROD
USE 
USE TEMPPROD INDEX TEMPPROD EXCLUSIVE

SELECT B 
DO FOX_USE WITH "PO_DTL INDEX  PO_DTL", .F.

SELECT A 
DO FOX_USE WITH "PO_HEAD INDEX  PO_SHIP", .F.


STORE MONTH(MSTART) TO MSTRT_MO   
MSTRT_MO = MSTRT_MO + 100
STORE SUBSTR(STR(MSTRT_MO,3),2) TO MSTRT_MO

STORE MONTH(MLAST) TO MLAST_MO   
MLAST_MO = MLAST_MO + 100
STORE SUBSTR(STR(MLAST_MO,3),2) TO MLAST_MO

STORE YEAR(MSTART) TO MSTRT_YR
STORE STR(MSTRT_YR,4) TO MSTRT_YR

STORE YEAR(MLAST) TO MLAST_YR
STORE STR(MLAST_YR,4) TO MLAST_YR

STORE DAY(MSTART) TO MSTRT_DAY
MSTRT_DAY = MSTRT_DAY + 100
STORE SUBSTR(STR(MSTRT_DAY,3),2) TO MSTRT_DAY

STORE DAY(MLAST) TO MLAST_DAY
MLAST_DAY = MLAST_DAY + 100
STORE SUBSTR(STR(MLAST_DAY,3),2) TO MLAST_DAY
SELECT A
SEEK MSTRT_YR + MSTRT_MO + MSTRT_DAY
IF EOF()
   SEEK MSTRT_YR + MSTRT_MO 
   IF EOF()
      SEEK MSTRT_YR
      IF EOF()
         GOTO TOP
      ENDIF
   ENDIF
ENDIF
DO WHILE .NOT. EOF() .AND. SHIP_DATE < MSTART
   SKIP
ENDDO
MPRT_ACT = 'C'

IF MDISP_PRT = 'P'
   DO PRT_SET
   
   IF MPRT_ACT <> 'C'
      RETURN
   ENDIF
   MPAGE_LEN = 60
   
ELSE
   MPAGE_LEN = 20
ENDIF
@ 19,16 SAY 'CALCULATING .... PLEASE WAIT..'

DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MLAST
   *** IF ONLY PUTTING INTO INVENTORY - SKIP - DONT COUNT AS SALE 
   IF BBUYCODE = 'INVN'
      SKIP
      LOOP
   ENDIF
   STORE SALESMAN TO MSALESMAN
   STORE PO_NBR TO MPO_NBR
   STORE PO_SUFFIX TO MPO_SUFFIX
   
   *** PURCHASE ORDER DETAIL
   SELECT B
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   
   DO WHILE .NOT. EOF() .AND. MSALESMAN = SALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
      IF LBS = 0
         SKIP
         LOOP
      ENDIF
      
      SELECT C
      SEEK B->PROD_DESC
      IF EOF()
         APPEND BLANK
         REPLACE PROD_DESC WITH B->PROD_DESC
      ENDIF
      DO CASE
      CASE SUBSTR(B->PACKED,1,1) = 'B' .OR. SUBSTR(B->PACKED,1,1) = 'H'
         REPLACE LBS_SOLD WITH LBS_SOLD + (VAL(SUBSTR(B->PACKED,2))*B->QTY)
      OTHERWISE 
         REPLACE LBS_SOLD WITH LBS_SOLD + B->LBS         
      ENDCASE
      SELECT B
      SKIP
   ENDDO
   
   SELECT A
   SKIP
ENDDO

SELECT C
GOTO TOP
REPLACE BEG_DATE WITH MSTART
REPLACE END_DATE WITH MLAST

SUM LBS_SOLD TO MTOT_LBS
GOTO TOP

MTITLE = ' - PRODUCT POUNDS SUMMARY'
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
MPAGE_NO = 0
MLINE = 99 

SUM LBS_SOLD FOR VAL(PROD_DESC) >=1000 .AND. VAL(PROD_DESC) <= 1999 TO M01      
SUM LBS_SOLD FOR VAL(PROD_DESC) >=2000 .AND. VAL(PROD_DESC) <= 2199 TO M02      
SUM LBS_SOLD FOR VAL(PROD_DESC) >=2200 .AND. VAL(PROD_DESC) <= 2299 TO M03       
SUM LBS_SOLD FOR VAL(PROD_DESC) >=2300 .AND. VAL(PROD_DESC) <= 2399 TO M04
SUM LBS_SOLD FOR VAL(PROD_DESC) >=2500 .AND. VAL(PROD_DESC) <= 2599 TO M05
SUM LBS_SOLD FOR VAL(PROD_DESC) >=2600 .AND. VAL(PROD_DESC) <= 2699 TO M06
SUM LBS_SOLD FOR VAL(PROD_DESC) >=3000 .AND. VAL(PROD_DESC) <= 3999 TO M07
SUM LBS_SOLD FOR VAL(PROD_DESC) >=4000 .AND. VAL(PROD_DESC) <= 4999 TO M08
SUM LBS_SOLD FOR VAL(PROD_DESC) >=5000 .AND. VAL(PROD_DESC) <= 5999 TO M09
SUM LBS_SOLD FOR VAL(PROD_DESC) >=6000 .AND. VAL(PROD_DESC) <= 6999 TO M10       
SUM LBS_SOLD FOR VAL(PROD_DESC) >=7000 .AND. VAL(PROD_DESC) <= 7999 TO M11
SUM LBS_SOLD FOR VAL(PROD_DESC) >=8000 .AND. VAL(PROD_DESC) <= 8999 TO M12
SUM LBS_SOLD FOR VAL(PROD_DESC) >=9000 .AND. VAL(PROD_DESC) <= 9999 TO M13
IF MDISP_PRT = 'P'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON
   
   *** PRINT IN 10 CPI
   ?? chr(27) + '&k0S'
   
   *** LETTER GOTHIC AND BOLDED PRINT
   ?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'
   
   *** LETTER SIZE PAPER
   ?? CHR(27) + '&l2A'
   
   *** PORTRAIT MODE
   ?? CHR(27) + '&l0O'
   
ENDIF

I = 1
DO WHILE I <= 13
   IF MLINE > MPAGE_LEN
      IF MDISP_PRT <> 'P'
         IF MLINE = 99 
            CLEAR
         ELSE
            STORE ' ' TO MWAIT
            @ 24,0 SAY 'Press Return to Continue Report ' GET MWAIT
            READ
            CLEAR    
         ENDIF
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      @ 1,27 SAY MCOMPANY
      @ 2,1 SAY 'Page'
      @ 2,06 say mpage_no picture '99'
      MWORD = 'POUNDS SOLD/SHIPPED SUMMARY'
      @ 2,17 SAY MWORD + ' FOR ' + DTOC(MSTART) + ' - ' + DTOC(MLAST)
      @ 2,80 SAY DTOC(DATE())
      @ 3,80 SAY TIME()
      @ 5,0 SAY 'PRODUCT GROUP DESCRIP       LBS SOLD    % OF LBS '
      IF MDISP_PRT = 'P'
         @ 5,0 SAY REPLICATE('_',80)
      ENDIF
      MLINE = 7
   ENDIF
   MI = SUBSTR(STR(I+100,3),2)
   IF M&MI = 0
      I = I + 1
      LOOP
   ENDIF
   DO CASE
   CASE I = 1
      @ MLINE,0 SAY 'WHOLE BIRDS'          
   CASE I = 2
      @ MLINE,0 SAY 'BREAST'             
   CASE I = 3
      @ MLINE,0 SAY 'WINGS'             
   CASE I = 4
      @ MLINE,0 SAY 'LEGS'             
   CASE I = 5
      @ MLINE,0 SAY 'THIGHS'           
   CASE I = 6
      @ MLINE,0 SAY 'DRUMSTICK'       
   CASE I = 7
      ****@ MLINE,0 SAY 'BY PRODUCTS'     
      SELECT C
      SEEK '3' 
      DO WHILE .NOT. EOF() .AND. SUBSTR(PROD_DESC,1,1) = '3'
         SELECT D
         SEEK 'R' + C->PROD_DESC
         IF .NOT. EOF()
            @ MLINE,0 SAY SUBSTR(DESC,1,22)   
         ELSE
            @ MLINE,0 SAY 'NOT ON FILE - ' + C->PROD_DESC
         ENDIF
         SELECT C
         @ MLINE,21 SAY LBS_SOLD PICTURE '999,999,999,999'
         @ MLINE,43 SAY ROUND((LBS_SOLD / MTOT_LBS) * 100,1) PICTURE '99.9'
         MLINE = MLINE + 2
         SKIP
      ENDDO
      I = I + 1
      LOOP
   CASE I = 8
      @ MLINE,0 SAY 'RAW PROCESSED'   
   CASE I = 9
      @ MLINE,0 SAY 'COOKED PROCESSED'
   CASE I = 10
      @ MLINE,0 SAY 'ROASTERS'           
   CASE I = 11
      @ MLINE,0 SAY 'FOWL'           
   CASE I = 12
      @ MLINE,0 SAY 'TURKEY'         
   CASE I = 13
      @ MLINE,0 SAY 'MISCELLANEOUS'  
   OTHERWISE
      @ MLINE,0 SAY 'PRODUCT NOT ON FILE'
   ENDCASE
   @ MLINE,21 SAY M&MI  PICTURE '999,999,999,999'
   @ MLINE,43 SAY ROUND((M&MI / MTOT_LBS) * 100,1) PICTURE '99.9'
   MLINE = MLINE + 2
   I = I + 1
ENDDO
MLINE = MLINE + 1

@ MLINE,0 SAY 'PRODUCT TOTALS'
@ MLINE,21 SAY MTOT_LBS   PICTURE '999,999,999,999'

IF MDISP_PRT = 'P'
   MLINE = MLINE + 1
   @ MLINE+1,1 say ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
   
ELSE
   MPRT_SEL = ' '
   @ 24,00 SAY 'End Of Report - Press Return to Continue ' GET MPRT_SEL
   READ
ENDIF
CLOSE DATA

RETURN
*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 11:01 AM.
