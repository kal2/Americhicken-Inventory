**********
* Program.: FRT_VIEW.PRG
* Author..: Grace Keller
* Date....: 10/20/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: FREIGHT/COMMISSION/TOTALS VIEW
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
MTOT_QTY = 0
DO HEAD_TOT
*IF .NOT. MLAST_PG
*   DO FRT_VW 
*ENDIF

SELECT A
DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
IF MCOM_CODE <> SPACE(2)
   SEEK MCOM_CODE
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME
   ELSE  
      STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME
   ENDIF
ELSE
   STORE SPACE(25) TO MCOM_NAME
ENDIF
IF MCOM_CODE2 <> SPACE(2)
   SEEK MCOM_CODE2
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME2
   ELSE  
      STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME2
   ENDIF
ELSE
   STORE SPACE(25) TO MCOM_NAME2
ENDIF
IF MCOM_CODE3 <> SPACE(2)
   SEEK MCOM_CODE3
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,25) TO MCOM_NAME3
   ELSE  
      STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME3
   ENDIF
ELSE
   STORE SPACE(25) TO MCOM_NAME3
ENDIF
SELECT A
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
IF MSALESMAN <> SPACE(2)
   
   SEEK MSALESMAN
   IF .NOT. EOF()
      STORE NAME TO MSAL_NAME
      STORE SALE_PERC TO MSALE_PERC
      IF DTOC(EFF_DT2) <> '  /  /  '
         IF B->SHIP_DATE >= EFF_DT2
            MSALE_PERC = SALE_PER2
         ENDIF
      ENDIF
      IF DTOC(EFF_DT3) <> '  /  /  '
         IF B->SHIP_DATE >= EFF_DT3
            MSALE_PERC = SALE_PER3
         ENDIF
      ENDIF
   ELSE
      STORE 'SALESPERSON NOT ON FILE         ' TO MSAL_NAME
      STORE 0 TO MSALE_PERC
   ENDIF
ELSE
   STORE SPACE(32) TO MSAL_NAME
   STORE 0 TO MSALE_PERC
ENDIF
IF MSAL_CODE2 <> SPACE(2)
   **RON MONTGOMERY CHANGES
   SELECT A
   **DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
   DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
   SEEK MSAL_CODE2
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,26) TO MSAL_NAME2
   ELSE
      STORE SPACE(26) TO MSAL_NAME2
   ENDIF
ELSE
   STORE SPACE(26) TO MSAL_NAME2  
ENDIF
IF MSAL_CODE3 <> SPACE(2)
   SELECT A
   DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
   SEEK MSAL_CODE3
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,26) TO MSAL_NAME3
   ELSE
      STORE SPACE(26) TO MSAL_NAME3
   ENDIF
ELSE
   STORE SPACE(26) TO MSAL_NAME3  
ENDIF

IF B->MISC_FLG <> ' '
   SELECT E
   DO FOX_USE WITH "MISC_CHG INDEX MISC_CHG", .F.
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   IF .NOT. EOF()
      STORE MISCREAS1 TO MMISCREAS1
      STORE MISCREAS2 TO MMISCREAS2
      STORE MISCREAS3 TO MMISCREAS3
      STORE MISCAMT1 TO MMISCAMT1, SMISCAMT1
      STORE MISCAMT2 TO MMISCAMT2, SMISCAMT2
      STORE MISCAMT3 TO MMISCAMT3, SMISCAMT3
      STORE MISCSPLT1 TO MMISCSPLT1
      STORE MISCSPLT2 TO MMISCSPLT2
      STORE MISCSPLT3 TO MMISCSPLT3
   ELSE
      STORE SPACE(10) TO MMISCREAS1, MMISCREAS2, MMISCREAS3
      STORE SPACE(1) TO MMISCSPLT1, MMISCSPLT2, MMISCSPLT3
      STORE 0 TO MMISCAMT1, MMISCAMT2, MMISCAMT3
      STORE 0 TO MNETSPLT1, MNETSPLT2, MNETSPLT3
   ENDIF
   
ELSE    
   STORE SPACE(10) TO MMISCREAS1, MMISCREAS2, MMISCREAS3
   STORE SPACE(1) TO MMISCSPLT1, MMISCSPLT2, MMISCSPLT3
   STORE 0 TO MMISCAMT1, MMISCAMT2, MMISCAMT3
   STORE 0 TO MNETSPLT1, MNETSPLT2, MNETSPLT3
ENDIF
IF MMISCAMT1 <> 0
   IF MMISCSPLT1 = 'X'
      MCOMSPLT1 = ROUND((MSALE_PERC * .01) * MMISCAMT1,2) 
      MNETSPLT1 = MMISCAMT1 - MCOMSPLT1
   ELSE 
      STORE 0 TO MCOMSPLT1
      STORE MMISCAMT1 TO MNETSPLT1
   ENDIF
ELSE  
   STORE 0 TO MNETSPLT1, MCOMSPLT1
ENDIF

IF MMISCAMT2 <> 0
   IF MMISCSPLT2 = 'X'
      MCOMSPLT2 = ROUND((MSALE_PERC * .01) * MMISCAMT2,2) 
      MNETSPLT2 = MMISCAMT2 - MCOMSPLT2
   ELSE 
      STORE 0 TO MCOMSPLT2
      STORE MMISCAMT2 TO MNETSPLT2
   ENDIF
ELSE
   STORE 0 TO MNETSPLT2, MCOMSPLT2
ENDIF

IF MMISCAMT3 <> 0
   IF MMISCSPLT3 = 'X'
      MCOMSPLT3 = ROUND((MSALE_PERC * .01) * MMISCAMT3,2) 
      MNETSPLT3 = MMISCAMT3 - MCOMSPLT3
   ELSE 
      STORE 0 TO MCOMSPLT3
      STORE MMISCAMT3 TO MNETSPLT3
   ENDIF
ELSE
   STORE 0 TO MNETSPLT3, MCOMSPLT3
ENDIF
***WRITEOFF
IF B->SUP_REAS1 = 'WRIT' .OR. B->SUP_REAS2 = 'WRIT' .OR. MFRT1_RS1 = 'WRIT' .OR. MFRT1_RS2 = 'WRIT' .OR. B->CUS_REAS1 = 'WRIT' .OR. B->CUS_REAS2 = 'WRIT'
   MWRITEOFF = .T.
ELSE
   MWRITEOFF = .F.
ENDIF
MTITLE = MPROGRAM + ' - VIEW PURCHASE ORDER'    
SET PROC TO NEW_PROC 
STORE MTOT_NET TO MNET

DO SAYTOT1  
DO SAYTOT8
@ 12,57 SAY MCOMSPLT1 PICTURE '99999.99'
@ 12,68 SAY MNETSPLT1 PICTURE '99999.99'
@ 13,57 SAY MCOMSPLT2 PICTURE '99999.99'
@ 13,68 SAY MNETSPLT2 PICTURE '99999.99'
**@ 13,57 SAY MCOMSPLT3 PICTURE '99999.99'
**@ 13,68 SAY MNETSPLT3 PICTURE '99999.99'
DO SAYTOT9 

IF MWRITEOFF
   @ 22,70 SAY '(WO)'
ENDIF
STORE 1 TO MACTION
@ 24,0 SAY 'Action: ' + STR(MACTION,1)
@ 24,12 SAY '1. Finished With View     2. Previous Pg.    3. Update Notes'
@ 24,8 GET MACTION PICTURE '#' RANGE 1,3
READ
IF MACTION = 3
   SAVE SCREEN TO MGRACE
   DO UPDNOTES
   RESTORE SCREEN FROM MGRACE
   STORE 1 TO MACTION
   @ 24,0 CLEAR
   @ 24,0 SAY 'Action: '
   @ 24,12 SAY '1. Finished With View     2. Previous Pg.'
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,2
   READ
ENDIF
DO CASE
CASE MACTION = 1
   MGOTO_PG = 99
CASE MACTION = 2
   MGOTO_PG = 4
ENDCASE
SET PROC TO PO_PROC 
RETURN
* EOF: FRT_VIEW.PRG
*Formatted by: ToolBox Ver. 1.2  on 8/8/91 at 11:22 AM.
