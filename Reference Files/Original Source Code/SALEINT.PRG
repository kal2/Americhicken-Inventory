***************
* Program.: SALEINT.PRG
* Author..: GRACE KELLER
* Date....: 03/21/91
* Notice..: Copyright (C) 1991, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: SALESPERSON INTEREST COMPARISON
*
MTITLE = ' - INTEREST COMPARISON REPORT'   
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
MCHOICE = ' '
STORE 'P' TO MANS
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   
   @ 11,2 SAY  'Calculate (C) or Print (P) ' get mans picture '@!'
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report/Finished'             
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
ENDDO
IF MACTION = 3
   RETURN
ENDIF
DO CASE
CASE MANS = 'P'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON
   
   *** PRINT IN 12 CPI
   ?? chr(27) + '&k4S'
   
   *** LETTER GOTHIC AND BOLDED PRINT
   ?? chr(27) + '(s4102T' + chr(27) + '(s3B'
   
   *** LANDSCAPE MODE
   ?? CHR(27) + '&l1O'
   
   *** LEGAL SIZE PAPER
   ?? CHR(27) + '&l3A'
   
   SELECT A
   DO FOX_USE WITH "TOTALS INDEX TMP_TOT", .F.
   
   @ 2,78 SAY DTOC(DATE())
   @ 2,32 SAY MCOMPANY                  
   
   @ 3,28 SAY 'INTEREST CALCULATION COMPARISONS'
   @ 4,11 SAY  'DATES: ' + DTOC(BEG_DATE) + ' THRU ' + DTOC(END_DATE) + ' INTEREST CALCULATED AT ' + TRANSFORM(INT_RATE, '99.99') + ' %'
   
   @ 7,1 SAY 'SALESPERSON/OFFICE         TOTAL NET    INT. GAIN    INT. LOSS     TOTAL INT.     NET - INT.   INT/NET %'
   **XXXXXXXXXXXXXXX      999,999,999.99   999,999.99  9,999,999.99   9,999,999.99   9,999,999.99    999.9999
   **1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456
   **         10        20        30        40        50        60        70        80        90        100
   @ 8,01 SAY REPLICATE('_',104)
   MLINE = 10 
   
   SELECT B 
   DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
   
   DO WHILE .NOT. EOF()
      STORE NAME TO MNAME
      STORE SALE_CODE TO MCODE
      SELECT A
      SEEK MCODE
      IF EOF()
         SELECT B
         SKIP
         LOOP
      ENDIF
      
      SUM NET TO MNET FOR SALESMAN = MCODE
      SUM CALC_INT TO MINT_GAIN FOR SALESMAN = MCODE .AND. CALC_INT < 0
      SUM CALC_INT TO MINT_LOSS FOR SALESMAN = MCODE .AND. CALC_INT > 0
      
      @ MLINE,1 SAY SUBSTR(MNAME,1,15)        
      @ MLINE,22 SAY MNET PICTURE '999,999,999,999'
      MINT_GAIN = ROUND(MINT_GAIN,0)
      @ MLINE,39 SAY MINT_GAIN* -1 PICTURE '999,999,999'
      MINT_LOSS = ROUND(MINT_LOSS,0)
      @ MLINE,54 SAY MINT_LOSS* -1 PICTURE '9,999,999'
      @ MLINE,69 SAY (MINT_GAIN+MINT_LOSS) * -1 PICTURE '9,999,999'
      @ MLINE,84 SAY MNET - (MINT_GAIN+MINT_LOSS) PICTURE '9,999,999'
      @ MLINE,97 SAY ((MINT_GAIN+MINT_LOSS)/MNET) * 100 PICTURE '999.9999'
      
      MLINE = MLINE + 3
      
      SELECT B
      SKIP
   ENDDO
   
   MLINE = MLINE + 1
   
   @ MLINE+1,0 SAY ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
   CLOSE DATA
OTHERWISE
   MTITLE = ' - INTEREST COMPARISON REPORTS'   
   CLEAR
   @  1, 1  SAY MCOMPANY
   @  1,68 SAY DATE()
   @  2, 0 SAY MPROGRAM + MTITLE
   @ 3,0 TO 22,79
   **** GET FIRST AND LAST DATES FOR THIS REPORT
   STORE CTOD('') TO MBEG_DATE, MEND_DATE                 
   STORE '**'     TO MOPT_SALES
   STORE SPACE(4) TO MOPT_CUST
   STORE 'N' TO MYES_NO
   MINT_RATE = 0
   @ 7,2 say  '            STARTING SHIP DATE: '                 
   @ 9,2 SAY  '              ENDING SHIP DATE: '      
   @ 11,2 SAY '          ANNUAL INTEREST RATE:'
   @ 13,2 SAY '   (OPTIONAL) SALESPERSON CODE: '
   @ 15,2 SAY 'SELECT SPECIFIC CUSTOMER (Y/N): ' 
   STORE 'PLEASE SELECT REPORT OPTIONS....' TO MGET
   @ 20,16 GET MGET
   CLEAR GETS
   STORE 2 TO MACTION      
   DO WHILE MACTION = 2      
      @ 07,36 GET MBEG_DATE
      @ 09,36 GET MEND_DATE            
      @ 11,36 GET MINT_RATE PICTURE '##.##'
      @ 13,36 GET MOPT_SALES PICTURE '##'
      @ 15,36 GET MYES_NO PICTURE '@!'     
      STORE 1 TO MACTION
      @ 24,00 CLEAR
      @ 24,01 SAY 'Action: ' + STR(MACTION,1)
      @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report/Finished'             
      
      READ
      
      @24,09 GET MACTION PICTURE '9' RANGE 1,3
      READ               
      
      IF MACTION = 1
         IF MEND_DATE < MBEG_DATE .OR DTOC(MEND_DATE) = '  /  /  ' .OR. DTOC(MBEG_DATE) = '  /  /  '
            @ 23,0 CLEAR
            mwait = ' '
            @ 23,1 SAY 'Dates Invalid or Blank'                                          
            @ 24,1 say 'Press Any Key to Reenter ' get mwait
            READ
            MACTION = 2
            @ 23,0 clear
            RETURN
         ENDIF
      ENDIF
   ENDDO
   IF MACTION = 3
      MNOT_DONE = .F.
      RETURN
   ENDIF  
   IF MYES_NO = 'Y'
      SAVE SCREEN TO MGRACE
      MNAME_FD = .F.
      DO BBUYSEL3
      RESTORE SCREEN FROM MGRACE
      IF MNAME_FD
         STORE BBUYCODE TO MOPT_CUST
         @ 16,2 SAY 'CUSTOMER SELECTED: ' +  MNAME 
      ELSE
         @ 16,2 SAY 'NO CUSTOMER SELECTED'
      ENDIF
   ENDIF
   
   @ 20,1 SAY SPACE(77)
   @ 20,16 SAY 'PROCESSING........'
   MLINE = 99
   SELECT C
   DO FOX_USE WITH "PAYMENTS INDEX PAY_PO", .F.
   SELECT D
   DO FOX_USE WITH "DISBJRN INDEX DISB_PO", .F.
   SELECT A 
   DO FOX_USE WITH "PO_HEAD INDEX  PO_SHIP", .F.
   SELECT B 
   DO FOX_USE WITH "TOTALS", .F.
   DO FILELOCK
   USE TOTALS EXCLUSIVE
   DELETE ALL
   PACK
   INDEX ON SALESMAN + CODE TO TMP_TOT
   DO FOX_USE WITH "TOTALS INDEX TMP_TOT", .F.
   
   SELECT A
   SEEK STR(YEAR(MBEG_DATE),4) + SUBSTR(DTOC(MBEG_DATE),1,2)
   
   DO WHILE .NOT. EOF() .AND. SHIP_DATE < MBEG_DATE
      SKIP
   ENDDO
   DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MEND_DATE
      IF MOPT_SALES <> '**'
         IF SALESMAN <> MOPT_SALES
            SKIP
            LOOP
         ENDIF
      ENDIF
      IF MOPT_CUST <> '    '
         IF BBUYCODE <> MOPT_CUST
            SKIP
            LOOP
         ENDIF
      ENDIF
      IF RSUPCODE = 'I' .OR. RSUPCODE = 'NONE' .OR. TOT_PURCH+SUP_PALL = 0
         SKIP
         LOOP
      ENDIF
      IF BBUYCODE = 'I' .OR. BBUYCODE = 'NONE' .OR. TOT_SELL+CUS_PALL = 0
         SKIP
         LOOP
      ENDIF
      
      IF SALESMAN = '  '
         DO CASE
         CASE BROK_NAME = 'KEN' .OR. BROK_NAME = ' KEN'
            MSALESMAN = '02'
         CASE BROK_NAME = 'BOB' .OR. BROK_NAME = ' BOB'
            MSALESMAN = '01'
         OTHERWISE
            MSALESMAN = '  '
         ENDCASE
      ELSE
         MSALESMAN = SALESMAN
      ENDIF
      
      SELECT B
      DO FILELOCK
      APPEND BLANK
      REPLACE SALESMAN WITH MSALESMAN
      REPLACE PO_NBR   WITH A->PO_NBR
      REPLACE PO_SUFFIX WITH A->PO_SUFFIX
      REPLACE SHIP_DATE WITH A->SHIP_DATE
      REPLACE BEG_DATE WITH MBEG_DATE
      REPLACE END_DATE WITH MEND_DATE
      REPLACE INT_RATE WITH MINT_RATE
      REPLACE NET      WITH A->TOT_NET
      REPLACE BBUYCODE WITH A->BBUYCODE
      REPLACE RSUPCODE WITH A->RSUPCODE
      REPLACE TOT_SELL WITH (A->TOT_SELL + A->CUS_PALL)
      REPLACE TOT_PURCH WITH (A->TOT_PURCH+A->SUP_PALL+A->BILL_ADJ)
      UNLOCK
      SELECT C
      SEEK A->SALESMAN+A->PO_NBR+A->PO_SUFFIX
      DO WHILE .NOT. EOF() .AND. A->SALESMAN = SALESMAN .AND. A->PO_NBR = PO_NBR .AND. A->PO_SUFFIX = PO_SUFFIX
         IF AMT_PAID <> 0
            SELECT B
            DO RECLOCK
            REPLACE CUS_PAID WITH C->PAID_DATE
            UNLOCK
            SELECT C
            GOTO BOTTOM
         ENDIF
         SKIP
      ENDDO
      
      SELECT D
      SEEK A->SALESMAN+A->PO_NBR+A->PO_SUFFIX
      DO WHILE .NOT. EOF() .AND. A->SALESMAN = SALESMAN .AND. A->PO_NBR = PO_NBR .AND. A->PO_SUFFIX = PO_SUFFIX
         IF CATEGORY1 = 'P'    
            SELECT B
            DO RECLOCK
            REPLACE SUP_PAID WITH CTOD(D->JRNL_MO+'/'+D->JRNL_DAY+'/'+D->JRNL_YR)
            UNLOCK
            SELECT D
            GOTO BOTTOM
         ENDIF
         SKIP
      ENDDO
      
      *** IF NOT SUP PAID OR CUST PAID - DONT LOOK AT
      SELECT B
      IF DTOC(SUP_PAID) = '  /  /  ' .OR. DTOC(CUS_PAID) = '  /  /  '
         DO RECLOCK
         DELETE
         UNLOCK
      ELSE
         *** CALCULATE INTEREST ACCRUED ** BOTH POSITIVE (TO PAY)
         ***                               AND  NEGATIVE (CUST PAID BEFORE SUP)
         MNBR_DAYS = CUS_PAID - SUP_PAID
         MDAILY_INT = (TOT_PURCH * (MINT_RATE/100))/365
         MINTEREST  = MDAILY_INT * MNBR_DAYS
         DO RECLOCK
         REPLACE CALC_INT WITH MINTEREST
         UNLOCK
      ENDIF
      SELECT A
      SKIP
   ENDDO
   SET PRINT OFF
   
   CLOSE ALL
   
ENDCASE

RETURN

*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 3:56 PM.
