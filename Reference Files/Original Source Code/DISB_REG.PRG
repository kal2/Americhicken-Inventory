**********
* Program.: DISB_REG.PRG
* Author..: GRACE KELLER
* Date....: 03/21/88
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: DISBURSEMENT DAILY REGISTER     
*

MTITLE = ' - DAILY DISBURSEMENT REGISTER'

CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET DATE FOR THIS REPORT
STORE DATE() TO MDATE
STORE 'D' TO MDISP_PRT
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 10,5 SAY '            ENTER REPORT DATE: '
   @ 10,37 GET MDATE
   
   STORE 1 TO MACTION
   @ 23,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MDATE) = '  /  /  '
         @ 24,0 CLEAR
         mwait = ' '
         @ 24,1 SAY 'NO DATE ENTERED - PRESS ANY KEY TO REENTER' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 CLEAR
         LOOP 
      ENDIF
   ENDIF
ENDDO

IF MACTION = 3
   RETURN
ENDIF  
MACTION = 'C'

DO PRT_SET

IF MACTION <> 'C'
   RETURN
ENDIF
STORE MONTH(MDATE) TO MMONTH
MMONTH = MMONTH + 100
STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH

STORE YEAR(MDATE) TO MYEAR
STORE STR(MYEAR,4) TO MYEAR

STORE DAY(MDATE) TO MDAY
MDAY = MDAY + 100
STORE SUBSTR(STR(MDAY,3),2) TO MDAY

MPAGE_LEN = 56

SELECT B
DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
SELECT C
DO FOX_USE WITH "&MDBFLOC.FREIGHT INDEX &MDBFLOC.FRT_CODE", .F.
SELECT D
DO FOX_USE WITH "&MMASTDBF.ACCOUNTS INDEX &MMASTDBF.ACCOUNTS", .F.

SELECT A
DO FOX_USE WITH "DISBJRN INDEX DISBJRN", .F.
SEEK MYEAR + MMONTH + MDAY
IF EOF()
   @ 4,1 CLEAR TO 21,78 
   @ 10,5 SAY 'THERE IS NO DISBURSEMENT DATA ON FILE FOR THIS DATE'
   STORE ' ' TO MWAIT
   @ 12,5 SAY 'PRESS ANY KEY TO CONTINUE ' GET MWAIT
   READ
   RETURN
ENDIF

MPAGE_NO = 0
MLINE = 99 
SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 12 CPI
?? chr(27) + '&k4S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

MDAILY_TOT = 0
DO WHILE .NOT. EOF() .AND. JRNL_MO = MMONTH .AND. JRNL_DAY = MDAY .AND. JRNL_YR = MYEAR
   IF MLINE > MPAGE_LEN
      IF MLINE <> 99
         IF MDISP_PRT = 'P'
            EJECT
         ENDIF
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      @ 1,37 SAY MCOMPANY
      @ 2,1 SAY 'PAGE'
      @ 2,06 say mpage_no picture '99'
      @ 2,23 SAY 'DAILY DISBURSEMENT REGISTER FOR ' + DTOC(MDATE)
      @ 2,88 SAY DTOC(DATE())
      @ 4,1 SAY ' CHK NBR  INV NBR    PO NBR     PAYEE                   SUP INVOICE        AMOUNT     ACCOUNT'
      *          123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456
      *                   10        20        30        40        50        60        70        80        90
      @ 5,0 SAY REPLICATE ('_',96)
      MLINE = 7
   ENDIF
   IF VOID_MAN <> ' '
      @ MLINE,0 SAY '*V*'      
   ENDIF
   @ MLINE,3 SAY CK_NBR
   IF SALESMAN <> SPACE(2)
      @ MLINE,11 SAY SALESMAN + '-'
   ENDIF
   @ MLINE,14 SAY INV_NBR
   IF SALESMAN <> SPACE(2)
      @ MLINE,22 SAY SALESMAN + '-'
   ENDIF
   @ MLINE,25 SAY PO_NBR
   IF PO_SUFFIX <> ' '
      @ MLINE,29 SAY '-' + PO_SUFFIX
   ENDIF
   
   DO CASE
   CASE ACCT_TYPE = 'S'
      SELECT B
      SEEK A->ACCT_NBR
      IF EOF()
         STORE 'PAYEE NOT ON FILE' TO MNAME
      ELSE
         STORE NAME TO MNAME
      ENDIF
      @ MLINE,33 SAY SUBSTR(MNAME,1,20)
      SELECT A
   CASE ACCT_TYPE = 'F'
      SELECT C 
      SEEK A->ACCT_NBR
      IF EOF()
         STORE 'PAYEE NOT ON FILE' TO MNAME
      ELSE
         STORE NAME TO MNAME
      ENDIF
      @ MLINE,33 SAY SUBSTR(MNAME,1,20)
      SELECT A
   CASE ACCT_TYPE = 'O'
      IF ACCT_NAME = SPACE(25)
         @ MLINE,33 SAY 'NONE'
      ELSE
         @ MLINE,33 SAY SUBSTR(ACCT_NAME,1,20)
      ENDIF
   ENDCASE
   @ MLINE,57 SAY BILL_INV
   IF ACCT_TYPE = 'P'
      @ MLINE,72 SAY AMOUNT1 + AMOUNT2 + AMOUNT3 + AMOUNT4 PICTURE '999,999.99'
   ELSE
      @ MLINE,72 SAY AMOUNT1 PICTURE '999,999.99'
   ENDIF
   IF VOID_MAN <> 'V'
      MDAILY_TOT = MDAILY_TOT + AMOUNT1
   ENDIF
   SELECT D
   SEEK A->CATEGORY1
   IF .NOT. EOF()
      @ MLINE,84 SAY SUBSTR(CK_DESC,1,15)
   ELSE
      IF A->CATEGORY1 <> SPACE(4)
         @ MLINE,84 SAY 'MISCELLANEOUS'     
      ENDIF
   ENDIF
   SELECT A
   IF ACCT_TYPE = 'P'
      MLINE = MLINE + 1
      @ MLINE,72 SAY AMOUNT2 PICTURE '999,999.99'
      @ MLINE,84 SAY 'FICA'
      MLINE = MLINE + 1
      @ MLINE,72 SAY AMOUNT3 PICTURE '999,999.99'
      @ MLINE,84 SAY 'FED TAX'
      MLINE = MLINE + 1
      @ MLINE,72 SAY AMOUNT4 PICTURE '999,999.99'
      @ MLINE,84 SAY 'MO TAX'
      MLINE = MLINE + 1
      @ MLINE,72 SAY AMOUNT1 PICTURE '999,999.99'
      @ MLINE,84 SAY 'BANK'
   ENDIF
   MLINE = MLINE + 2
   SKIP
ENDDO   

MLINE = MLINE + 1
IF MLINE > MPAGE_LEN
   IF MLINE <> 99
      IF MDISP_PRT = 'P'
         EJECT
      ENDIF
   ENDIF
   MPAGE_NO = MPAGE_NO + 1
   @ 1,37 SAY MCOMPANY
   @ 2,0 SAY 'PAGE'
   @ 2,05 say mpage_no picture '99'
   @ 2,23 SAY 'DAILY DISBURSEMENT REGISTER FOR ' + DTOC(MDATE)
   @ 2,88 SAY DTOC(DATE())
   @ 4,1 SAY ' CHK NBR  INV NBR    PO NBR     PAYEE                    SUP INVOICE    AMOUNT     ACCOUNT'
   @ 5,0 SAY REPLICATE ('_',96)
   MLINE = 7
ENDIF

@ MLINE,33 SAY 'TOTAL CHECKS:'
@ MLINE,72 SAY MDAILY_TOT PICTURE '999,999.99'
MLINE = MLINE + 1
@ mline+1,1 say ' '
EJECT
SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF
CLOSE DATA

RETURN

* EOF: DISB_REG.PRG
*Formatted by: ToolBox Ver. 1.2  on 7/22/14 at 2:56 PM.
