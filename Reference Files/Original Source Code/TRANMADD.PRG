**********
* Program.: TRANMADD.PRG
* Author..: Grace Keller
* Date....: 06/12/95
* Notice..: Copyright 1995, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: MISCELLANEOUS ADJUSTMENTS - TRANSMITTED ORDERS
*
* ---OPEN FILES
MTITLE =  ' - ADD MISCELLANEOUS ADJUSTMENTS'
STORE SPACE(15) TO MSUP_REAS1, MSUP_REAS2, MCUS_REAS1, MCUS_REAS2
STORE 0 TO MSUP_AMT1, MSUP_AMT2, MCUS_AMT1, MCUS_AMT2, MWRITEOFF
STORE 0 TO MSUP_PALL, MCUS_PALL
STORE SPACE(60) TO MINV_COMMT, MSUP_COMMT
SELECT F
IF MTRAN_SALE = '  '
   DO FOX_USE WITH "TRAN_PO", .F.
ELSE
   MFILE = 'TRAN_P' + MTRAN_SALE
   DO FOX_USE WITH "&MFILE", .F.
ENDIF

IF SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
   STORE SUP_REAS1 TO MSUP_REAS1
   STORE SUP_REAS2 TO MSUP_REAS2
   STORE CUS_REAS1 TO MCUS_REAS1
   STORE CUS_REAS2 TO MCUS_REAS2
   STORE SUP_AMT1  TO MSUP_AMT1
   STORE SUP_AMT2  TO MSUP_AMT2
   STORE CUS_AMT1  TO MCUS_AMT1
   STORE CUS_AMT2  TO MCUS_AMT2
   STORE SUP_PALL  TO MSUP_PALL
   STORE CUS_PALL  TO MCUS_PALL
ENDIF
USE   

DO TEXTMISC
MMORE_MISC = .T.     

DO WHILE MMORE_MISC
   DO GETMISC
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   
   @ 24,13 SAY '1. Continue       2. Edit'
   READ
   IF MCOMPANY = 'DIVISION 70'
      IF MSUP_AMT1 < 0 .AND. MSUP_REAS1 <> 'LBS='
         @ 24,0 CLEAR 
         MCHOICE = ' '
         @ 24,1 SAY "WARNING: SUP CREDIT ENTERED & REASON NOT 'LBS=' FORMAT -CONT(C) OR EDIT(E)? " GET MCHOICE PICTURE '@!' VALID(MCHOICE = 'C' .OR. MCHOICE = 'E')
         READ
         @ 24,0 CLEAR
         IF MCHOICE = 'E'
            MACTION = 2
            LOOP
         ENDIF
      ENDIF
      
      IF MSUP_AMT2 < 0 .AND. MSUP_REAS2 <> 'LBS='
         @ 24,0 CLEAR 
         MCHOICE = ' '
         @ 24,1 SAY "WARNING: SUP CREDIT ENTERED & REASON NOT 'LBS=' FORMAT -CONT(C) OR EDIT(E)? " GET MCHOICE PICTURE '@!' VALID(MCHOICE = 'C' .OR. MCHOICE = 'E')
         READ
         @ 24,0 CLEAR
         IF MCHOICE = 'E'
            MACTION = 2
            LOOP
         ENDIF
      ENDIF
   ENDIF
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,2
   READ
   
   IF MACTION = 2
      LOOP 
   ENDIF
   SELECT B
   DO RECLOCK
   REPLACE SUP_REAS1 WITH MSUP_REAS1
   REPLACE SUP_REAS2 WITH MSUP_REAS2
   REPLACE SUP_AMT1 WITH MSUP_AMT1
   REPLACE SUP_AMT2 WITH MSUP_AMT2
   REPLACE CUS_REAS1 WITH MCUS_REAS1
   REPLACE CUS_REAS2 WITH MCUS_REAS2
   REPLACE CUS_AMT1 WITH MCUS_AMT1
   REPLACE CUS_AMT2 WITH MCUS_AMT2
   *  REPLACE INV_COMMT WITH MINV_COMMT
   REPLACE WRITEOFF WITH MWRITEOFF
   REPLACE SUP_PALL WITH MSUP_PALL
   REPLACE CUS_PALL WITH MCUS_PALL
   UNLOCK
   IF MINV_COMMT <> SPACE(60) .OR. MSUP_COMMT <> SPACE(60)
      SELECT F
      DO FOX_USE WITH "PRT_NOTE INDEX PRT_NOTE", .F.
      DO FILELOCK
      APPEND BLANK
      REPLACE SALESMAN WITH MSALESMAN
      REPLACE PO_NBR WITH MPO_NBR
      REPLACE PO_SUFFIX WITH MPO_SUFFIX
      REPLACE INV_COMMT WITH MINV_COMMT
      REPLACE SUP_COMMT WITH MSUP_COMMT
      UNLOCK
      USE 
      SELECT B
   ENDIF
   MMORE_MISC = .F.
ENDDO
RETURN
* EOF: TRANMADD.PRG
*Formatted by: ToolBox Ver. 1.2  on 2/6/96 at 5:46 PM.
