************
* Program.: JRN_PRT.PRG
* Author..: GRACE KELLER
* Date....: 02/10/88
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: SPREADSHEET DETAIL LISTING    
*

MTITLE = ' - SPREADSHEET DETAIL LISTING'

CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET DATE FOR THIS REPORT
STORE DATE() TO MDATE, MEND
STORE 'D' TO MDISP_PRT
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 10,5 SAY '   STARTING DATE: '
   @ 10,23 GET MDATE
   @ 12,5 SAY '     ENDING DATE: '
   @ 12,23 GET MEND
   STORE 1 TO MACTION
   @ 23,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MDATE) = '  /  /  '
         @ 24,0 CLEAR
         mwait = ' '
         @ 24,1 SAY 'NO DATE ENTERED - PRESS ANY KEY TO REENTER' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 CLEAR
         LOOP 
      ENDIF
   ENDIF
ENDDO

IF MACTION = 3
   RETURN
ENDIF  
MPRT_ACT = 'C'

DO PRT_132

IF MPRT_ACT <> 'C'
   RETURN
ENDIF
MPAGE_LEN = 56

STORE MONTH(MDATE) TO MMONTH
MMONTH = MMONTH + 100
STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH

STORE YEAR(MDATE) TO MYEAR
STORE STR(MYEAR,4) TO MYEAR

STORE DAY(MDATE) TO MDAY
MDAY = MDAY + 100
STORE SUBSTR(STR(MDAY,3),2) TO MDAY
STORE DAY(MEND) TO  MEND_DAY
MEND_DAY = MEND_DAY + 100
STORE SUBSTR(STR(MEND_DAY,3),2) TO MEND_DAY

SELECT A
DO FOX_USE WITH "DAILYJRN INDEX JRN_TRAN", .F.
SEEK MYEAR + MMONTH + MDAY
IF EOF()
   @ 4,1 CLEAR TO 21,78 
   @ 10,5 SAY 'THERE IS NO SPREADSHEET DATA ON FILE FOR THIS STARTING DATE'
   STORE ' ' TO MWAIT
   @ 12,5 SAY 'PRESS ANY KEY TO CONTINUE ' GET MWAIT
   READ
   RETURN
ENDIF

MPAGE_NO = 0
MLINE = 99 
MPAGE_LEN = 44
SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 12 CPI
?? chr(27) + '&k4S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'

*** LANDSCAPE MODE
?? CHR(27) + '&l1O'

*** LEGAL SIZE PAPER
?? CHR(27) + '&l3A'

STORE 0 TO MPURCH, MSELL, MCOMM, MGROSS, MTOTAL, MTOT_FRT
SEEK MYEAR + MMONTH + MDAY

DO WHILE .NOT. EOF() .AND. MYEAR = STR(YEAR(JRNL_DATE),4) .AND. VAL(MMONTH) = VAL(SUBSTR(DTOC(JRNL_DATE),1,2)) .and. VAL(SUBSTR(DTOC(JRNL_DATE),4,2)) <= VAL(MEND_DAY)
   
   IF MINVOICE
      ***** GETS THE INVOICES
      IF VAL(INV_NBR) < MNBR
         SKIP
         LOOP
      ENDIF
   ELSE
      ***** GETS THE CORRECTIONS
      IF VAL(INV_NBR) >= MNBR
         SKIP
         LOOP
      ENDIF
   ENDIF
   IF MLINE > MPAGE_LEN
      IF MLINE <> 99
         EJECT
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      @ 2,60 SAY MCOMPANY
      @ 3,1 SAY 'Page'
      @ 3,06 say mpage_no picture '99'
      @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND) 
      @ 3,128 SAY DTOC(DATE())
      @ 5,1 SAY 'INV NBR'
      @ 5,12 SAY 'P.O. NBR'
      @ 5,23 SAY 'DESCR'
      @ 5,31 SAY 'SUPPLIER'
      @ 5,44 SAY ' TOT PURCH'
      @ 5,56 SAY 'CUSTOMER'
      @ 5,70 SAY '  TOT SELL'
      @ 5,82 SAY '  FREIGHT'
      @ 5,97 SAY 'GROSS'
      @ 5,103 SAY '     COMM'
      @ 5,114 SAY 'BROKR'
      @ 5,129 SAY 'TOT NET'
      @ 5,01 SAY REPLICATE('_',135)
      MLINE = 7
   ENDIF
   
   STORE SALESMAN TO MSALESMAN
   STORE PO_NBR TO MPO_NBR
   STORE PO_SUFFIX TO MPO_SUFFIX
   STORE BBUYCODE TO MBBUYCODE
   STORE RSUPCODE TO MRSUPCODE
   
   SELECT B
   IF MRSUPCODE = 'NONE'
      STORE 'NONE' + SPACE(6) TO MRSUPNAME
   ELSE
      DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
      SEEK MRSUPCODE
      IF .NOT. EOF()
         STORE SUBSTR(NAME,1,12) TO MRSUPNAME
      ELSE 
         STORE 'NOT ON FILE ' TO MRSUPNAME
      ENDIF
   ENDIF
   IF MBBUYCODE = 'NONE'
      STORE 'NONE' + SPACE(56) TO MBBUYNAME
   ELSE  
      DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
      SEEK MBBUYCODE
      IF .NOT. EOF()
         STORE SUBSTR(NAME,1,12) TO MBBUYNAME
      ELSE 
         STORE 'NOT ON FILE ' TO MBBUYNAME
      ENDIF
   ENDIF
   IF MSALESMAN <> SPACE(2)
      DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
      SEEK MSALESMAN
      IF .NOT. EOF()
         STORE SUBSTR(NAME,1,10) TO MSAL_NAME
      ELSE
         STORE SPACE(10) TO MSAL_NAME
      ENDIF
   ELSE
      SELECT A
      STORE SUBSTR(BROK_NAME,1,10) TO MSAL_NAME
   ENDIF
   
   SELECT A
   IF SALESMAN <> SPACE(2)
      STORE SALESMAN + '-' + INV_NBR TO MINV_NBR
   ELSE 
      STORE INV_NBR + SPACE(3) TO MINV_NBR
   ENDIF
   IF SALESMAN <> SPACE(2)
      STORE SALESMAN + '-' + PO_NBR TO MPO_NBR
      IF PO_SUFFIX <> SPACE(1)
         MPO_NBR = MPO_NBR + '-' + PO_SUFFIX
      ENDIF
   ELSE
      STORE PO_NBR TO MPO_NBR
      IF PO_SUFFIX <> SPACE(1)
         MPO_NBR = MPO_NBR + '-' + PO_SUFFIX 
      ENDIF
   ENDIF
   
   @ MLINE,1 SAY MINV_NBR
   @ MLINE,12 SAY MPO_NBR
   IF BROKERAGE = 'X'
      @  MLINE,23 SAY 'BROKE'
   ELSE
      @ MLINE,23 SAY PROD
   ENDIF
   @ MLINE,31 SAY MBBUYNAME
   @ MLINE,44 SAY TOT_SELL PICTURE '999,999.99'
   @ MLINE,56 SAY MRSUPNAME
   @ MLINE,70 SAY TOT_PURCH PICTURE '999,999.99'
   MPURCH = MPURCH + TOT_PURCH
   MSELL = MSELL + TOT_SELL
   IF MPROG_CODE = 2
      MFRT_AMT = FRT_AMT1 + FRT_AMT2 + FRT_AMT3 
   ELSE
      MFRT_AMT = FRT_AMT1
   ENDIF
   @ MLINE,81 SAY MFRT_AMT PICTURE '999,999.99'
   MTOT_FRT = MTOT_FRT + MFRT_AMT
   @ MLINE,92 SAY GROSS PICTURE '999,999.99'
   MGROSS = MGROSS + GROSS
   @ MLINE,103 SAY SALE_COMM PICTURE '99,999.99'
   MCOMM = MCOMM + SALE_COMM
   @ MLINE,114 SAY MSAL_NAME
   @ MLINE,127 SAY TOT_NET PICTURE '99,999.99'
   MTOTAL = MTOTAL + TOT_NET
   IF COM_CODE <> SPACE(2) .AND. COMM_AMT <> 0
      STORE COM_CODE TO MCOM_CODE
      SELECT B
      DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
      
      SEEK MCOM_CODE
      IF .NOT. EOF()
         STORE NAME TO MCOM_NAME
      ELSE  
         STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME
      ENDIF
      SELECT A
      MLINE = MLINE + 2
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 2,60 SAY MCOMPANY
         @ 3,1 SAY 'Page'
         @ 3,06 say mpage_no picture '99'
         @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND)
         @ 3,128 SAY DTOC(DATE())
         @ 5,1 SAY 'INV NBR'
         @ 5,12 SAY 'P.O. NBR'
         @ 5,23 SAY 'DESCR'
         @ 5,31 SAY 'SUPPLIER'
         @ 5,44 SAY ' TOT PURCH'
         @ 5,56 SAY 'CUSTOMER'
         @ 5,70 SAY '  TOT SELL'
         @ 5,82 SAY '  FREIGHT'
         @ 5,97 SAY 'GROSS'
         @ 5,103 SAY '     COMM'
         @ 5,114 SAY 'BROKR'
         @ 5,129 SAY 'TOT NET'
         @ 5,01 SAY REPLICATE('_',135)
         MLINE = 7
      ENDIF
      @ MLINE,1 SAY MINV_NBR
      @ MLINE,103 SAY COMM_AMT PICTURE '99,999.99'
      MCOMM = MCOMM + COMM_AMT
      @ MLINE,114 SAY SUBSTR(MCOM_NAME,1,10)
   ENDIF
   
   IF COM_CODE2 <> SPACE(2) .AND. COMM_AMT2 <> 0
      STORE COM_CODE2 TO MCOM_CODE2
      SELECT B
      DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
      
      SEEK MCOM_CODE2
      IF .NOT. EOF()
         STORE NAME TO MCOM_NAME2
      ELSE  
         STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME2
      ENDIF
      SELECT A
      MLINE = MLINE + 2
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 2,60 SAY MCOMPANY
         @ 3,1 SAY 'Page'
         @ 3,06 say mpage_no picture '99'
         @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND)
         @ 3,128 SAY DTOC(DATE())
         @ 5,1 SAY 'INV NBR'
         @ 5,12 SAY 'P.O. NBR'
         @ 5,23 SAY 'DESCR'
         @ 5,31 SAY 'SUPPLIER'
         @ 5,44 SAY ' TOT PURCH'
         @ 5,56 SAY 'CUSTOMER'
         @ 5,70 SAY '  TOT SELL'
         @ 5,82 SAY '  FREIGHT'
         @ 5,97 SAY 'GROSS'
         @ 5,103 SAY '     COMM'
         @ 5,114 SAY 'BROKR'
         @ 5,129 SAY 'TOT NET'
         @ 5,01 SAY REPLICATE('_',135)
         MLINE = 7
      ENDIF
      @ MLINE,1 SAY MINV_NBR
      @ MLINE,103 SAY COMM_AMT2 PICTURE '99,999.99'
      MCOMM = MCOMM + COMM_AMT2
      @ MLINE,114 SAY SUBSTR(MCOM_NAME2,1,10)
   ENDIF
   
   IF COM_CODE3 <> SPACE(2) .AND. COMM_AMT3 <> 0
      STORE COM_CODE3 TO MCOM_CODE3
      SELECT B
      DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
      
      SEEK MCOM_CODE3
      IF .NOT. EOF()
         STORE NAME TO MCOM_NAME3
      ELSE  
         STORE '3RD PARTY COMM PAYEE NOT ON FILE' TO MCOM_NAME3
      ENDIF
      SELECT A
      MLINE = MLINE + 2
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 2,60 SAY MCOMPANY
         @ 3,1 SAY 'Page'
         @ 3,06 say mpage_no picture '99'
         @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND)
         @ 3,128 SAY DTOC(DATE())
         @ 5,1 SAY 'INV NBR'
         @ 5,12 SAY 'P.O. NBR'
         @ 5,23 SAY 'DESCR'
         @ 5,31 SAY 'SUPPLIER'
         @ 5,44 SAY ' TOT PURCH'
         @ 5,56 SAY 'CUSTOMER'
         @ 5,70 SAY '  TOT SELL'
         @ 5,82 SAY '  FREIGHT'
         @ 5,97 SAY 'GROSS'
         @ 5,103 SAY '     COMM'
         @ 5,114 SAY 'BROKR'
         @ 5,129 SAY 'TOT NET'
         @ 5,01 SAY REPLICATE('_',135)
         MLINE = 7
      ENDIF
      @ MLINE,1 SAY MINV_NBR
      @ MLINE,103 SAY COMM_AMT3 PICTURE '99,999.99'
      MCOMM = MCOMM + COMM_AMT3
      @ MLINE,114 SAY SUBSTR(MCOM_NAME3,1,10)
   ENDIF
   
   **RON MONTGOMERY CHANGES
   IF SAL_CODE2 <> SPACE(2) .AND. SALE2_AMT <> 0
      STORE SAL_CODE2 TO MSAL_CODE2
      SELECT B
      **DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
      DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
      SEEK MSAL_CODE2
      IF .NOT. EOF()
         STORE NAME TO MSAL_NAME2
      ELSE
         STORE 'SALESPERSON NOT ON FILE         ' TO MSAL_NAME2
      ENDIF
      SELECT A
      MLINE = MLINE + 2
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 2,60 SAY MCOMPANY
         @ 3,1 SAY 'Page'
         @ 3,06 say mpage_no picture '99'
         @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND)    
         @ 3,128 SAY DTOC(DATE())      
         @ 5,1 SAY 'INV NBR'
         @ 5,12 SAY 'P.O. NBR'
         @ 5,23 SAY 'DESCR'
         @ 5,31 SAY 'SUPPLIER'
         @ 5,44 SAY ' TOT PURCH'
         @ 5,56 SAY 'CUSTOMER'
         @ 5,70 SAY '  TOT SELL'
         @ 5,82 SAY '  FREIGHT'
         @ 5,97 SAY 'GROSS'
         @ 5,103 SAY '     COMM'
         @ 5,114 SAY 'BROKR'
         @ 5,129 SAY 'TOT NET'
         @ 5,01 SAY REPLICATE('_',135)
         MLINE = 7
      ENDIF
      @ MLINE,1 SAY MINV_NBR
      @ MLINE,103 SAY SALE2_AMT PICTURE '99,999.99'
      MCOMM = MCOMM + SALE2_AMT
      @ MLINE,114 SAY SUBSTR(MSAL_NAME2,1,10)
   ENDIF
   
   IF SAL_CODE3 <> SPACE(2) .AND. SALE3_AMT <> 0
      STORE SAL_CODE3 TO MSAL_CODE3
      SELECT B
      DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
      SEEK MSAL_CODE3
      IF .NOT. EOF()
         STORE NAME TO MSAL_NAME3
      ELSE
         STORE 'SALESPERSON NOT ON FILE         ' TO MSAL_NAME3
      ENDIF
      SELECT A
      MLINE = MLINE + 2
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 2,60 SAY MCOMPANY
         @ 3,1 SAY 'Page'
         @ 3,06 say mpage_no picture '99'
         @ 3,46 SAY 'DAILY SPREADSHEET DETAIL REPORT FOR ' + DTOC(MDATE) + ' - ' + DTOC(MEND)    
         @ 3,128 SAY DTOC(DATE())      
         @ 5,1 SAY 'INV NBR'
         @ 5,12 SAY 'P.O. NBR'
         @ 5,23 SAY 'DESCR'
         @ 5,31 SAY 'SUPPLIER'
         @ 5,44 SAY ' TOT PURCH'
         @ 5,56 SAY 'CUSTOMER'
         @ 5,70 SAY '  TOT SELL'
         @ 5,82 SAY '  FREIGHT'
         @ 5,97 SAY 'GROSS'
         @ 5,103 SAY '     COMM'
         @ 5,114 SAY 'BROKR'
         @ 5,129 SAY 'TOT NET'
         @ 5,01 SAY REPLICATE('_',135)
         MLINE = 7
      ENDIF
      @ MLINE,1 SAY MINV_NBR
      @ MLINE,103 SAY SALE3_AMT PICTURE '99,999.99'
      MCOMM = MCOMM + SALE3_AMT
      @ MLINE,114 SAY SUBSTR(MSAL_NAME3,1,10)
   ENDIF
   
   MLINE = MLINE + 2
   SKIP
ENDDO
@ MLINE,1 SAY 'TOTALS:'
@ MLINE,44 SAY MPURCH PICTURE '9999999.99'
@ MLINE,70 SAY MSELL PICTURE '9999999.99'
@ MLINE,82 SAY MTOT_FRT PICTURE '999999.99'
@ MLINE,92 SAY MGROSS PICTURE '9999999.99'
@ MLINE,103 SAY MCOMM PICTURE '999999.99'
@ MLINE,126 SAY MTOTAL PICTURE '9999999.99'
EJECT
**?? CHR(18)
**?? CHR(27) + 'M'
**?? CHR(27) + 'x' + CHR(1)
**?? CHR(27) + 'k' + CHR(2)

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

CLOSE DATA

RETURN

* EOF: JRN_PRT.PRG
*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 10:54 AM.
