**********
* Program.: NEW_INQ.PRG
* Author..: Grace Keller
* Date....: 03/21/89
* Notice..: Copyright 1990, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PURCHASE ORDER VIEW
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
SELECT A
USE
SELECT D
USE
SELECT E
USE
SELECT F
USE
SET PROC TO NEW_INQ 
SELECT B
MSALESMAN  = SALESMAN
MPO_NBR    = PO_NBR
MPO_SUFFIX = MPO_SUFFIX
MRSUPCODE  = RSUPCODE
MBBUYCODE  = BBUYCODE
MSHIP_DATE = SHIP_DATE
MTOT_LBS   = TOT_LBS
MINV_NBR   = INV_NBR
MBROK_NAME = BROK_NAME
MTOT_PURCH = TOT_PURCH
MSELL_ADJ  = CUS_AMT1 + CUS_AMT2 + CUS_PALL + WRITEOFF
MPURCH_ADJ = SUP_AMT1 + SUP_AMT2 + SUP_PALL
MPURCH_ADJ = MPURCH_ADJ + B->BILL_ADJ

MSUP_PALL  = SUP_PALL
MTOT_SELL  = TOT_SELL
MCUS_PALL  = CUS_PALL
MNET       = TOT_NET
MGROSS     = GROSS
MFRT_CODE  = FRT_CODE1
MFRT1_AMT  = FRT_AMT1 + FRT1_ADJ1 + FRT1_ADJ2            
MFRT_PALL  = FRT_PALL
MCUS_PAID  = PAID_FLG
MSUP_PAID  = SUP_PD
MFRT_PAID  = FRT_PD

MCOM_CODE  = COM_CODE
MCOMM_AMT  = COMM_AMT
MCOM_CODE2 = COM_CODE2
MCOMM_AMT2 = COMM_AMT2
MCOM_CODE3 = COM_CODE3
MCOMM_AMT3 = COMM_AMT3

MSALE_COMM = SALE_COMM

MSAL_CODE2 = SAL_CODE2
MSALE2_AMT = SALE2_AMT
MSALE2_NET = SALE2_NET

MSAL_CODE3 = SAL_CODE3
MSALE3_AMT = SALE3_AMT
MSALE3_NET = SALE3_NET

SELECT D
DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
SEEK MRSUPCODE
IF .NOT. EOF()
   STORE NAME TO MSUP_NAME
   STORE CITY TO MSUP_CITY       
   STORE STATE TO MSUP_STATE
ELSE
   MSUP_CITY  = SPACE(30)
   MSUP_STATE = SPACE(2)
   IF MRSUPCODE = 'NONE'
      MSUP_NAME  = 'NONE'                        
   ELSE
      MSUP_NAME = 'REMIT TO NOT ON FILE'
   ENDIF
ENDIF

DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
SEEK MBBUYCODE
IF .NOT. EOF()
   STORE NAME  TO MCUS_NAME
   STORE CITY  TO MCUS_CITY       
   STORE STATE TO MCUS_STATE
ELSE
   MCUS_CITY  = SPACE(30)
   MCUS_STATE = SPACE(2)
   IF MBBUYCODE = 'NONE'
      MCUS_NAME  = 'NONE' 
   ELSE
      MCUS_NAME = 'REMIT TO NOT ON FILE'
   ENDIF
ENDIF

STORE SPACE(30) TO MFRT_NAME
DO FOX_USE WITH "&MDBFLOC.FREIGHT INDEX &MDBFLOC.FRT_CODE", .F.
IF MFRT_CODE <> SPACE(4) .AND. MFRT_CODE <> 'DELV' .AND. MFRT_CODE <> 'NONE'
   SEEK MFRT_CODE
   IF .NOT. EOF()
      STORE NAME  TO MFRT_NAME
   ELSE
      STORE 'FRT NOT ON FILE' TO MFRT_NAME
   ENDIF
ENDIF

SELECT D
DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
MCOM_NAME = SPACE(10)
IF MCOM_CODE <> SPACE(2)
   SEEK MCOM_CODE
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,10) TO MCOM_NAME
   ELSE  
      STORE 'NOTONFILE' TO MCOM_NAME
   ENDIF
ENDIF

DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.
STORE 0 TO MSALE_PERC
IF MSALESMAN <> SPACE(2)
   SEEK MSALESMAN
   IF .NOT. EOF()
      STORE NAME      TO MSALE_NAME
      STORE SALE_PERC TO MSALE_PERC
      IF DTOC(EFF_DT2) <> '  /  /  '
         IF B->SHIP_DATE >= EFF_DT2
            MSALE_PERC = SALE_PER2
         ENDIF
      ENDIF
      IF DTOC(EFF_DT3) <> '  /  /  '
         IF B->SHIP_DATE >= EFF_DT3
            MSALE_PERC = SALE_PER3
         ENDIF
      ENDIF
   ENDIF
ENDIF

STORE SPACE(10) TO MSAL_NAME3
IF MSAL_CODE3 <> SPACE(2)
   SEEK MSAL_CODE3
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,10) TO MSAL_NAME3
   ENDIF
ENDIF

STORE SPACE(10) TO MSAL_NAME2
IF MSAL_CODE2 <> SPACE(2)
   DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE", .F.
   SEEK MSAL_CODE2
   IF .NOT. EOF()
      STORE SUBSTR(NAME,1,10) TO MSAL_NAME2
   ENDIF
ENDIF

STORE 0 TO MMISCAMT1, MMISCAMT2, MMISCAMT3
IF B->MISC_FLG <> ' '
   DO FOX_USE WITH "MISC_CHG INDEX MISC_CHG", .F.
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   IF .NOT. EOF()
      STORE MISCAMT1 TO MMISCAMT1, SMISCAMT1
      STORE MISCAMT2 TO MMISCAMT2, SMISCAMT2
      STORE MISCAMT3 TO MMISCAMT3, SMISCAMT3
   ELSE
      STORE 0 TO MMISCAMT1, MMISCAMT2, MMISCAMT3
   ENDIF
ENDIF
CLEAR
MBLURP = .F.
DO INQ_TEXT
DO INQ_SAY
CLEAR GETS
IF MBLURP
   @ 24,01 SAY "Action:     1. Continue   2. S/W'S   3. Notes   4. Underbill   5. More Items"
ELSE
   @ 24,01 SAY "Action:     1. Continue   2. S/W'S   3. Notes   4. Underbill"
ENDIF

MMORE = .T.
DO WHILE MMORE            
   MACTION = 1
   *SET CONFIRM ON
   @ 24,9 GET MACTION PICTURE '#' RANGE 1,5
   READ
   *SET CONFIRM OFF
   IF MACTION = 1  
      MMORE = .F.
   ELSE
      DO CASE
      CASE MACTION = 2
         SAVE SCREEN TO MGRACE
         SET PROC TO PO_PROC
         CLEAR
         IF MSALESMAN <> '  '
            MSAY_PO = MSALESMAN + '-' + MPO_NBR
         ELSE
            MSAY_PO = MPO_NBR
         ENDIF
         IF MPO_SUFFIX <> ' '
            MSAY_PO = MSAY_PO + '-' + MPO_SUFFIX
         ENDIF
         MTITLE = ' - SHORTWEIGHTS FOR PO ' + MSAY_PO
         @  1, 0 SAY MCOMPANY
         @  1,68 SAY DATE()
         @  2, 0 SAY MPROGRAM + MTITLE 
         MGO_BACK = .T.
         DO SW_VIEW
         SET PROC TO NEW_INQ
         RESTORE SCREEN FROM MGRACE
      CASE MACTION = 3
         SAVE SCREEN TO MGRACE
         DO UPDNOTES
         RESTORE SCREEN FROM MGRACE
      CASE MACTION = 4
      CASE MACTION = 5
         IF MBLURP
            SAVE SCREEN TO MGRACE
            SET PROC TO PO_PROC
            CLEAR
            @  1, 0 SAY MCOMPANY
            @  1,68 SAY DATE()
            @  2, 0 SAY MPROGRAM + ' - VIEW ITEMS / HISTORY'
            @  3,01 SAY 'PO #:'
            IF SALESMAN <> SPACE(2)
               @ 03,07 SAY SALESMAN + '-'
            ENDIF
            @ 03,10 SAY PO_NBR
            IF PO_SUFFIX <> ' '
               @ 3,14 SAY '-' + PO_SUFFIX
            ENDIF
            DO PG_VIEW
            SET PROC TO NEW_INQ
            RESTORE SCREEN FROM MGRACE
         ENDIF
      ENDCASE
   ENDIF
ENDDO
CLOSE DATA  
RETURN 


PROCEDURE INQ_TEXT
@ 00,01 SAY "P.O. INQUIRY FOR NBR:"
@ 01,00 TO 24,79
@ 02,01 SAY "Inv Nbr:"
@ 02,18 SAY "BROKER:"
@ 02,34 SAY "Ship Date:"
@ 02,56 SAY "Tot Lbs:"
@ 03,01 TO 03,78
@ 04,01 SAY "Supplier:"
@ 04,41 SAY "Customer:"
@ 05,01 SAY "Paid( )"
@ 05,41 SAY "Paid( )"
@ 06,01 TO 06,78
@ 07,01 SAY "Frt Comp:"
@ 07,41 SAY "Paid( )"
@ 08,01 TO 08,78 DOUBLE

@ 09,2  SAY 'QTY NA G SP'
@ 09,14 SAY 'DESCRIP'
@ 09,25 SAY 'SIZE'
@ 09,31 SAY 'UNIT'
@ 09,39 SAY 'LBS'
@ 09,46 SAY 'PURC PR' 
@ 09,54 SAY 'SELL PR'
@ 09,62 SAY 'TOT PURC'
@ 09,71 SAY 'TOT SELL'
@ 14,01 TO 14,78 DOUBLE
@ 15,30 TO  22,30
@ 15,02 SAY "Selling Prod:"
IF B->BILL_ADJ <> 0
   @ 15,38 SAY 'Adj Gross:'
ELSE
   @ 15,42 SAY "Gross:"
ENDIF
@ 16,02 SAY "Sell Adj/Frt:"
@ 16,40 SAY "Freight:"
@ 16,62 SAY "Pall:"
@ 17,04 SAY "Total Sell:"
@ 17,33 SAY "3rd-"
@ 17,47 SAY ':'
*@ 18,31 SAY "Intra-"
@ 18,47 SAY ':'
@ 18,62 SAY "Inet:"
@ 19,01 SAY "Purchase Prod:"
@ 19,37 SAY "Sales Comm:"
@ 20,01 SAY "Purch Adj/Frt:"
@ 20,38 SAY "Misc Cost:"
IF B->BILL_ADJ <> 0
   @ 21,03 SAY "  Adj Purch:"
ELSE
   @ 21,03 SAY "Total Purch:"
ENDIF
@ 21,47 SAY "============="
@ 22,41 SAY "MW Net:"
RETURN

PROCEDURE INQ_SAY  
IF MSALESMAN <> '  '
   @ 00,23 SAY MSALESMAN + '-'
ENDIF
@ 00,26 SAY MPO_NBR
IF MPO_SUFFIX <> ' '
   @ 00,30 SAY '-' + MPO_SUFFIX
ENDIF
@ 02,10 SAY MINV_NBR   
IF MBROK_NAME = SPACE(5)
   @ 02,26 SAY SUBSTR(MSALE_NAME,1,5)
ELSE
   @ 02,26 SAY MBROK_NAME
ENDIF
@ 02,45 SAY MSHIP_DATE
@ 02,65 SAY MTOT_LBS    PICTURE '99,999,999.99'
@ 04,11 SAY SUBSTR(MSUP_NAME,1,27)
@ 04,51 SAY SUBSTR(MCUS_NAME,1,27)
STORE TRIM(SUBSTR(MSUP_CITY,1,20)) TO MSUP_CITY
STORE TRIM(SUBSTR(MCUS_CITY,1,20)) TO MCUS_CITY
@ 05,11 SAY MSUP_CITY + ', ' + MSUP_STATE
@ 05,51 SAY MCUS_CITY + ', ' + MCUS_STATE
*@ 05,05 SAY MPAID_SUP 
*@ 05,46 SAY MPAID_CUS 
@ 07,11 SAY SUBSTR(MFRT_NAME,1,27)
*@ 07,46 SAY MPAID_FRT
SELECT C
DO FOX_USE WITH "PO_DTL INDEX PO_DTL", .F.
SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
IF EOF()
   STORE 0 TO MRECNO
ELSE
   STORE RECNO() TO MRECNO
ENDIF
MLINE = 10
DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX .AND. VAL(ITEM_NBR) <= 4               
   @ MLINE,1 SAY QTY PICTURE '9999'
   @ MLINE,6 SAY FRH_FRZ PICTURE '@!'
   @ MLINE,09 SAY GRADE PICTURE '@!'
   @ MLINE,11 SAY PACKAGED PICTURE '@!'
   @ MLINE,14 SAY PROD_DESC PICTURE '@!'
   @ MLINE,25 SAY SIZE PICTURE '@!'
   @ MLINE,31 SAY PACKED PICTURE '@!'
   @ MLINE,36 SAY LBS PICTURE '999999.99'
   @ MLINE,47 SAY PUR_PRICE PICTURE '9.9999'
   @ MLINE,55 SAY SEL_PRICE PICTURE '9.9999'
   @ MLINE,62 SAY TOT_PURCH PICTURE '99999.99'
   @ MLINE,71 SAY TOT_SELL PICTURE '99999.99'
   MLINE = MLINE + 1
   SKIP
ENDDO

IF .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
   MBLURP = .T.
   @ 14,67 SAY 'More Items...'
ENDIF

@ 15,16 SAY MTOT_SELL - MSELL_ADJ + MCUS_PALL PICTURE '99,999,999.99'
@ 15,49 SAY MGROSS - B->BILL_ADJ PICTURE '999,999.99'
@ 16,16 SAY MSELL_ADJ    PICTURE '99,999,999.99'
@ 16,49 SAY MFRT1_AMT   PICTURE '999,999.99'
@ 16,68 SAY MFRT_PALL   PICTURE '999,999.99'
MSELL = MTOT_SELL + MCUS_PALL
@ 17,16 GET MSELL PICTURE '99,999,999.99'

IF MCOM_NAME = SPACE(10)
   @ 17,37 SAY 'NONE'
ELSE
   @ 17,37 SAY MCOM_NAME 
ENDIF
@ 17,49 SAY MCOMM_AMT   PICTURE '999,999.99'    
IF MCOMM_AMT2 <> 0 .OR. MCOMM_AMT3 <> 0
   @ 17,68 SAY MCOMM_AMT2 + MCOMM_AMT3 PICTURE '999,999.99'
ENDIF

DO CASE
CASE MSAL_NAME2 = SPACE(10)
   @ 18,31 SAY 'Intra-NONE'
CASE MSAL_NAME3 = SPACE(10)
   @ 18,31 SAY '3rdPt-' + MSAL_NAME2
OTHERWISE
   @ 18,31 SAY SUBSTR(MSAL_NAME2,7) + '/' + SUBSTR(MSAL_NAME3,7)
ENDCASE

@ 18,49 SAY MSALE2_AMT+MSALE3_AMT  PICTURE '999,999.99'
@ 18,68 SAY MSALE2_NET+MSALE3_NET  PICTURE '999,999.99'
@ 19,16 SAY MTOT_PURCH - MPURCH_ADJ + MSUP_PALL   PICTURE '99,999,999.99'
IF MPASSWORD = 'ADM20'
   @ 19,49 SAY MSALE_COMM  PICTURE '999,999.99'
ELSE
   @ 19,56 SAY '.00'
ENDIF
@ 20,16 SAY MPURCH_ADJ  PICTURE '99,999,999.99'
@ 20,49 SAY MMISCAMT1 + MMISCAMT2 + MMISCAMT3 PICTURE '999,999.99'

MPURCH = MTOT_PURCH + MSUP_PALL
@ 21,16 GET MPURCH PICTURE '99,999,999.99'
IF MPASSWORD <> 'ADM20'
   MNET =  MNET + MSALE_COMM
ENDIF
MNET = MNET - B->BILL_ADJ
@ 22,49 GET MNET PICTURE '999,999.99'
RETURN


*Formatted by: ToolBox Ver. 1.2  on 4/13/90 at 10:53 AM.
