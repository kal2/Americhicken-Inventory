**********
* Program.: PO_EDIT.PRG
* Author..: Grace Keller
* Date....: 10/19/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PURCHASE ORDER EDIT
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
SET PROC TO PO_PROC
MCHG_ITM = .F.
MADD_ITM = .F.
SELECT A
DO FOX_USE WITH "&MDBFLOC.SUPPLIER INDEX &MDBFLOC.SUP_CODE", .F.
SEEK MSUP_CODE
IF .NOT. EOF()
   STORE NAME TO MSUP_NAME, MSAV_SUP
   STORE STREET TO MSUP_STRT  
   STORE CITY TO MSUP_CITY       
   STORE STATE TO MSUP_ST    
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MSUP_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MSUP_ZIP 
   ENDIF
ELSE 
   IF MSUP_CODE = 'NONE'
      STORE MSUP_CODE + SPACE(28) TO MSUP_NAME, MSAV_SUP
   ELSE
      STORE 'SHIPPED FROM NOT ON FILE' TO MSUP_NAME, MSAV_SUP
   ENDIF
   STORE SPACE(28) TO MSUP_STRT
   STORE SPACE(20) TO MSUP_CITY
   STORE SPACE(2) TO MSUP_ST    
   STORE SPACE(10) TO MSUP_ZIP
ENDIF

DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
SEEK MRSUPCODE

IF .NOT. EOF()
   STORE NAME TO MRSUPNAME, MSAV_RSUP
   STORE STREET TO MRSUP_STRT  
   STORE CITY TO MRSUP_CITY       
   STORE STATE TO MRSUP_ST   
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MRSUP_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MRSUP_ZIP 
   ENDIF
ELSE 
   IF MRSUPCODE = 'NONE'
      STORE 'NONE' TO MRSUPNAME, MSAV_RSUP
   ELSE
      STORE 'REMIT TO NOT ON FILE' TO MRSUPNAME, MSAV_RSUP
   ENDIF
   STORE SPACE(28) TO MRSUP_STRT
   STORE SPACE(20) TO MRSUP_CITY
   STORE SPACE(2) TO MRSUP_ST   
   STORE SPACE(10) TO MRSUP_ZIP
ENDIF

SELECT A
DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_CODE", .F.
SEEK MBUY_CODE
IF .NOT. EOF()
   STORE NAME TO MBUY_NAME, MSAV_BUY
   STORE STREET TO MBUY_STRT  
   STORE CITY TO MBUY_CITY       
   STORE STATE TO MBUY_ST    
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MBUY_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MBUY_ZIP 
   ENDIF
ELSE 
   IF MBUY_CODE = 'NONE'
      STORE MBUY_CODE + SPACE(28) TO MBUY_NAME, MSAV_BUY
   ELSE
      STORE 'SHIP TO NOT ON FILE' TO MBUY_NAME, MSAV_BUY
   ENDIF
   STORE SPACE(28) TO MBUY_STRT
   STORE SPACE(20) TO MBUY_CITY
   STORE SPACE(2) TO MBUY_ST   
   STORE SPACE(10) TO MBUY_ZIP
ENDIF

SELECT A
DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
SEEK MBBUYCODE
IF .NOT. EOF()
   STORE NAME TO MBBUYNAME, MSAV_BBUY
   STORE STREET TO MBBUY_STRT  
   STORE CITY TO MBBUY_CITY       
   STORE STATE TO MBBUY_ST      
   IF ZIP4 = SPACE(4)
      STORE ZIP TO MBBUY_ZIP
   ELSE
      STORE ZIP + '-' + ZIP4 TO MBBUY_ZIP 
   ENDIF
ELSE 
   IF MBBUYCODE = 'NONE'
      STORE 'NONE' TO MBBUYNAME, MSAV_BBUY
   ELSE
      STORE 'BILL TO NOT ON FILE' TO MBBUYNAME, MSAV_BBUY
   ENDIF
   STORE SPACE(28) TO MBBUY_STRT
   STORE SPACE(20) TO MBBUY_CITY
   STORE SPACE(2) TO MBBUY_ST   
   STORE SPACE(10) TO MBBUY_ZIP
ENDIF

SELECT B
STORE MAIN_SHIP TO MMAIN_SHIP
SELECT A
DO FOX_USE WITH "SHIPWITH INDEX SHIPWITH", .F.
IF MMAIN_SHIP = 'Y'
   SEEK B->SALESMAN + B->PO_NBR + B->PO_SUFFIX
   STORE PO_SHIP1 TO MPO_SHIP1
   STORE PO_SHIP2 TO MPO_SHIP2
   STORE PO_SHIP3 TO MPO_SHIP3
   STORE PO_SHIP4 TO MPO_SHIP4
   STORE PO_SHIP5 TO MPO_SHIP5
   STORE PO_SHIP6 TO MPO_SHIP6
   STORE PO_SUFF1 TO MPO_SUFF1
   STORE PO_SUFF2 TO MPO_SUFF2
   STORE PO_SUFF3 TO MPO_SUFF3
   STORE PO_SUFF4 TO MPO_SUFF4
   STORE PO_SUFF5 TO MPO_SUFF5
   STORE PO_SUFF6 TO MPO_SUFF6
ELSE
   IF B->SHIP_NBR <> SPACE(4)
      STORE 'N' TO MMAIN_SHIP
      SEEK B->SALESMAN + B->SHIP_NBR + B->SHIP_SUFF
      STORE PO_NBR    TO MPO_SHIP1
      STORE PO_SUFFIX TO MPO_SUFF1
      I = 2
      M = 1 
      DO WHILE M<= 6
         MI = STR(I,1)
         MM = STR(M,1)
         IF PO_SHIP&MM = B->PO_NBR .AND. PO_SUFF&MM = B->PO_SUFFIX
            M = M + 1
            LOOP
         ENDIF
         STORE PO_SHIP&MM TO MPO_SHIP&MI 
         STORE PO_SUFF&MM TO MPO_SUFF&MI
         I = I + 1
         M = M + 1
      ENDDO
   ELSE
      STORE SPACE(4) TO MPO_SHIP1, MPO_SHIP2, MPO_SHIP3, MPO_SHIP3, MPO_SHIP4, MPO_SHIP5, MPO_SHIP6
      STORE SPACE(1) TO MPO_SUFF1, MPO_SUFF2, MPO_SUFF3, MPO_SUFF3, MPO_SUFF4, MPO_SUFF5, MPO_SUFF6
   ENDIF
ENDIF
USE

SELECT B

MCONT = .T.
CLEAR
DO WHILE MCONT
   CLEAR
   MTITLE = ' - UPDATE/DELETE PURCHASE ORDER'    
   SET PROC TO PO_PROC
   DO TEXTPO2
   IF B->NOTES_FLG <> ' '
      @ 1,28 SAY '(-NOTES ON FILE-)'
   ENDIF
   DO GETPO3   
   READ
   DO CASE
   CASE MCOMPANY = 'DIVISION 72 - LAND'
      IF MBROKERAGE <> 'S' .AND. MBROKERAGE <> 'T' .AND. MBROKERAGE <> 'F' .AND. MBROKERAGE <> 'B' .AND. MBROKERAGE <> 'W' ;
         .AND. MBROKERAGE <> 'C' .AND. MBROKERAGE <> 'L'
         @ 24,0 CLEAR
         STORE 'BROKERAGE INDICATOR MUST BE "W, S, T, F, B, C, OR L" - PRESS RETURN 'TO MERROR
         @ 24,1 GET MERROR
         CLEAR GETS
         STORE 'B' TO MSPACE
         @ 24,1  GET MSPACE
         READ
         LOOP
      ENDIF
   CASE MCOMPANY = 'DIVISION 15'
      IF MBROKERAGE <> 'Y' .AND. MBROKERAGE <> ' '
         @ 24,0 CLEAR
         STORE 'HOLD STORAGE INDICATOR MUST BE A "Y" OR SPACE - PRESS RETURN TO REENTER'TO MERROR
         @ 24,1 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,1  GET MSPACE
         READ
         LOOP
      ENDIF
   CASE MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
      IF MBROKERAGE <> 'H' .AND. MBROKERAGE <> ' '
         @ 24,0 CLEAR
         STORE 'BROKERAGE INDICATOR MUST BE A "H" OR SPACE - PRESS RETURN TO REENTER'TO MERROR
         @ 24,1 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,1  GET MSPACE
         READ
         LOOP
      ENDIF
   OTHERWISE
      IF MBROKERAGE <> 'X' .AND. MBROKERAGE <> ' '
         @ 24,0 CLEAR
         STORE 'BROKERAGE ORDER INDICATOR MUST BE AN "X" OR SPACE - PRESS RETURN TO REENTER'TO MERROR
         @ 24,1 GET MERROR
         CLEAR GETS
         STORE 'B' TO MSPACE
         @ 24,1  GET MSPACE
         READ
         LOOP
      ENDIF
   ENDCASE
   **** DO SOME EDITS ON SHIPPED WITH INFORMATION
   IF MMAIN_SHIP = ' ' .AND. MPO_SHIP1 <> SPACE(4)
      SELECT A
      DO FOX_USE WITH "SHIPWITH INDEX SHIPWITH", .F.
      SEEK MSALESMAN + MPO_SHIP1 + MPO_SUFF1
      IF EOF()
         SELECT B
         @ 24,0 CLEAR
         STORE ' SHIPPED WITH PO NOT ON FILE - PRESS RETURN TO REENTER'TO MERROR
         @ 24,1 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,1  GET MSPACE
         READ
         LOOP
      ELSE
         IF MPO_NBR+MPO_SUFFIX = PO_SHIP1+PO_SUFF1 .OR. MPO_NBR+MPO_SUFFIX= PO_SHIP2+PO_SUFF2 ;
            .OR. MPO_NBR+MPO_SUFFIX = PO_SHIP3+PO_SUFF3 .OR. MPO_NBR+MPO_SUFFIX= PO_SHIP4+PO_SUFF4 ;
            .OR. MPO_NBR+MPO_SUFFIX = PO_SHIP5+PO_SUFF5 .OR. MPO_NBR+MPO_SUFFIX= PO_SHIP6+PO_SUFF6                      ENDIF
         ELSE
            @ 24,0 CLEAR
            STORE ' PO NOT LISTED ON SHIPPED WITH MAIN PO - PRESS RETURN TO REENTER'TO MERROR
            @ 24,1 GET MERROR
            CLEAR GETS
            STORE ' ' TO MSPACE
            @ 24,1  GET MSPACE
            READ
            SELECT B
            LOOP
         ENDIF
         SELECT B
      ENDIF
      SELECT B   
   ENDIF
   
   *** FOR AMERICHICKEN, DO SOME SHIPMENT DATE EDITS
   IF B->INV_NBR <> SPACE(5) .AND. B->SHIP_DATE <> MSHIP_DATE
      @ 24,0 CLEAR
      STORE 'CANNOT CHANGE SHIP DATE - ALREADY INVOICED  - PRESS ENTER TO CONTINUE' TO MERROR
      @ 24,2 GET MERROR
      CLEAR GETS
      STORE ' ' TO MSPACE
      @ 24,0  GET MSPACE PICTURE '@!'
      READ
      MSHIP_DATE = B->SHIP_DATE
      @ 07,13 GET mship_date 
      CLEAR GETS
      @ 24,0 CLEAR
   ENDIF
   
   **** DO SOME EDITS ON SHIP DATE
   IF MSHIP_DATE > DATE() .AND. MBROKERAGE <> 'H'
      STORE ' ' TO MREENTER
      DO WHILE MREENTER <> 'R'
         @ 24,0 CLEAR
         STORE 'SHIP DATE IS IN THE FUTURE - ENTER AN "R" TO REENTER' TO MERROR
         @ 24,2 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,0  GET MREENTER PICTURE '@!'
         READ
      ENDDO
      @ 24,0 CLEAR
      LOOP
   ENDIF
   
   IF B->SHIP_DATE <> MSHIP_DATE
      IF DATE() - MSHIP_DATE > 30 .OR. DATE() - MSHIP_DATE < -30
         @ 24,0 CLEAR
         STORE ' ' TO MERROR
         DO WHILE MERROR <> 'C' .AND. MERROR <> 'E'
            @ 24,0 SAY "SHIP DATE APPEARS INVALID - ENTER 'C' TO CONTINUE OR 'E' TO EDIT " GET MERROR PICTURE '@!'
            READ
         ENDDO
         @ 24,0 CLEAR
         IF MERROR <> 'C'
            LOOP
         ENDIF
      ENDIF
   ENDIF   
   
   *** DO SOME EDITS ON DELIVERY REQUIRED
   
   IF DTOC(MDEL_REQD) = '  /  /  '
      STORE ' ' TO MREENTER
      DO WHILE MREENTER <> 'R'
         @ 24,0 CLEAR
         STORE 'DELV DATE IS BLANK - ENTER AN "R" TO REENTER' TO MERROR
         @ 24,2 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,0  GET MREENTER PICTURE '@!'
         READ
      ENDDO
      @ 24,0 CLEAR
      LOOP
   ELSE
      IF DATE() - MDEL_REQD > 30 .OR. DATE() - MDEL_REQD < -30
         @ 24,0 CLEAR
         STORE ' ' TO MERROR
         DO WHILE MERROR <> 'C' .AND. MERROR <> 'E'
            @ 24,0 SAY "DELV DATE APPEARS INVALID - ENTER 'C' TO CONTINUE OR 'E' TO EDIT " GET MERROR PICTURE '@!'
            READ
         ENDDO
         @ 24,0 CLEAR
         IF MERROR <> 'C'
            LOOP
         ENDIF
      ENDIF
      
      IF DATE() - MDEL_REQD > 7
         @ 24,0 CLEAR
         STORE ' ' TO MERROR
         DO WHILE MERROR <> 'C' .AND. MERROR <> 'E'
            @ 24,0 SAY "DELV DATE MORE THAN 7 DAYS OLD - ENTER 'C' TO CONTINUE OR 'E' TO EDIT " GET MERROR PICTURE '@!'
            READ
         ENDDO
         @ 24,0 CLEAR
         IF MERROR <> 'C'
            LOOP
         ENDIF
      ENDIF
   ENDIF
   
   DO TEXTPO3
   
   **** GET SUPPLIER SHIPPED FROM ADDRESS
   SET PROC TO SUP_PROC
   MNEWREM = SPACE(4)        
   MGET_NAME = .T.
   DO WHILE MGET_NAME
      @ 13,1 GET MSUP_NAME PICTURE '@!'
      @ 14,1  SAY MSUP_STRT  
      @ 15,1 SAY  SPACE(35)
      IF MSUP_CITY <> SPACE(20) .OR. MSUP_ST <> SPACE(2)
         @ 15,1  SAY TRIM(MSUP_CITY) + ', ' + MSUP_ST + '  ' + MSUP_ZIP
      ENDIF
      READ
      IF MSUP_NAME = MSAV_SUP
         MGET_NAME = .F.
         LOOP
      ENDIF
      IF MSUP_NAME = SPACE(32)
         @ 24,0 CLEAR
         STORE 'SHIPPED FROM SUPPLIER NAME NOT ENTERED - PRESS RETURN TO REENTER' TO MERROR
         @ 24,5 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,58 GET MSPACE
         READ
         LOOP
      ENDIF
      IF MSUP_NAME = 'NONE'
         STORE 'NONE' TO MSUP_CODE
         MGET_NAME = .F.
         LOOP
      ENDIF
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.SUPPLIER INDEX &MDBFLOC.SUP_NAME", .F.
      MNAME_FD = .F.
      STORE MSUP_NAME TO MNAME
      STORE MSUP_NAME TO MDIS_NAME
      @ 24,0 CLEAR
      SAVE SCREEN TO MADD_SCRN
      DO SUP_SEL2
      RESTORE SCREEN FROM MADD_SCRN
      STORE MDIS_NAME TO MSUP_NAME
      IF MNAME_FD
         STORE NAME TO MSUP_NAME       
         STORE STREET TO MSUP_STRT    
         STORE CITY TO MSUP_CITY       
         STORE STATE TO MSUP_ST   
         IF ZIP4 = SPACE(4)
            STORE ZIP TO MSUP_ZIP
         ELSE
            STORE ZIP + '-' + ZIP4 TO MSUP_ZIP 
         ENDIF
         STORE SUP_CODE TO MSUP_CODE
         STORE RSUPCODE TO MNEWREM
         MGET_NAME = .F.
      ENDIF
   ENDDO
   @ 13,1  SAY MSUP_NAME
   IF MSUP_NAME <> 'NONE'
      @ 14,1  SAY MSUP_STRT  
      @ 15,1 SAY  SPACE(35)
      IF MSUP_NAME <> SPACE(20) .OR. MSUP_ST <> SPACE(2)
         @ 15,1  SAY TRIM(MSUP_CITY) + ', ' + MSUP_ST + '  ' + MSUP_ZIP
      ENDIF
   ENDIF
   
   IF MSUP_NAME <> 'SALESPERSON' .AND. MRSUPNAME = 'SALESPERSON'
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPCODE", .F.
      SEEK MNEWREM 
      IF .NOT. EOF()
         STORE RSUPCODE TO MRSUPCODE
         STORE NAME TO MRSUPNAME, MSAV_RSUP
         STORE STREET TO MRSUP_STRT  
         STORE CITY TO MRSUP_CITY       
         STORE STATE TO MRSUP_ST   
         IF ZIP4 = SPACE(4)
            STORE ZIP TO MRSUP_ZIP
         ELSE
            STORE ZIP + '-' + ZIP4 TO MRSUP_ZIP 
         ENDIF
      ENDIF
   ENDIF
   
   MGET_NAME = .T.
   DO WHILE MGET_NAME
      @ 13,40 GET MRSUPNAME PICTURE '@!'
      @ 14,40 SAY MRSUP_STRT
      @ 15,40 SAY SPACE(35)
      IF MRSUP_CITY <> SPACE(20) .OR. MRSUP_ST <> SPACE(2)
         @ 15,40 SAY TRIM(MRSUP_CITY) + ', ' + MRSUP_ST + '  ' + MRSUP_ZIP
      ENDIF
      READ
      IF MRSUPNAME =  MSAV_RSUP
         MGET_NAME = .F.
         LOOP
      ENDIF
      
      IF MRSUPNAME = SPACE(32)
         @ 24,0 CLEAR
         STORE 'REMIT TO SUPPLIER NAME NOT ENTERED - PRESS RETURN TO REENTER' TO MERROR
         @ 24,5 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,58 GET MSPACE
         READ
         LOOP
      ENDIF
      
      IF MRSUPNAME = 'NONE'
         STORE 'NONE' TO MRSUPCODE
         MGET_NAME = .F.
         LOOP
      ENDIF
      
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.REM_SUP INDEX &MDBFLOC.RSUPNAME, &MDBFLOC.RSUPCODE", .F.
      SET PROC TO SUP_PROC
      MNAME_FD = .F.
      IF MRSUPNAME = 'SAME'
         STORE MSUP_NAME TO MNAME
      ELSE
         STORE MRSUPNAME TO MNAME
      ENDIF
      SAVE SCREEN TO MADD_SCRN
      DO RSUPSEL2
      RESTORE SCREEN FROM MADD_SCRN 
      @ 24,0 CLEAR
      IF (.NOT. MNAME_FD) .OR. (MNAME = SPACE(32))
         LOOP
      ENDIF
      STORE NAME TO MRSUPNAME       
      STORE STREET TO MRSUP_STRT    
      STORE CITY TO MRSUP_CITY       
      STORE STATE TO MRSUP_ST
      IF ZIP4 = SPACE(4)
         STORE ZIP TO MRSUP_ZIP
      ELSE
         STORE ZIP + '-' + ZIP4 TO MRSUP_ZIP 
      ENDIF
      STORE RSUPCODE TO MRSUPCODE
      MGET_NAME = .F.
   ENDDO
   @ 13,40 SAY MRSUPNAME
   IF MRSUPNAME <> 'NONE'
      @ 14,40 SAY MRSUP_STRT
      @ 15,40 SAY SPACE(35)
      IF MRSUP_CITY <> SPACE(20) .OR. MRSUP_ST <> SPACE(2)
         @ 15,40 SAY TRIM(MRSUP_CITY) + ', ' + MRSUP_ST + '  ' + MRSUP_ZIP
      ENDIF
   ENDIF
   
   ***** NOW GET SHIP TO CUSTOMER
   SET PROC TO BUY_PROC
   MGET_NAME = .T.
   DO WHILE MGET_NAME
      @ 20,1  GET MBUY_NAME PICTURE '@!'
      @ 21,1  SAY MBUY_STRT
      @ 22,1 SAY SPACE(35)
      IF MBUY_CITY <> SPACE(20) .OR. MBUY_ST <> SPACE(2)
         @ 22,1  SAY TRIM(MBUY_CITY) + ', ' + MBUY_ST + '  ' + MBUY_ZIP
      ENDIF
      READ
      
      IF MBUY_NAME = MSAV_BUY 
         MGET_NAME = .F.
         LOOP
      ENDIF
      
      IF MBUY_NAME = SPACE(32)
         @ 24,0 CLEAR
         STORE 'SHIP TO CUSTOMER NAME NOT ENTERED - PRESS RETURN TO REENTER' TO MERROR
         @ 24,5 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,58 GET MSPACE
         READ
         LOOP
      ENDIF
      
      IF MBUY_NAME = 'NONE'
         STORE 'NONE' TO MBUY_CODE
         STORE SPACE(28) TO MBUY_STRT
         STORE SPACE(20) TO MBUY_CITY
         STORE SPACE(2) TO MBUY_ST
         STORE SPACE(5) TO MBUY_ZIP
         STORE SPACE(4) TO MBUY_ZIP4
         MGET_NAME = .F.
         LOOP
      ENDIF
      
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_NAME, &MDBFLOC.BUY_CODE", .F.
      MNAME_FD = .F.
      STORE MBUY_NAME TO MNAME
      STORE MBUY_NAME TO MDIS_NAME
      SAVE SCREEN TO MADD_SCRN
      DO BUY_SEL2
      RESTORE SCREEN FROM MADD_SCRN
      STORE MDIS_NAME TO MBUY_NAME
      @ 24,0 CLEAR
      IF (.NOT. MNAME_FD) .OR. (MNAME = SPACE(32))
         LOOP
      ENDIF
      STORE NAME TO MBUY_NAME       
      STORE STREET TO MBUY_STRT    
      STORE CITY TO MBUY_CITY       
      STORE STATE TO MBUY_ST
      IF ZIP4 = SPACE(4)
         STORE ZIP TO MBUY_ZIP
      ELSE
         STORE ZIP + '-' + ZIP4 TO MBUY_ZIP 
      ENDIF
      STORE BUY_CODE TO MBUY_CODE
      MGET_NAME = .F.
   ENDDO
   @ 20,1  SAY MBUY_NAME
   IF MBUY_NAME <> 'NONE'
      @ 21,1  SAY MBUY_STRT
      @ 22,1 SAY SPACE(35)
      IF MBUY_CITY <> SPACE(20) .OR. MBUY_ST <> SPACE(2)
         @ 22,1  SAY TRIM(MBUY_CITY) + ', ' + MBUY_ST + '  ' + MBUY_ZIP
      ENDIF
   ENDIF
   ***** NOW GET BILL TO CUSTOMER
   MGET_NAME = .T.
   DO WHILE MGET_NAME
      @ 20,40 GET MBBUYNAME PICTURE '@!'
      @ 21,40 SAY MBBUY_STRT
      @ 22,40 SAY SPACE(35)
      IF MBBUY_CITY <> SPACE(20) .OR. MBBUY_ST <> SPACE(2)
         @ 22,40 SAY TRIM(MBBUY_CITY) + ', ' + MBBUY_ST + '  ' + MBBUY_ZIP
      ENDIF
      READ
      
      IF MBBUYNAME = MSAV_BBUY 
         MGET_NAME = .F.
         LOOP
      ENDIF
      
      IF MBBUYNAME = SPACE(32)
         @ 24,0 CLEAR
         STORE 'BILL TO CUSTOMER NAME NOT ENTERED - PRESS RETURN TO REENTER' TO MERROR
         @ 24,5 GET MERROR
         CLEAR GETS
         STORE ' ' TO MSPACE
         @ 24,58 GET MSPACE
         READ
         LOOP
      ENDIF
      
      IF MBBUYNAME = 'NONE'
         STORE 'NONE' TO MBBUYCODE
         STORE SPACE(28) TO MBBUY_STRT
         STORE SPACE(20) TO MBBUY_CITY
         STORE SPACE(2) TO MBBUY_ST
         STORE SPACE(5) TO MBBUY_ZIP
         STORE SPACE(4) TO MBBUY_ZIP4
         MGET_NAME = .F.
         LOOP
      ENDIF
      IF MBBUYNAME = 'SAME'
         STORE MBUY_NAME TO MNAME       
      ELSE
         STORE MBBUYNAME TO MNAME
      ENDIF
      SELECT A
      DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYNAME, &MDBFLOC.BBUYCODE", .F.
      MNAME_FD = .F.
      SAVE SCREEN TO MADD_SCRN
      DO BBUYSEL2
      RESTORE SCREEN FROM MADD_SCRN
      @ 24,0 CLEAR
      IF (.NOT. MNAME_FD) .OR. (MNAME = SPACE(32))
         LOOP
      ENDIF
      STORE NAME TO MBBUYNAME       
      STORE STREET TO MBBUY_STRT    
      STORE CITY TO MBBUY_CITY       
      STORE STATE TO MBBUY_ST
      IF ZIP4 = SPACE(4)
         STORE ZIP TO MBBUY_ZIP
      ELSE
         STORE ZIP + '-' + ZIP4 TO MBBUY_ZIP 
      ENDIF
      STORE BBUYCODE TO MBBUYCODE
      MGET_NAME = .F.
   ENDDO
   @ 20,40 SAY MBBUYNAME
   IF MBBUYNAME <> 'NONE'
      @ 21,40 SAY MBBUY_STRT
      @ 22,40 SAY SPACE(35)
      IF MBBUY_CITY <> SPACE(20) .OR. MBBUY_ST <> SPACE(2)
         @ 22,40 SAY TRIM(MBBUY_CITY) + ', ' + MBBUY_ST + '  ' + MBBUY_ZIP
      ENDIF
   ENDIF
   SET PROC TO PO_PROC
   STORE 1 TO MACTION
   @ 24,0 SAY 'Action: ' + STR(MACTION,1)
   @ 24,12 SAY '1. Item Page   2. Edit   3. Update Notes'
   @ 24,8 GET MACTION PICTURE '#' RANGE 1,3
   
   READ
   
   IF MACTION = 3
      SAVE SCREEN TO MGRACE
      DO UPDNOTES
      RESTORE SCREEN FROM MGRACE
      STORE 1 TO MACTION
      @ 24,0 CLEAR
      @ 24,0 SAY 'Action: '
      @ 24,12 SAY '1.Item Page   2.Edit' 
      @ 24,8 GET MACTION PICTURE '#' RANGE 1,2
      READ
   ENDIF
   
   DO CASE      
   CASE MACTION = 1
      *  SET PROC TO PO_PROC
      SELECT B
      IF INV_NBR <> SPACE(5) .AND. (MBBUYCODE <> BBUYCODE .OR. MSHIP_DATE <> SHIP_DATE)
         SELECT A
         DO FOX_USE WITH "CUS_INV INDEX CUSIVNBR, CUS_DATE, CUS_INV, CUS_SHIP", .F.
         SEEK B->INV_NBR
         IF .NOT. EOF()
            IF PAID_FLG <> 'Y'
               DO RECLOCK
               REPLACE SHIP_DATE WITH MSHIP_DATE
               REPLACE BBUYCODE WITH MBBUYCODE  
               ***IF MBBUYCODE = 'INVN'                   
               IF MBBUYCODE = 'I'
                  REPLACE PAID_FLG WITH 'Y'
               ENDIF
               UNLOCK
            ELSE
               ***IF BBUYCODE = 'INVN' .AND. MBBUYCODE <> 'INVN'
               IF BBUYCODE = 'I' .AND. MBBUYCODE <> 'I'
                  DO RECLOCK
                  REPLACE PAID_FLG WITH ' '
                  REPLACE BBUYCODE WITH MBBUYCODE  
                  UNLOCK
               ENDIF
            ENDIF
         ENDIF
         USE
         SELECT B
      ENDIF
      IF MCOMPANY = 'AMERICHICKEN, INC' .OR. MSALESMAN = '11'
         MAM_FLG = .T.
      ELSE
         MAM_FLG = .F.
      ENDIF
      IF MAM_FLG .AND. B->BBUYCODE = 'INVN' .AND. MBBUYCODE <> 'INVN'
         *** IF AMERICHICKEN - MCOMPANY = 'AMERICHICKEN, INC'
         *** IF IT WAS GOING INTO INVENTORY - BBUYCODE = 'INVN'
         *** BUT NOW ITS GOING TO CUSTOMER  - MBBUYCODE= 'INVN'
         *** DELETE FROM HOLDING INVENTORY
         SELECT A
         DO FOX_USE WITH "HINVEN", .F.
         DO WHILE .NOT. EOF()
            IF SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               DELETE
               UNLOCK
            ENDIF
            SKIP
         ENDDO
         DO FOX_USE WITH "HINV_DTL INDEX HINV_DTL", .F.
         SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
         DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
            DO FILELOCK
            DELETE
            UNLOCK
            SKIP
         ENDDO
         USE
         SELECT B
      ENDIF
      
      IF (BBUYCODE <> MBBUYCODE .OR. MBUYER_PO <> BUYER_PO) .AND. (MBUYER_PO <> SPACE(15) .OR. B->BUYER_PO <> SPACE(15))
         IF MBUYER_PO <> 'HOLD  Q'
         SELECT A
         DO FOX_USE WITH "CUST_PO INDEX CUST_PO", .F.
         SEEK B->BBUYCODE + B->BUYER_PO
         IF .NOT. EOF()
            DO FILELOCK
            DELETE
            UNLOCK
         ENDIF
         ENDIF
         IF MBUYER_PO <> SPACE(15) .AND. MBUYER_PO <> 'HOLD Q'
            DO FILELOCK
            APPEND BLANK
            REPLACE BUYER_PO WITH MBUYER_PO
            REPLACE BBUYCODE WITH MBBUYCODE
            REPLACE SALESMAN WITH MSALESMAN
            REPLACE PO_NBR WITH MPO_NBR
            REPLACE PO_SUFFIX WITH MPO_SUFFIX
            REPLACE BUYER_PO WITH MBUYER_PO
            UNLOCK
         ENDIF
         USE
         SELECT B
      ENDIF
      
      SELECT B
      IF MBBUYCODE = 'INVN' .AND. MONTH(MSHIP_DATE) <> MONTH(MDEL_REQD)
         @ 24,0 CLEAR
         MWAIT = ' '
         @ 24,1 SAY 'INVENTORY SHIPMENT - SHIP AND DELIVERY MONTH MUST BE SAME - REENTER ' GET MWAIT
         READ
         LOOP
      ENDIF
      *** GET THE SHIP AND ANIV DATES UP TO DATE
      ** HERE
      IF MSHIP_DATE <> SHIP_DATE .OR. MDEL_REQD <> DEL_REQD
         IF MBBUYCODE = 'INVN'
            
            SELECT A
            DO FOX_USE WITH "INVEN INDEX INVNPO", .F.
            SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
            DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               REPLACE SHIP_DATE WITH MSHIP_DATE
               REPLACE ANIV_DATE WITH MDEL_REQD
               UNLOCK
               SKIP
            ENDDO
            
            DO FOX_USE WITH "HINVEN", .F.
            DO WHILE .NOT. EOF()
               IF SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
                  DO FILELOCK
                  REPLACE SHIP_DATE WITH MSHIP_DATE
                  REPLACE ANIV_DATE WITH MDEL_REQD
                  UNLOCK
               ENDIF
               SKIP
            ENDDO
            
            DO FOX_USE WITH "INVN_DTL INDEX INVN_DTL", .F.
            SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
            DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               REPLACE ACT_DATE WITH MDEL_REQD
               UNLOCK
               SKIP
            ENDDO
            
            DO FOX_USE WITH "HINV_DTL INDEX HINV_DTL", .F.
            SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
            DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               REPLACE ACT_DATE WITH MDEL_REQD
               UNLOCK
               SKIP
            ENDDO
         ENDIF
         
         IF MRSUPCODE  = 'INVN'
            SELECT A
            DO FOX_USE WITH "INVN_DTL INDEX INVN_DTL", .F.
            SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
            DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               **REPLACE ACT_DATE WITH MDEL_REQD
               REPLACE ACT_DATE WITH MSHIP_DATE
               UNLOCK
               SKIP
            ENDDO
            
            DO FOX_USE WITH "HINV_DTL INDEX HINV_DTL", .F.
            SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
            DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
               DO FILELOCK
               ***REPLACE ACT_DATE WITH MDEL_REQD
               REPLACE ACT_DATE WITH MSHIP_DATE
               UNLOCK
               SKIP
            ENDDO
         ENDIF
         
         SELECT A
         USE
         SELECT B
      ENDIF
      
      IF MMAIN_SHIP = 'N' .AND. MPO_SHIP1 <> SPACE(4)
         STORE RECNO() TO MRECNO
         SELECT B
         SEEK MSALESMAN + MPO_SHIP1 + MPO_SUFF1
         
         IF BBUYCODE <> MBBUYCODE
            @ 24,0 CLEAR
            MWAIT = ' '
            @ 24,0 SAY 'Shipped with PO not same as Main PO Bill to Customer - REENTER ' GET MWAIT
            READ
            MACTION = 2
            GOTO MRECNO
            LOOP
         ENDIF
         GOTO MRECNO
      ENDIF
      
      IF MBBUYCODE = SBBUYCODE
         *** IF ONLY UPDATING HOLD FLAG - UPDATE CUSTOMER BALANCES
         DO CASE
         CASE B->BROKERAGE = 'H' .AND. MBROKERAGE = ' '
            **** UPDATE CUSTOMER BALANCE INFO WHEN RELEASE FROM HOLD
            SELECT A
            DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
            SEEK MBBUYCODE
            DO RECLOCK
            REPLACE CUS_BAL WITH CUS_BAL + (B->TOT_SELL+B->CUS_PALL)
            UNLOCK
         CASE B->BROKERAGE = ' ' .AND. MBROKERAGE = 'H'
            SELECT A
            DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.
            **** UPDATE CUSTOMER BALANCE WHEN PUTTING BACK ON HOLD
            SEEK MBBUYCODE
            DO RECLOCK
            REPLACE CUS_BAL WITH CUS_BAL - (B->TOT_SELL+B->CUS_PALL)
            UNLOCK
         ENDCASE
         SELECT A
         USE
      ENDIF
      SELECT B
      DO REPLPO
      RELEASE MMAIN_SHIP   
      RELEASE MPO_SHIP1, MPO_SHIP2, MPO_SHIP3, MPO_SHIP3, MPO_SHIP4, MPO_SHIP5, MPO_SHIP6
      RELEASE MPO_SUFF1, MPO_SUFF2, MPO_SUFF3, MPO_SUFF3, MPO_SUFF4, MPO_SUFF5, MPO_SUFF6
      
      MGOTO_PG = 2
      *** DO EDIT_PG
      MCONT = .F.
      
   CASE MACTION = 2
      LOOP        
      
   ENDCASE 
ENDDO 

RETURN
* EOF: PO_EDIT.PRG
*Formatted by: ToolBox Ver. 1.2  on 8/26/14 at 9:29 AM.
