*  FILE NAME: CAT_RPT.PRG
*  BY: 
*  NOTICE: 
*  DATE: 1/9/97
*  DESC:
*  CALLED BY:
*  DATA FILES:
CLOSE DATA
MTITLE = ' - SALES BY PRODUCT CATEGORY'
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET FIRST AND LAST DATES FOR THIS REPORT
STORE CTOD(' ') TO MSTART, MLAST
STORE 'P' TO MDISP_PRT
MSEL_INV = 'ALL'
MOPT_SALES = '**'
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 08,2 say '     Beginning Date: '
   @ 08,24 GET MSTART
   @ 10,2 SAY '        Ending Date: '
   @ 10,24 GET MLAST
   @ 12,2 SAY 'Display/Print (D/P): ' 
   @ 12,24 GET MDISP_PRT PICTURE '@!'
   @ 14,2 SAY 'Enter Optional Salesperson Code: ' GET MOPT_SALES PICTURE '@!'
   @ 15,2 say "    ('**' for all salespersons)"
   @ 17,2 say '      Select ALL Shipments or'                
   @ 18,2 SAY 'Only Shipments from INVentory (ALL/INV): ' GET MSEL_INV PICTURE '@!'
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'                     
   READ
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MSTART) = '  /  /  ' .AND. DTOC(MLAST) = '  /  /  '
         MACTION = 3
         LOOP
      ENDIF
      IF (DTOC(MSTART) <> '  /  /  ' .AND. DTOC(MLAST) = '  /  /  ') .OR. (DTOC(MSTART) = '  /  /  ' .AND. DTOC(MLAST) <> '  /  /  ')
         @ 24,0 CLEAR
         MWAIT = ' '
         @ 24,1 SAY 'Only One Date Entered - Both Begin and End Dates Must be Entered ' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 clear
         LOOP 
      ENDIF
   ENDIF
ENDDO
IF MACTION = 3
   RETURN 
ENDIF  
@ 20,01 CLEAR TO 20,78 
MPRT_ACT = ' '
IF MDISP_PRT = 'P'
   DO PRT_SET
   IF MPRT_ACT <> 'C'
      LOOP  
   ENDIF
   MPAGE_LEN = 56
ELSE
   MPAGE_LEN = 20
ENDIF

SELECT B 
DO FOX_USE WITH "PO_DTL INDEX PO_DTL", .F.

SELECT C
DO FOX_USE WITH "&MDBFLOC.PRODUCTS INDEX &MDBFLOC.PRODUCTS", .F.

SELECT A 
DO FOX_USE WITH "PO_HEAD INDEX PO_SHIP", .F.
MSTRT_YR = SUBSTR(DTOC(MSTART),7)
MSTRT_MO = SUBSTR(DTOC(MSTART),1,2)
SEEK MSTRT_YR + MSTRT_MO
DO WHILE .NOT. EOF() .AND. SHIP_DATE < MSTART
   SKIP
ENDDO

MFOODSRV_L = 0
MPORK_L    = 0
MBEEF_L    = 0
MOTHER_L   = 0
MUNKNOWN_L = 0
MFOODSRV_D = 0
MPORK_D    = 0
MBEEF_D    = 0
MOTHER_D   = 0
MUNKNOWN_D = 0

DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MLAST   
   
   IF BBUYCODE = 'INVN'
      SKIP
      LOOP
   ENDIF
   
   IF PO_SUFFIX = '8' .OR. PO_SUFFIX = '9'
      SKIP
      LOOP
   ENDIF
   
   IF MSEL_INV = 'INV'
      IF RSUPCODE <> 'INVN'
         SKIP
         LOOP
      ENDIF
   ENDIF
   
   IF MOPT_SALES <> '**'     
      IF MOPT_SALES <> SALESMAN
         SKIP
         LOOP
      ENDIF
   ENDIF
   
   STORE SALESMAN TO MSALESMAN
   STORE PO_NBR TO MPO_NBR
   STORE PO_SUFFIX TO MPO_SUFFIX
   
   SELECT B
   SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
   DO WHILE .NOT. EOF() .AND. SALESMAN = MSALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX
      SELECT C
      SEEK 'R' + B->PROD_DESC
      MPROD_CAT = PROD_CAT
      SELECT B
      DO CASE 
      CASE MPROD_CAT = 'B'
         MBEEF_D = MBEEF_D +  TOT_SELL
         IF LBS_CALC = 0
            MBEEF_L = MBEEF_L + LBS
         ELSE
            MBEEF_L = MBEEF_L + LBS_CALC
         ENDIF
      CASE MPROD_CAT = 'P'
         MPORK_D = MPORK_D + TOT_SELL
         IF LBS_CALC = 0
            MPORK_L = MPORK_L + LBS
         ELSE
            MPORK_L = MPORK_L + LBS_CALC
         ENDIF
      CASE MPROD_CAT = 'F'
         MFOODSRV_D = MFOODSRV_D + TOT_SELL
         IF LBS_CALC = 0
            MFOODSRV_L = MFOODSRV_L + LBS      
         ELSE
            MFOODSRV_L = MFOODSRV_L + LBS_CALC
         ENDIF
      CASE MPROD_CAT = 'O'
         MOTHER_D = MOTHER_D + TOT_SELL
         IF LBS_CALC = 0
            MOTHER_L = MOTHER_L + LBS
         ELSE
            MOTHER_L = MOTHER_L + LBS_CALC
         ENDIF
      OTHERWISE
         MUNKNOWN_D = MUNKNOWN_D + TOT_SELL
         IF LBS_CALC = 0
            MUNKNOWN_L = MUNKNOWN_L + LBS
         ELSE
            MUNKNOWN_L = MUNKNOWN_L + LBS_CALC
         ENDIF
      ENDCASE
      SKIP
   ENDDO
   SELECT A
   SKIP
ENDDO

IF MDISP_PRT = 'P'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'
   
ENDIF

MLINE = 99
MPAGE_NO = 0

IF MLINE > MPAGE_LEN
   IF MLINE = 99 .AND. MDISP_PRT <> 'P'
      CLEAR
   ENDIF
   MPAGE_NO = MPAGE_NO + 1
   @ 1,27 SAY MCOMPANY
   @ 2,1 SAY 'Page'
   @ 2,06 say mpage_no picture '99'
   @ 2,13 SAY 'SALES BY PRODUCT CATEGORY FOR ' + DTOC(MSTART) + ' - ' + DTOC(MLAST)
   @ 2,70 SAY DTOC(DATE())
   IF MSEL_INV = 'INV'
      @ 3,24 SAY 'ONLY SALES FROM INVENTORY'
   ELSE
      @ 3,24 SAY 'ALL SALES/INVENTORY AND DIRECT'
   ENDIF
   @ 3,70 SAY TIME()
   IF MDISP_PRT = 'P'
      @ 3,01 SAY REPLICATE('_',79)
   ENDIF
   MLINE = 6
ENDIF
IF MCOMPANY <> 'DIVISION 15'
   @ MLINE,1 SAY 'POULTRY/OTHER SALE DOLLARS:'
ELSE
   @ MLINE,1 SAY ' FOOD SERVICE SALE DOLLARS:'
ENDIF
@ MLINE,30 SAY MFOODSRV_D PICTURE '99,999,999.99' 
MLINE = MLINE + 1
@ MLINE,1 SAY '                    POUNDS:'
@ MLINE,30 SAY MFOODSRV_L PICTURE '99,999,999.99'
MLINE = MLINE + 2
IF MBEEF_L <> 0 .OR. MBEEF_D <> 0
   @ MLINE,1 SAY '         BEEF SALE DOLLARS:'
   @ MLINE,30 SAY MBEEF_D PICTURE '99,999,999.99' 
   MLINE = MLINE + 1
   @ MLINE,1 SAY '                    POUNDS:'
   @ MLINE,30 SAY MBEEF_L PICTURE '99,999,999.99'
   MLINE = MLINE + 2
ENDIF
IF MPORK_L <> 0 .OR. MPORK_D <> 0
   @ MLINE,1 SAY '         PORK SALE DOLLARS:'
   @ MLINE,30 SAY MPORK_D PICTURE '99,999,999.99' 
   MLINE = MLINE + 1
   @ MLINE,1 SAY '                    POUNDS:'
   @ MLINE,30 SAY MPORK_L PICTURE '99,999,999.99'
   MLINE = MLINE + 2
ENDIF
IF MOTHER_L <> 0 .OR. MOTHER_D <> 0
   @ MLINE,1 SAY '   OTHER/MISC SALE DOLLARS:'
   @ MLINE,30 SAY MOTHER_D PICTURE '99,999,999.99' 
   MLINE = MLINE + 1
   @ MLINE,1 SAY '                    POUNDS:'
   @ MLINE,30 SAY MOTHER_L PICTURE '99,999,999.99'
   MLINE = MLINE + 2
ENDIF
IF MUNKNOWN_L <> 0 .OR. MUNKNOWN_D <> 0
   @ MLINE,1 SAY ' UNKNOWN CAT. SALE DOLLARS:'
   @ MLINE,30 SAY MUNKNOWN_D PICTURE '99,999,999.99' 
   MLINE = MLINE + 1
   @ MLINE,1 SAY '                    POUNDS:'
   @ MLINE,30 SAY MUNKNOWN_L PICTURE '99,999,999.99'
   MLINE = MLINE + 2
ENDIF

IF MDISP_PRT = 'P'
   MLINE = MLINE + 1
   @ MLINE+1,1 SAY ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
   
ELSE
   MPRT_SEL = ' '
   @ 24,0 SAY 'End Of Report - Press Return to Continue ' GET MPRT_SEL
   READ
ENDIF
CLOSE DATA
RETURN

*Formatted by: ToolBox Ver. 1.2  on 7/22/14 at 2:31 PM.
