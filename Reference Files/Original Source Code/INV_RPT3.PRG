************
* Program.: INV_RPT3.PRG
* Author..: GRACE KELLER
* Date....: 09/30/13
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: INVENTORY REPORT
*
* ---SET environment.
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     

SET CENTURY ON
SET DELETED ON
SET TALK OFF
SET ECHO OFF
SET BELL OFF
SET MENU OFF
SET SAFETY OFF
SET ESCAPE ON
SET SCOREBOARD ON
SET STATUS OFF
SET EXCLUSIVE OFF
SET PATH TO \AMERIFOX   
SET DECIMALS TO 5
SET DEVICE TO SCREEN

CLIPPER = .F.
FOXBASE = .T.
MMONO   = .F.

* ---SET COLOR TO values.   (If changed, change other one farther down too)
IF .NOT. MMONO .AND. ISCOLOR()
   SET COLOR TO W+/B,W+/R
ELSE
   SET COLOR TO W/N,N/W
ENDIF

CLOSE ALL
SET DEVICE TO SCREEN

**** FINISHES THE READ WHEN DOING A PAGE DOWN

SELECT A
DO FOX_USE WITH "C:\COMPINFO\SCREEN", .F.
MSCRNSIZE = SCRNSIZE
USE

DO CASE
   *** TEST
CASE MSCRNSIZE = 'T'
   DEFINE WINDOW MWINDOW ;
      FROM 2,24 TO 40,252 ;
      FONT "LUCIDA CONSOLE", 18 ;
      COLOR W+/B, W+/R ;
      NONE
   *** Jeni
CASE MSCRNSIZE = 'J'
   **GOOD - FROM 2,10 TO 35,200  
   **BETTER-  FROM 2,5 TO 35,210
   DEFINE WINDOW MWINDOW ;
      FROM 2,5 TO 40,210 ;
      FONT "LUCIDA CONSOLE", 16 ;
      COLOR W+/B, W+/R ;
      NONE
   *** WIDESCREEN
CASE MSCRNSIZE = 'W'
   DEFINE WINDOW MWINDOW ;
      FROM 5,30 TO 57,272 ;
      FONT "LUCIDA CONSOLE", 20 ;
      COLOR W+/B, W+/R ;
      NONE
   *** LAPTOP
CASE MSCRNSIZE = 'L'
   DEFINE WINDOW MWINDOW ;
      FROM 2,23 TO 54,265 ;
      FONT "LUCIDA CONSOLE", 20 ;
      COLOR W+/B, W+/R ;
      NONE
   *** OTHER - SQUARE 
OTHERWISE
   DEFINE WINDOW MWINDOW ;
      FROM 5,4 TO 57,200 ;
      FONT "LUCIDA CONSOLE", 19 ;
      COLOR W+/B, W+/R ;
      NONE
ENDCASE

ACTIVATE WINDOW "MWINDOW"

* ---MAIN PROCESSING LOOP
CLEAR
SET COLOR TO W/W,W/W
SET COLOR TO W+/B+,W+/R+
CLEAR


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

* ---Initialize global variables.
SELECT A
DO FOX_USE WITH "COMPANY", .F.
MCOMPANY = TRIM(COMPANY)
MMASTDBF = TRIM(MASTDBF)
MDBFLOC = TRIM(DBFLOC)
USE

SELECT A
DO FOX_USE WITH "&MMASTDBF.CONTROL", .F.
MPROGRAM = TRIM(PROGRAM)
MPROG_CODE = PROG_CODE
USE

IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SELECT A
   DO FOX_USE WITH "C:\COMPINFO\PRINTERS", .F.
   MPRINTER  = TRIM(PRINTER1)
   MPRINTER2 = TRIM(PRINTER2)
   MPRINTER3 = TRIM(PRINTER3)
   USE
ELSE
   MPRINTER  = 'DONOTPRINT'
   MPRINTER2 = 'DONOTPRINT'
   MPRINTER3 = 'DONOTPRINT'
ENDIF  

MPRINTIT  = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER
MPRINTIT2 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER2
MPRINTIT3 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER3


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

STORE 'BROKER SYSTEM' TO MPROGRAM

STORE .T. TO MONO

MPASSWORD = 'ADM99'
MUSER = 'SUPERVISOR'
MSECURITY = .T.

ON KEY LABEL PGUP CLEAR READ
ON KEY LABEL PGDN CLEAR READ

CLEAR
@ 00,00 SAY MCOMPANY
@ 01,68 SAY DATE()
@ 01,00 SAY MPROGRAM + ' - Inventory Summary by Freezer'
@ 2,0 to 24,79

@ 4,1 CLEAR TO 22,78
@ 24,0 CLEAR
SELECT C
USE TEMPPROD EXCLUSIVE
DELETE ALL
PACK
INDEX ON PROD_DESC + BUY_CODE TO TEMPPROD

DO FOX_USE WITH "TEMPPROD INDEX TEMPPROD", .F.
DO FILELOCK
STORE ' ' TO MCHOICE
**** GET FIRST AND LAST DATES FOR THIS REPORT
STORE CTOD(' ') TO MSTART, MLAST
STORE 'P' TO MDISP_PRT
STORE SPACE(10) TO MPROD
STORE ' ' TO MCHOICE1, MCHOICE2, MCHOICE3, MCHOICE4
STORE SPACE(2) TO MTRAN_MO
STORE SPACE(4) TO MTRAN_YR
STORE CTOD('') TO MBEGIN, MEND
STORE 'D' TO MTOT_DET
STORE 'N' TO MPRT_PRICE
STORE 'N' TO MPENDING
STORE 2 TO MACTION
DO WHILE MACTION = 2      
   @ 03,5 SAY 'Totals by Product for: ' 
   @ 5,2 say 'Begin Ship Date: ' get mbegin
   @ 6,2 say 'End   Ship Date: ' get mend
   **@ 10,2 say "Print Pricing (Y/N): " GET MPRT_PRICE PICTURE '@!' VALID(MPRT_PRICE = 'Y' .OR. MPRT_PRICE = 'N')
   @ 10,2 say "Print Pending Info (Y/N): " GET MPENDING PICTURE '@!' VALID(MPRT_PRICE = 'Y' .OR. MPRT_PRICE = 'N')
   @ 13,1 SAY 'PRODUCT CODE: ' get mprod picture '@!'
   @ 14,1 say '(Optional - Leave product blank if report for all products.)'
   @ 17,1 SAY 'Optionally select specific Freezer - select with a  "Y" OR "X"'
   @ 19,3 SAY 'Ship to Freezer:'
   @ 19,20 GET MCHOICE4 PICTURE '@!' VALID(MCHOICE4 = ' ' .OR. MCHOICE4 = 'Y' .OR. MCHOICE4 = 'X')
   STORE 1 TO MACTION
   @ 24,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'                     
   
   READ
   
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
ENDDO
IF MACTION = 3
   QUIT
ENDIF  
STORE SPACE(4) TO MBBUYCODE, MRSUPCODE, MBUY_CODE, MSUP_CODE
IF MCHOICE4 = 'Y'
   STORE 'X' TO MCHOICE4
ENDIF
IF MCHOICE4 = 'X'
   CLEAR
   MWAIT = ' '
   @ 5,1 SAY 'PRESS ENTER TO SELECT SHIP TO FREEZER' GET MWAIT
   READ
   MNAME_FD = .F.
   SET PROC TO BUY_PROC
   DO BUY_SEL1
   IF MNAME_FD
      STORE BUY_CODE TO MBUY_CODE
      STORE NAME TO MBUY_NAME
      STORE CITY TO MBUY_CITY
      STORE STATE TO MBUY_STATE
   ELSE
      MCHOICE4 = ' '
   ENDIF
   SET PROC TO 
   USE
ENDIF

IF MBUY_CODE = SPACE(4)
   MNAME = 'NO SHIP TO FREEZER SELECTED'
   MCITY = SPACE(20)
   MSTATE = SPACE(2)
ENDIF

@ 4,1 CLEAR TO 22,78
@ 24,0 CLEAR

MTITLE = ' - PRODUCT LISTING'
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 to 24,79

SELECT C
DO FILELOCK

*** REPORT IS TOTALED BY PRODUCT/FREEZER
MPRT_ACT = 'C'

IF MDISP_PRT = 'P'
   DO PRT_SET
   
   IF MPRT_ACT <> 'C'
      QUIT
   ENDIF
   MPAGE_LEN = 56
ELSE
   MPAGE_LEN = 20
ENDIF

SELECT A 
DO FOX_USE WITH "PO_HEAD INDEX PO_SHIP", .F.
SELECT B
DO FOX_USE WITH "PO_DTL INDEX  PO_DTL", .F.

MSUB = 0
STORE SUBSTR(DTOC(MBEGIN),7) TO MTRAN_YR
STORE SUBSTR(DTOC(MBEGIN),1,2) TO MTRAN_MO
SELECT A
SEEK MTRAN_YR + MTRAN_MO
DO WHILE .NOT. EOF() .AND. SHIP_DATE < MBEGIN    
   SKIP
ENDDO

MPAGE_NO = 0
MLINE = 99 
@ 19,16 SAY 'PROCESSING........'
IF MDISP_PRT = 'P'
   
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON
   
   *** PRINT IN 12 CPI
   ?? chr(27) + '&k4S'
   
   *** BOLDED PRINT
   ?? CHR(27) + '(s4B'
   
   *** LETTER SIZE PAPER
   ?? CHR(27) + '&l2A'
   
   *** PORTRAIT MODE
   ?? CHR(27) + '&l0O'
   
ENDIF

DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MEND   
   
   IF BBUYCODE <> 'INVN'
      SKIP
      LOOP
   ENDIF
   
   IF MBUY_CODE <> SPACE(4)
      IF BUY_CODE <> MBUY_CODE
         SKIP
         LOOP
      ENDIF
   ENDIF
   
   SELECT B
   SEEK A->SALESMAN + A->PO_NBR + A->PO_SUFFIX
   DO WHILE .NOT. EOF() .AND. SALESMAN = A->SALESMAN .AND. PO_NBR = A->PO_NBR .AND. PO_SUFFIX = A->PO_SUFFIX
      IF PROD_DESC = SPACE(4)
         SKIP
         LOOP
      ENDIF
      IF MPROD <> SPACE(10)
         IF MPROD <> PROD_DESC
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      SELECT C
      SEEK B->PROD_DESC + A->BUY_CODE
      IF EOF()
         APPEND BLANK
         REPLACE PROD_DESC WITH B->PROD_DESC
         REPLACE BUY_CODE WITH A->BUY_CODE
      ENDIF
      IF SUBSTR(B->PACKED,1,1) = 'B'
         MCALC_LBS = ROUND(VAL(SUBSTR(B->PACKED,2)) * B->LBS,4)
      ELSE
         MCALC_LBS = B->LBS
      ENDIF
      
      IF A->BROKERAGE <> 'H'
         REPLACE TOT_CASE WITH TOT_CASE + B->QTY
         REPLACE TOT_SELL WITH TOT_SELL + B->TOT_SELL
         REPLACE TOT_LBS  WITH TOT_LBS  + MCALC_LBS
      ELSE
         REPLACE COMM_CASE WITH COMM_CASE + B->QTY
         REPLACE COMM_LBS  WITH COMM_LBS  + MCALC_LBS
      ENDIF
      
      SELECT B
      SKIP
   ENDDO
   
   SELECT A
   SKIP
ENDDO
SELECT A
USE
SELECT B
USE

MFIRST = .T.
MTOT_SELL = 0
SELECT A
DO FOX_USE WITH "&MDBFLOC.BUYER INDEX &MDBFLOC.BUY_CODE", .F.

SELECT C
INDEX ON PROD_DESC + STR(999999999 - LBS_SOLD,10) TO TEMPPROD

DO FOX_USE WITH "TEMPPROD INDEX TEMPPROD", .F.
DO FILELOCK
STORE 0 TO GTOT_CASE, GTOT_SELL, GTOT_LBS, GPTOT_CASE, GPTOT_LBS
STORE 0 TO MTOT_CASE, MTOT_SELL, MTOT_LBS, PTOT_CASE, PTOT_LBS

DO WHILE .NOT. EOF()
   STORE PROD_DESC TO MPROD_DESC
   MPRT_PROD = .T.
   DO WHILE .NOT. EOF() .AND. PROD_DESC = MPROD_DESC
      IF MLINE > MPAGE_LEN
         IF MDISP_PRT = 'D'
            IF MLINE = 99
               CLEAR
            ELSE
               MCONT = 'C'
               @ 24,1 SAY "PRESS 'ENTER' TO CONTINUE OR 'A' TO CANCEL REPORT " GET MCONT PICTURE '@!'
               READ
               IF MCONT = 'A'
                  SELECT C
                  GOTO BOTTOM
                  SKIP
                  LOOP
               ELSE
                  CLEAR
               ENDIF
            ENDIF
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 1,25 SAY MCOMPANY
         @ 1,1 SAY 'Page'
         @ 1,06 say mpage_no picture '99'
         @ 1,58 SAY DTOC(DATE())
         @ 2,16 SAY '     PRODUCT TOTALS FOR ' + DTOC(MBEGIN) + ' - ' + DTOC(MEND)
         MLINE = 4
         IF MBUY_CODE <> SPACE(4)
            @ MLINE,16 SAY '     SHIP TO FREEZER: ' + MBUY_NAME
            MLINE = MLINE + 2
         ENDIF
         IF MPENDING = 'Y'
            @ MLINE,1 SAY 'PRODUCT     FREEZER                    QTY IN     LBS IN     DLRS IN  PEND QTY    PEND LBS'
         ELSE
            @ MLINE,1 SAY 'PRODUCT     FREEZER                    QTY IN     LBS IN     DLRS IN'
         ENDIF
         *                         1234567890123456789012345  XXX,XXX  X,XXX,XXX  XX,XXX,XXX    XXX,XXX  XX,XXX,XXX
         *              1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
         *                       10        0         30        40        50        60        70        80        90
         
         MLINE = MLINE + 2
      ENDIF
      IF MPRT_PROD
         @ MLINE,1 SAY PROD_DESC
         MPRT_PROD = .F.
      ENDIF
      SELECT A
      SEEK C->BUY_CODE
      IF EOF()
         @ MLINE,13 SAY 'FREEZER NOT ON FILE'
      ELSE
         @ MLINE,13 SAY SUBSTR(NAME,1,25)
      ENDIF
      SELECT C
      
      @ MLINE,37 SAY TOT_CASE PICTURE '9,999,999'
      @ MLINE,48 SAY TOT_LBS  PICTURE '9,999,999'
      @ MLINE,59 SAY TOT_SELL PICTURE '99,999,999'
      IF MPENDING = 'Y'
         @ MLINE,73 SAY COMM_CASE PICTURE '99,999'
         @ MLINE,82 SAY COMM_LBS  PICTURE '9,999,999'
      ENDIF
      MTOT_CASE = MTOT_CASE + TOT_CASE
      MTOT_LBS  = MTOT_LBS  + TOT_LBS
      MTOT_SELL = MTOT_SELL + TOT_SELL
      PTOT_CASE = PTOT_CASE + COMM_CASE
      PTOT_LBS  = PTOT_LBS  + COMM_LBS
      
      GTOT_CASE = GTOT_CASE + TOT_CASE
      GTOT_LBS  = GTOT_LBS  + TOT_LBS
      GTOT_SELL = GTOT_SELL + TOT_SELL
      GPTOT_CASE = GPTOT_CASE + COMM_CASE
      GPTOT_LBS  = GPTOT_LBS  + COMM_LBS
      
      MLINE = MLINE + 1
      SKIP
   ENDDO
   IF MCHOICE4 = ' '
      
      @ mline,13  say 'TOTAL:'
      @ MLINE,37 SAY MTOT_CASE PICTURE '9,999,999'
      @ MLINE,48 SAY MTOT_LBS  PICTURE '9,999,999'
      @ MLINE,59 SAY MTOT_SELL PICTURE '99,999,999'
      
      IF MPENDING = 'Y'
         @ MLINE,73 SAY PTOT_CASE PICTURE '99,999'
         @ MLINE,82 SAY PTOT_LBS  PICTURE '9,999,999'
      ENDIF
   ENDIF
   MLINE = MLINE + 2
ENDDO

@ mline,13  say 'GRAND TOTAL:'
@ MLINE,37 SAY GTOT_CASE PICTURE '9,999,999'
@ MLINE,48 SAY GTOT_LBS  PICTURE '9,999,999'
@ MLINE,59 SAY GTOT_SELL PICTURE '99,999,999'

IF MPENDING = 'Y'
   @ MLINE,73 SAY GPTOT_CASE PICTURE '99,999'
   @ MLINE,82 SAY GPTOT_LBS  PICTURE '9,999,999'
ENDIF

EJECT

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

CLOSE DATA
QUIT  

*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 10:51 AM.
