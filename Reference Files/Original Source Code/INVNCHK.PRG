*************
* Program.: INVNCHK.PRG
* Author..: Grace Keller
* Date....: 10/26/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: FREIGHT LISTING 
*
* ---OPEN FILES
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     

**** NOTE TO RUN - RUN DETAIL REPORT AS OF MONTH BEFORE CLOSING THAT WAS OK
**** TO USE THIS PROGRAM
**** RUN THE CUTOFF REPORT AS OF THE END OF THE PREVIOUS MONTH

SET CENTURY ON
SET DELETED ON
SET TALK OFF
SET ECHO OFF
SET BELL OFF
SET MENU OFF
SET SAFETY OFF
SET ESCAPE ON
SET SCOREBOARD ON
SET STATUS OFF
SET EXCLUSIVE OFF
SET PATH TO \AMERIFOX   
SET DECIMALS TO 5
SET DEVICE TO SCREEN

CLIPPER = .F.
FOXBASE = .T.
MMONO   = .F.

* ---SET COLOR TO values.   (If changed, change other one farther down too)
IF .NOT. MMONO .AND. ISCOLOR()
   SET COLOR TO W+/B,W+/R
ELSE
   SET COLOR TO W/N,N/W
ENDIF

CLOSE ALL
SET DEVICE TO SCREEN

**** FINISHES THE READ WHEN DOING A PAGE DOWN

SELECT A
DO FOX_USE WITH "C:\COMPINFO\SCREEN", .F.
MSCRNSIZE = SCRNSIZE
USE

DO CASE
*** TEST
CASE MSCRNSIZE = 'T'
   DEFINE WINDOW MWINDOW ;
     FROM 2,24 TO 40,252 ;
     FONT "LUCIDA CONSOLE", 18 ;
     COLOR W+/B, W+/R ;
     NONE
*** Jeni
CASE MSCRNSIZE = 'J'
   **GOOD - FROM 2,10 TO 35,200  
   **BETTER-  FROM 2,5 TO 35,210
   DEFINE WINDOW MWINDOW ;
     FROM 2,5 TO 40,210 ;
     FONT "LUCIDA CONSOLE", 16 ;
     COLOR W+/B, W+/R ;
     NONE
*** WIDESCREEN
CASE MSCRNSIZE = 'W'
   DEFINE WINDOW MWINDOW ;
     FROM 5,30 TO 57,272 ;
     FONT "LUCIDA CONSOLE", 20 ;
     COLOR W+/B, W+/R ;
     NONE
*** LAPTOP
CASE MSCRNSIZE = 'L'
   DEFINE WINDOW MWINDOW ;
     FROM 2,23 TO 54,265 ;
     FONT "LUCIDA CONSOLE", 20 ;
     COLOR W+/B, W+/R ;
     NONE
*** OTHER - SQUARE 
OTHERWISE
   DEFINE WINDOW MWINDOW ;
     FROM 5,4 TO 57,200 ;
     FONT "LUCIDA CONSOLE", 19 ;
     COLOR W+/B, W+/R ;
     NONE
ENDCASE

ACTIVATE WINDOW "MWINDOW"

* ---MAIN PROCESSING LOOP
CLEAR
SET COLOR TO W/W,W/W
SET COLOR TO W+/B+,W+/R+
CLEAR


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

* ---Initialize global variables.
SELECT A
DO FOX_USE WITH "COMPANY", .F.
MCOMPANY = TRIM(COMPANY)
MMASTDBF = TRIM(MASTDBF)
MDBFLOC = TRIM(DBFLOC)
USE

SELECT A
DO FOX_USE WITH "&MMASTDBF.CONTROL", .F.
MPROGRAM = TRIM(PROGRAM)
MPROG_CODE = PROG_CODE
USE

IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SELECT A
   DO FOX_USE WITH "C:\COMPINFO\PRINTERS", .F.
   MPRINTER  = TRIM(PRINTER1)
   MPRINTER2 = TRIM(PRINTER2)
   MPRINTER3 = TRIM(PRINTER3)
   USE
ELSE
   MPRINTER  = 'DONOTPRINT'
   MPRINTER2 = 'DONOTPRINT'
   MPRINTER3 = 'DONOTPRINT'
ENDIF  

MPRINTIT  = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER
MPRINTIT2 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER2
MPRINTIT3 = 'COPY C:\COMPINFO\PRT_FILE.TXT ' + MPRINTER3


**********************************************************************
**** THIS WORKS - BUT GIVES AN EXTRA EJECT AT THE END OF JOB**********
**** ORIGINALLY HAD THIS WAY FOR STODDARD COUNTY
**MPRINTIT = "PRINT.EXE /D:" + MPRINTER + " C:\COMPINFO\PRT_FILE.TXT"
**********************************************************************

****TESTING************
****MPRINTIT = "PRINT.EXE /D:\\GRACE64-HP\HP4250 \COMPINFO\PRTFILE.TXT"
****MPRINTIT = "PRINT.EXE /D:\\GINGER-PC\HP940C \REPORTS\PRTFILE.TXT"
*** END OF TESTING*****
************************************************************************

MPROGRAM = 'INVENTORY'

STORE .T. TO MONO

MPASSWORD = 'ADM99'
MUSER = 'SUPERVISOR'
MSECURITY = .T.

ON KEY LABEL PGUP CLEAR READ
ON KEY LABEL PGDN CLEAR READ

**** NOW START MAIN PROCESSING
SET EXCLUSIVE ON  && ALLOW MULTI USER ACCESS TO DATA FILES

SELECT A
USE INVNWORK
DELETE ALL
PACK
APPEND FROM INVNTMP3
GOTO TOP
DO WHILE .NOT. EOF()
   
   IF SUBSTR(PACKED,1,1) = 'B' .OR. PRI_LB >= 10 .OR. LOT_NBR = 'H0 '
      MVAL_LEFT = ROUND(CASE_LEFT * PRI_LB,2)
      replace val_left with mval_lefT
   ELSE
      IF PACKED = 'CWT'
         MLBS_LEFT = LBS_LEFT
         MVAL_LEFT = ROUND(MLBS_LEFT * PRI_LB,2)
         replace val_left with mval_lefT
      ELSE
         MLBS_LEFT = ROUND(CASE_LEFT * BOX_SZ,2)
         MVAL_LEFT = ROUND(MLBS_LEFT * PRI_LB,2)
         replace val_left with mval_left
      ENDIF
   ENDIF
   SKIP
ENDDO
SELECT A
USE

*** THIS CREATES THE STARTING FILE FOR THIS REPORT

***** NOW CREATE THE MONTHLY ACTIVITY REPORT
MMASTDBF = '\AMERICO\'
MDBFLOC = '\AMERI\'
CLEAR
@ 00,00 SAY MCOMPANY
@ 01,68 SAY DATE()
@ 01,00 SAY MPROGRAM + ' - CHECK INVN IN/OUT'
@ 2,0 to 25,79
MPROD    = SPACE(6)
MDIV     = SPACE(2)
MFREEZER = SPACE(40)
MI_NBR   = 0         
MIN_OUT  = 'BOTH'
MIN_TOT  = 0
MOUT_TOT = 0
STORE CTOD('') TO MBEG_DATE, MEND_DATE
MRPT_PICK = '1'
MTOT_ONLY = 'N'
@ 8,3 SAY  'Beginning Activity Date: ' GET MBEG_DATE
@ 10,3 SAY '   Ending Activity Date: ' GET MEND_DATE
@ 12,3 SAY '  Optionl Division Code: ' GET MDIV PICTURE '@!'
@ 14,3 SAY ' Activity (IN/OUT/BOTH): ' GET MIN_OUT PICTURE '@!'
@ 16,3 SAY 'Print totals only (Y/N): ' get mtot_only picture '@!'
READ
IF MRPT_PICK = ' '
   LOOP
ENDIF
IF MTOT_ONLY <> 'N'
   MTOT_ONLY = 'Y'
ENDIF

@ 4,3 CLEAR TO 22,78

IF MIN_OUT = '    '
   MIN_OUT = 'BOTH'
ENDIF
** IF DATES ARE LEFT BLANK, PICK UP ALL ACTIVITY
** BY FORMATTING WITH REAL OLD AND CURRENT BEGIN/END
IF DTOC(MBEG_DATE) = '  /  /  '
   MBEG_DATE = CTOD('01/01/90')
ENDIF
IF DTOC(MEND_DATE) = '  /  /  '
   MEND_DATE = DATE()
ENDIF
MPAGE_LEN = 56
MPAGE_NO = 0
MLINE = 99

@ 21,16 SAY SPACE(34)
@ 21,16 SAY 'PROCESSING............'
SELECT E
DO FOX_USE WITH "&MMASTDBF.DIVISION", .F.

SELECT D 
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE", .F.

SELECT C
DO FOX_USE WITH "&MDBFLOC.PRODUCTS INDEX &MDBFLOC.PRODUCTS", .F.

SELECT B
USE INVNTEMP EXCLUSIVE
DELETE ALL
PACK
DO FOX_USE WITH "INVNTEMP", .F.

SELECT A
DO FOX_USE WITH "INVEN INDEX INVNANIV", .F.

IF MFREEZER <> SPACE(40)
   MFREEZER = TRIM(MFREEZER)
ENDIF
IF MIN_OUT = 'IN' .OR. MIN_OUT = 'BOTH'
   
   IF YEAR(MBEG_DATE) >= YEAR(ANIV_DATE)
      SEEK STR(YEAR(MBEG_DATE),4)
   ENDIF
   
   ** FIRST GET ALL THE SHIPMENTS INTO INVENTORY THAT
   ** FALL INTO THIS DATE RANGE - THESE COME FROM THE "INVEN" FILE
   
   DO WHILE .NOT. EOF() .AND. ANIV_DATE < MBEG_DATE
      SKIP
   ENDDO
   
   DO WHILE .NOT. EOF() .AND. ANIV_DATE <= MEND_DATE
      
      IF LBS = 0 .OR. CASE_CNT = 0
         SKIP
         LOOP
      ENDIF
      
      ** CHECK DIVISION CODE MATCH
      IF MDIV <> SPACE(2)
         IF MDIV <> DIV_CODE
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      ** CHECK PRODUCT DESCRIPTION MATCH
      IF MPROD <> SPACE(6)
         IF MPROD <> PROD_DESC
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      ** CHECK FREEZER MATCH
      IF MFREEZER <> '  '
         IF TRIM(FREEZ_LOC) <> MFREEZER
            SKIP
            LOOP
         ENDIF
      ENDIF
      ** CHECK I NBR MATCH
      IF MI_NBR <> 0
         IF MI_NBR <> I_NBR
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      SELECT B
      DO FILELOCK
      APPEND BLANK
      REPLACE SALESMAN    WITH A->SALESMAN
      REPLACE PO_NBR      WITH A->PO_NBR
      REPLACE PO_SUFFIX   WITH A->PO_SUFFIX
      REPLACE FREEZ_LOC   WITH A->FREEZ_LOC
      REPLACE I_NBR       WITH A->I_NBR
      REPLACE DIV_CODE    WITH A->DIV_CODE
      REPLACE PROD_DESC   WITH A->PROD_DESC
      REPLACE BOX_SIZE    WITH A->BOX_SIZE
      REPLACE LOT_NBR     WITH A->LOT_NBR
      REPLACE SUPPLIER    WITH A->SUPPLIER
      REPLACE LBS         WITH A->LBS
      REPLACE PRI_LB      WITH A->PRI_LB
      REPLACE CASE_CNT    WITH A->CASE_CNT
      REPLACE VALUE       WITH A->VALUE
      REPLACE ACT_DATE    WITH A->ANIV_DATE
      REPLACE ACT_CODE    WITH 'I'
      UNLOCK
      SELECT A
      SKIP
   ENDDO
ENDIF
**HERE      
SELECT A
DO FOX_USE WITH "INVEN INDEX INVNINBR", .F.

SELECT F
DO FOX_USE WITH "INVN_DTL INDEX DTL_DATE", .F.

*** GET ALL THE OUT ACTIVITY FROM THE DETAIL FILE
*** FOR THE SPECIFIED TIME FRAME

IF MIN_OUT = 'OUT' .OR. MIN_OUT = 'BOTH'
   IF YEAR(MBEG_DATE) >= YEAR(ACT_DATE)
      SEEK STR(YEAR(MBEG_DATE),4)
   ENDIF
   ** FIRST GET ALL THE SHIPMENTS OUT OF INVENTORY THAT
   ** FALL INTO THIS DATE RANGE
   DO WHILE .NOT. EOF() .AND. ACT_DATE <  MBEG_DATE
      SKIP
   ENDDO
   DO WHILE .NOT. EOF() .AND. ACT_DATE <= MEND_DATE
      *** IF THIS IS NOT A SHIPMENT RECORD, SKIP IT
      IF ACT_CODE <> 'S'
         SKIP
         LOOP
      ENDIF
      
      IF SHIP_LBS = 0 .OR. SHIP_CASE = 0
         SKIP
         LOOP
      ENDIF
      ** CHECK I NBR MATCH
      IF MI_NBR <> 0
         IF MI_NBR <> I_NBR
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      SELECT A
      SEEK STR(F->I_NBR,5)
      ** CHECK PRODUCT DESCRIPTION MATCH
      IF MPROD <> SPACE(6)
         IF MPROD <> PROD_DESC
            SELECT F
            SKIP
            LOOP
         ENDIF
      ENDIF
      ** CHECK DIVISION CODE MATCH
      IF MDIV <> SPACE(2)
         IF MDIV <> DIV_CODE
            SELECT F
            SKIP
            LOOP
         ENDIF
      ENDIF
      ** CHECK FREEZER MATCH
      IF MFREEZER <> '  '
         IF TRIM(FREEZ_LOC) <> MFREEZER
            SELECT F
            SKIP
            LOOP
         ENDIF
      ENDIF
      
      SELECT B
      DO FILELOCK
      APPEND BLANK
      REPLACE FREEZ_LOC   WITH A->FREEZ_LOC
      REPLACE I_NBR       WITH A->I_NBR
      REPLACE DIV_CODE    WITH A->DIV_CODE
      REPLACE PROD_DESC   WITH A->PROD_DESC
      REPLACE BOX_SIZE    WITH A->BOX_SIZE
      REPLACE LOT_NBR     WITH A->LOT_NBR
      REPLACE SUPPLIER    WITH A->SUPPLIER
      *** GET THIS INFO FROM DETAIL RECORD
      REPLACE SALESMAN    WITH F->SALESMAN
      REPLACE PO_NBR      WITH F->PO_NBR
      REPLACE PO_SUFFIX   WITH F->PO_SUFFIX
      REPLACE LBS         WITH (F->SHIP_LBS * -1)
      REPLACE PRI_LB      WITH F->SHIP_PRI
      REPLACE CASE_CNT    WITH (F->SHIP_CASE * -1)
      REPLACE VALUE       WITH (F->SHIP_VAL * -1)
      REPLACE ACT_DATE    WITH F->ACT_DATE
      REPLACE ACT_CODE    WITH 'S'
      UNLOCK
      SELECT F
      SKIP
   ENDDO
ENDIF

CLOSE ALL

******* NOW ADD IN THE LOTS FROM THE DETAIL FILE THAT WEREN'T
******* THERE AT THE END OF LAST MONTH

SELECT B
USE INVNTEMP EXCLUSIVE
INDEX ON FREEZ_LOC + LOT_NBR TO INVNTEMP
USE INVNTEMP INDEX INVNTEMP

SELECT A
USE INVNWORK
INDEX ON FREEZ_LOC + LOT_NBR TO INVNWORK
USE INVNWORK INDEX INVNWORK

SELECT B
DO WHILE .NOT. EOF()
   SELECT A
   SEEK B->FREEZ_LOC + B->LOT_NBR
   IF EOF()
      APPEND BLANK
      REPLACE FREEZ_LOC WITH B->FREEZ_LOC
      REPLACE LOT_NBR   WITH B->LOT_NBR
      REPLACE PROD_DESC WITH B->PROD_DESC
      
   ENDIF
   SELECT B
   SKIP
ENDDO

*** NOW DO A REPORT OF LOTS WITH IN/OUTS
SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** BOLDED PRINT
?? CHR(27) + '(s4B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

MTOTAL  = 0
MIN = 0
MOUT = 0
MBEGIN = 0
MFREEZER = 0

SELECT A
INDEX ON FREEZ_LOC + PROD_DESC TO INVNWORK
USE INVNWORK INDEX INVNWORK

GOTO TOP

DO WHILE .NOT. EOF()
   STORE FREEZ_LOC TO MFREEZ_LOC
   MFREEZ_TOT = 0
   DO WHILE .NOT. EOF() .AND. FREEZ_LOC = MFREEZ_LOC
      
      ? FREEZ_LOC + '  ' + LOT_NBR + '   ' + TRANSFORM(VAL_LEFT, '9,999,999.99')
      MVAL_LEFT = VAL_LEFT
      MBEGIN = MBEGIN + VAL_LEFT
      SELECT B
      SEEK A->FREEZ_LOC + A->LOT_NBR
      DO WHILE .NOT. EOF() .AND. FREEZ_LOC = A->FREEZ_LOC .AND. LOT_NBR = A->LOT_NBR
         ? SPACE(18) + TRANSFORM(CASE_CNT, '99999') + SPACE(3) + TRANSFORM(LBS, '99999.99') + SPACE(3) + TRANSFORM(PRI_LB, '99.9999') + SPACE(3) + TRANSFORM(VALUE, '999,999.99')
         IF ACT_CODE = 'I'
            MIN = MIN + VALUE
         ELSE
            MOUT = MOUT + VALUE
         ENDIF
         MVAL_LEFT = MVAL_LEFT + VALUE
         SKIP
      ENDDO
      ? SPACE(27) + 'ENDING LOT VALUE: ' + TRANSFORM(MVAL_LEFT, '9,999,999.99')
      MTOTAL = MTOTAL + MVAL_LEFT
      MFREEZ_TOT = MFREEZ_TOT + MVAL_LEFT
      ?
      SELECT A
      SKIP
   ENDDO
   
   ?
   ?
   ? MFREEZ_LOC + '  ' + SPACE(8) + '   ' + TRANSFORM(MFREEZ_TOT, '9,999,999.99')
   ?
   ?
ENDDO
?
?
? 'BEGIN  VALUE: ' + TRANSFORM(MBEGIN, '9,999,999.99')
? 'IN     VALUE: ' + TRANSFORM(MIN, '9,999,999.99')
? 'OUT    VALUE: ' + TRANSFORM(MOUT, '9,999,999.99')
? 'ENDING VALUE: ' + TRANSFORM(MTOTAL, '9,999,999.99')

?
EJECT

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF
CLOSE DATA
QUIT

*Formatted by: ToolBox Ver. 1.2  on 7/21/14 at 12:33 PM.
