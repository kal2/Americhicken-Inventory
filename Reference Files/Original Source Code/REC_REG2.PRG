********************
* Program.: REC_REG2.PRG
* Author..: GRACE KELLER
* Date....: 01/16/97
* Notice..: Copyright (C) 1988, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: RECEIPTS REGISTER REPORT
*
*  MULTI-USER RECORD/FILE LOCKING  +(M1)  FoxPro   Multi-User Code Insertion     
STORE ' ' TO MSELECTION
STORE ' ' TO MACTION
MTITLE = " - RECEIPT REGISTER TOTALS FOR ALL D/B'S"
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
**** GET DATE FOR THIS REPORT
STORE DATE() TO MBEG_DATE, MEND_DATE
STORE 2 TO MACTION      
DO WHILE MACTION = 2      
   @ 08,5 SAY 'BEGIN REPORT DATE: '
   @ 08,24 GET MBEG_DATE
   @ 10,5 SAY '  END REPORT DATE: ' 
   @ 10,24 GET MEND_DATE
   STORE 1 TO MACTION
   @ 23,00 CLEAR
   @ 24,01 SAY 'Action: ' + STR(MACTION,1)
   @ 24,13 SAY '1. Continue    2.  Edit    3. Cancel Report'
   READ
   @24,09 GET MACTION PICTURE '9' RANGE 1,3
   READ               
   IF MACTION = 1
      IF DTOC(MBEG_DATE) = '  /  /  ' .OR. DTOC(MEND_DATE) = '  /  /  '
         @ 24,0 CLEAR
         mwait = ' '
         @ 24,1 SAY 'BOTH DATES NOT ENTERED - PRESS ANY KEY TO REENTER' GET MWAIT
         READ
         MACTION = 2
         @ 24,0 CLEAR
         RETURN
      ENDIF
   ENDIF
ENDDO

IF MACTION = 3
   RETURN
ENDIF  

MPRT_ACT = 'C'

DO PRT_SET
IF MPRT_ACT <> 'C'
   RETURN 
ENDIF
MPAGE_LEN = 56

MPAGE_NO = 0
MLINE = 99 

SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'

MTOTAL = 0
MTOT_CRED = 0
MTOT_MISC = 0

** LOC_CODE = 'L' - LOCKBOX
** LOC_CODE = 'B' - LOCAL BANK      

TLOCKBOX  = 0
TLOCBANK  = 0
TOTHER    = 0

MDATE = MBEG_DATE

DO WHILE MDATE <= MEND_DATE
   
   STORE MONTH(MDATE) TO MMONTH
   MMONTH = MMONTH + 100
   STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH
   STORE YEAR(MDATE) TO MYEAR
   STORE STR(MYEAR,4) TO MYEAR
   STORE DAY(MDATE) TO MDAY
   MDAY = MDAY + 100
   STORE SUBSTR(STR(MDAY,3),2) TO MDAY
   
   MLOCKBOX  = 0
   MLOCBANK  = 0
   MOTHER    = 0
   
   SELECT A
   DO CASE
   CASE MMASTDBF = '\AMERI\'
      DO FOX_USE WITH "\AMERI\PAYMENTS INDEX \AMERI\PAY_DATE, \AMERI\PAY_PO", .F.
   CASE MMASTDBF = '\AMERICO\'
      DO FOX_USE WITH "\AMERICO\PAYMENTS INDEX \AMERICO\PAY_DATE, \AMERICO\PAY_PO", .F.
   OTHERWISE
      DO FOX_USE WITH "\BROKER\PAYMENTS INDEX \BROKER\PAY_DATE, \BROKER\PAY_PO", .F.
   ENDCASE
   SEEK MYEAR + MMONTH + MDAY
   DO WHILE .NOT. EOF() .AND. MDATE = PAID_DATE
      DO CASE
      CASE ACCOUNT = '8397' .OR. ACCOUNT = '8599'
         MOTHER   = MOTHER   + AMT_PAID + CRED_AMT + AMT_OVER
      CASE LOC_CODE = 'L'
         MLOCKBOX = MLOCKBOX + AMT_PAID + CRED_AMT + AMT_OVER
      CASE LOC_CODE = 'B'
         MLOCBANK = MLOCBANK + AMT_PAID + CRED_AMT + AMT_OVER
      OTHERWISE
         MOTHER   = MOTHER   + AMT_PAID + CRED_AMT + AMT_OVER
      ENDCASE
      SKIP
   ENDDO
   
   
   IF MOTHER <> 0 .OR. MLOCKBOX <> 0 .OR. MLOCBANK <> 0
      IF MLINE > MPAGE_LEN
         IF MLINE <> 99
            EJECT
         ENDIF
         MPAGE_NO = MPAGE_NO + 1
         @ 1,34 SAY MCOMPANY
         @ 2,0 SAY 'PAGE'
         @ 2,05 SAY MPAGE_NO PICTURE '99'
         IF MBEG_DATE = MEND_DATE
            @ 2,30 SAY 'RECEIPTS REGISTER FOR ' + DTOC(MBEG_DATE)
         ELSE 
            @ 2,22 SAY 'RECEIPTS REGISTER FOR ' + DTOC(MBEG_DATE) + ' THRU ' + DTOC(MEND_DATE)
         ENDIF
         @ 2,70 SAY DTOC(DATE())
         @ 4,2 SAY 'DEP DATE'
         @ 4,13 SAY '  LOCAL 01/15   LCL 01/15 OTH     TOTAL LOCAL   LOCKBOX 01/15   TOTAL ALL DEP'
         @ 4,2 SAY REPLICATE ('_',88)
         MLINE = 6
      ENDIF
      @ MLINE,2 SAY MDATE     
      @ MLINE,13 SAY MLOCBANK  PICTURE '99,999,999.99'
      @ MLINE,29 SAY MOTHER    PICTURE '99,999,999.99'
      @ MLINE,45 SAY MOTHER+MLOCBANK    PICTURE '99,999,999.99'
      @ MLINE,61 SAY MLOCKBOX  PICTURE '99,999,999.99'
      @ MLINE,77 SAY MOTHER+MLOCBANK+MLOCKBOX  PICTURE '99,999,999.99'
      MLINE = MLINE + 2
      TLOCKBOX = TLOCKBOX + MLOCKBOX
      TLOCBANK = TLOCBANK + MLOCBANK
      TOTHER   = TOTHER   + MOTHER
   ENDIF
   MDATE = MDATE + 1
ENDDO

IF MLINE <> 99 
   @ MLINE,2 SAY 'TOTALS:'          
   @ MLINE,13 SAY TLOCBANK  PICTURE '99,999,999.99'
   @ MLINE,29 SAY TOTHER    PICTURE '99,999,999.99'
   @ MLINE,45 SAY TOTHER+TLOCBANK    PICTURE '99,999,999.99'
   @ MLINE,61 SAY TLOCKBOX  PICTURE '99,999,999.99'
   @ MLINE,77 SAY TOTHER+TLOCBANK+TLOCKBOX  PICTURE '99,999,999.99'
   
ELSE
   @ 5,2 SAY 'NO DATA FOR THE SELECTED DATES'
ENDIF
@ MLINE+1,1 SAY ' '

EJECT

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

CLOSE DATA
RETURN
*Formatted by: ToolBox Ver. 1.2  on 12/10/15 at 2:33 PM.
