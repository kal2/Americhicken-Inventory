***********************
* Program.: ITEM_ADD.PRG
* Author..: Grace Keller
* Date....: 04/10/94
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: ORDER ITEM ADD - MULTIPLE PAGES
*         :                  NEW FOR AUTOMATIC INVENTORY UPDATING
*
* ---OPEN FILES
RELEASE MQTY
RELEASE MFR_FZ
RELEASE MGRADE
RELEASE MPAK  
RELEASE MCLASS
RELEASE MPROD
RELEASE MSIZE
RELEASE MPACKSPEC
RELEASE MLBS
RELEASE MPURC_PRI
RELEASE MSELL_PRI
RELEASE MPURC_TOT
RELEASE MSELL_TOT
RELEASE MSHRT_BOX
RELEASE MSHRT_LBS
RELEASE MBILL_PRI
RELEASE MPAK1  
RELEASE MPAK2  
RELEASE MBOX_SZ
RELEASE MOLD_LOT
RELEASE MOLD_LBS
RELEASE MOLD_QTY
RELEASE MOLD_PROD
RELEASE MIN_LOT
RELEASE MOUT_LOT
RELEASE MOLD_IN
RELEASE MOLD_OUT
RELEASE MSTOR_ITEM
RELEASE MPAK_YR
RELEASE MPAK_DAY
RELEASE MOUT_YR
RELEASE MOUT_DAY

DIMENSION MQTY(7)
DIMENSION MFR_FZ(7)
DIMENSION MGRADE(7)
DIMENSION MPAK(7)  
DIMENSION MCLASS(7)
DIMENSION MPROD(7)
DIMENSION MSIZE(7)
DIMENSION MPACKSPEC(7)
DIMENSION MLBS(7)
DIMENSION MPURC_PRI(7)
DIMENSION MSELL_PRI(7)
DIMENSION MPURC_TOT(7)
DIMENSION MSELL_TOT(7)
DIMENSION MSHRT_BOX(7)
DIMENSION MSHRT_LBS(7)
DIMENSION MBILL_PRI(7)
DIMENSION MPAK1(7)  
DIMENSION MPAK2(7)  
DIMENSION MBOX_SZ(7)
DIMENSION MOLD_LOT(7)
DIMENSION MOLD_LBS(7)
DIMENSION MOLD_QTY(7)
DIMENSION MOLD_PROD(7)
DIMENSION MIN_LOT(7)
DIMENSION MOUT_LOT(7)
DIMENSION MOLD_IN(7)
DIMENSION MOLD_OUT(7)
DIMENSION MSTOR_ITEM(7)
DIMENSION MPAK_YR(7)
DIMENSION MPAK_DAY(7)
DIMENSION MOUT_YR(7)
DIMENSION MOUT_DAY(7)

IF B->BROKERAGE = 'H'
   SET PROC TO H_PROC
ELSE
   SET PROC TO I_PROC
ENDIF
MMORE_ITM = .T.  
MPAGE = 1
CLEAR
@  1, 0 SAY MCOMPANY
@  1,68 SAY DATE()
MTITLE = ' - ADD ORDER ITEMS'
@  2, 0 SAY MPROGRAM + MTITLE
@  2,45 SAY 'ORDER #:'
@ 2,55 SAY MSALESMAN
@ 2,57 SAY '-'
@ 2,58 SAY MPO_NBR
IF MPO_SUFFIX <> ' '
   @ 2,62 SAY '-'
   @ 2,63 SAY MPO_SUFFIX
ENDIF

DO TEXT2ND
@ 3,65 SAY 'ITEMS: PAGE '
MPAGE = 1 

DO WHILE MMORE_ITM
   @ 3,77 SAY STR(MPAGE,2)
   MNBR_ITM = 1
   DO WHILE MNBR_ITM <= 7
      STORE 0 TO MQTY(MNBR_ITM), MLBS(MNBR_ITM), MBOX_SZ(MNBR_ITM)
      STORE 0 TO MOLD_QTY(MNBR_ITM), MOLD_LBS(MNBR_ITM)
      STORE 0 TO MPURC_PRI(MNBR_ITM), MSELL_PRI(MNBR_ITM), MSTOR_ITEM(MNBR_ITM)
      IF B->RSUPCODE = 'INVN'
         STORE 'FR' TO MFR_FZ(MNBR_ITM)
      ELSE
         STORE SPACE(2) TO MFR_FZ(MNBR_ITM)
      ENDIF
      STORE SPACE(1) TO MPAK1(MNBR_ITM), MPAK2(MNBR_ITM), MGRADE(MNBR_ITM)
      IF MCOMPANY = 'AMERICHICKEN, INC' .OR. MCOMPANY = 'MIDWEST FOOD -DIV 11'
         STORE SPACE(6) TO MPROD(MNBR_ITM), MOLD_PROD(MNBR_ITM)
         STORE SPACE(6) TO MPACKSPEC(MNBR_ITM)
      ELSE
         STORE SPACE(6) TO MPROD(MNBR_ITM), MOLD_PROD(MNBR_ITM)
         STORE SPACE(6) TO MPACKSPEC(MNBR_ITM)
      ENDIF
      STORE SPACE(10) TO MIN_LOT(MNBR_ITM), MOLD_IN(MNBR_ITM)
      STORE SPACE(10) TO MOUT_LOT(MNBR_ITM), MOLD_OUT(MNBR_ITM)
      STORE SPACE(5) TO MSIZE(MNBR_ITM)
      STORE 0 TO MPAK_YR(MNBR_ITM), MPAK_DAY(MNBR_ITM)
      STORE 0 TO MOUT_YR(MNBR_ITM), Mout_DAY(MNBR_ITM)
      MNBR_ITM = MNBR_ITM + 1
   ENDDO
   @ 8,0 CLEAR TO 22,80
   MACTION = 2      
   DO WHILE MACTION = 2
      MLINE = 8  
      MNEXT_ITM = .T.
      MNBR_ITM = 1
      
      **** DO ONE PAGE AT A TIME
      DO WHILE MNBR_ITM <= 7 .AND. MNEXT_ITM
         
         DO GETITM
         
         IF MPROD(MNBR_ITM) <> SPACE(6) .AND. MSELL_PRI(MNBR_ITM) = 0
            
            @ 24,0 CLEAR
            MOK = SPACE(4)
            
            DO WHILE MOK <> 'OK  ' .AND. MOK <> 'EDIT'
               @ 24,1 SAY "SELL PRICE IS ZERO-ENTER 'OK' TO CONT- OR 'EDIT' TO CHANGE" GET MOK PICTURE '@!'
               READ
               IF MOK <> 'OK' .AND. MOK <> 'EDIT'
                  STORE 'Invalid Input' to minv_err
                  @ 24,66 GET MINV_ERR
                  READ
               ENDIF
            ENDDO
            IF MOK = 'EDIT'
               @ 24,1 SAY SPACE(78)
               LOOP
            ENDIF
            @ 24,1 SAY SPACE(78)
         ENDIF
         
         IF .NOT. MNEXT_ITM
            LOOP
         ENDIF
         MLINE = MLINE + 2
         IF MLINE <= 20
            MNBR_ITM = MNBR_ITM + 1
         ELSE
            MNEXT_ITM = .F.
         ENDIF
      ENDDO
      STORE 1 TO MACTION
      @ 25,0 SAY 'Action: ' + STR(MACTION,1)
      @ 25,13 SAY '1. Continue   2. Edit   3. Cont/Next Itm Pg.   4. Cancel Page'
      @ 25,8 GET MACTION PICTURE '#' RANGE 1,4
      READ
   ENDDO
   
   
   DO CASE      
   CASE MACTION = 1 .OR. MACTION = 3
      ****  WRITE BACK THIS PAGE OF DATA
      *** I IS THE ITEM NUMBER
      *** X IS TH ARRAY NUMBER
      I = ((MPAGE - 1) * 7) + 1
      X = 1
      MAPPEND = .T.
      SELECT C
      DO FILELOCK
      DO WHILE X <= 7        
         MAPPEND = .T.
         DO REPLITM
         SELECT C
         X = X + 1
         I = I + 1
      ENDDO
      
      FLUSH
      UNLOCK
      IF MACTION = 1
         MMORE_ITM = .F.
      ELSE
         MPAGE = MPAGE + 1
      ENDIF
      
   CASE MACTION = 4
      **** FINISH UP
      MMORE_ITM = .F.
      
   ENDCASE 
ENDDO 

**** CALCULATE TOTALS FOR ITEMS      
STORE 0 TO MTOT_SELL, MTOT_PURCH, MTOT_LBS, MTLBS_CALC, MTOT_STOR
SELECT C
SEEK MSALESMAN + MPO_NBR + MPO_SUFFIX
DO WHILE MSALESMAN = SALESMAN .AND. PO_NBR = MPO_NBR .AND. PO_SUFFIX = MPO_SUFFIX  .AND. .NOT. EOF()
   MTOT_SELL = MTOT_SELL + TOT_SELL
   MTOT_PURCH = MTOT_PURCH + TOT_PURCH
   
   IF SUBSTR(PACKED,1,1) = 'B'
      MCALC_LBS = VAL(SUBSTR(PACKED,2)) * LBS
   ELSE
      MCALC_LBS = LBS
   ENDIF
   
   DO RECLOCK
   REPLACE CALC_LBS WITH MCALC_LBS
   UNLOCK
   
   MTOT_LBS = MTOT_LBS + MCALC_LBS
   MTLBS_CALC = MTLBS_CALC + MCALC_LBS
   SKIP
ENDDO

SELECT B 
DO RECLOCK
*REPLACE TOT_LBS WITH MTOT_LBS
*** FOR AMERICHICKEN, ITS CASES SHIPPED (QTY), NOT LBS
IF MCOMPANY = 'MIDWEST FOOD -DIV 11' .OR. MCOMPANY = 'AMERICHICKEN, INC'
   REPLACE TOT_LBS WITH MTLBS_CALC
ELSE
   REPLACE TOT_LBS WITH MTOT_LBS
ENDIF
*REPLACE TOT_STOR WITH MTOT_STOR
UNLOCK
MPO_ADD = .T.

SET PROC TO PO_PROC 
**** FINISH UP
IF MCOMPANY = 'AMERICHICKEN, INC' .OR. MCOMPANY = 'MIDWEST FOOD -DIV 11'
   MVIEW = .F.
   RELEASE MQTY
   RELEASE MFR_FZ
   RELEASE MGRADE
   RELEASE MPAK  
   RELEASE MCLASS
   RELEASE MPROD
   RELEASE MSIZE
   RELEASE MPACKSPEC
   RELEASE MLBS
   RELEASE MPURC_PRI
   RELEASE MSELL_PRI
   RELEASE MPURC_TOT
   RELEASE MSELL_TOT
   RELEASE MSHRT_BOX
   RELEASE MSHRT_LBS
   RELEASE MBILL_PRI
   RELEASE MPAK1  
   RELEASE MPAK2  
   RELEASE MBOX_SZ
   RELEASE MOLD_LOT
   RELEASE MOLD_LBS
   RELEASE MOLD_QTY
   RELEASE MOLD_PROD
   RELEASE MIN_LOT
   RELEASE MOUT_LOT
   RELEASE MOLD_IN
   RELEASE MOLD_OUT
   RELEASE MSTOR_ITEM
   RELEASE MPAK_YR
   RELEASE MPAK_DAY
   RELEASE Mout_YR
   RELEASE Mout_DAY
   
   STORE SPACE(25) TO MCOM_NAME, MCOM_NAME2, MCOM_NAME3
   STORE SPACE(2)  TO  MCOM_CODE, MCOM_CODE2, MCOM_CODE3
   IF B->BBUYCODE <> 'INVN' .AND. B->BBUYCODE <> 'SAMP'
      DO COM_PG
   ENDIF
ENDIF
DO MISC_ADD
DO NEW_FRT    

RETURN
* EOF: ITEM_ADD.PRG

*Formatted by: ToolBox Ver. 1.2  on 3/2/17 at 2:55 PM.
