**********
* Program.: SUM_1099.PRG
* Author..: GRACE KELLER
* Date....: 01/22/88
* Notice..: Copyright 1988, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: PRINT 1099 COMMISSIONS SUMMARY
*
* ---PROCESSING LOOP

SELECT A
USE &MMASTDBF.COMLED EXCLUSIVE
INDEX ON COM_TYPE + COM_CODE + SUBSTR(DTOC(TRAN_DATE),7) + SUBSTR(DTOC(TRAN_DATE),1,2) + SUBSTR(DTOC(TRAN_DATE),4,2) TO TMPIDX
UNLOCK

SELECT A
DO FOX_USE WITH "&MMASTDBF.COMLED INDEX TMPIDX", .F.
STORE DTOC(MBEG_DATE) TO M1_DATE
STORE DTOC(MEND_DATE) TO M2_DATE
STORE SUBSTR(M1_DATE,1,2) TO MBEG_MO   
STORE SUBSTR(M1_DATE,7) TO MBEG_YEAR
STORE SUBSTR(M2_DATE,1,2) TO MEND_MO   
STORE SUBSTR(M2_DATE,7) TO MEND_YEAR         

SELECT F
DO FOX_USE WITH "1099INFO", .T.
DELETE ALL
PACK

SELECT C
DO FOX_USE WITH "&MDBFLOC.COMPAYEE INDEX &MDBFLOC.COM_CODE, &MDBFLOC.COM_NAME", .F.
SELECT B
DO FOX_USE WITH "&MMASTDBF.SALESMAN INDEX &MMASTDBF.SAL_CODE, &MMASTDBF.SAL_NAME", .F.

STORE SPACE(2) TO MOPT_CODE

IF MOPT_NAME <> SPACE(32)
   DO CASE
   CASE MSAL_TYPE = 'X'
      SELECT B
      SET ORDER TO 2
      SEEK TRIM(MOPT_NAME)
      IF EOF()
         @ 24,0 CLEAR
         STORE ' ' TO MWAIT
         @ 24,0 SAY 'SALESPERSON NOT ON FILE - CANNOT CONTINUE - PRESS ENTER TO RETURN' GET MWAIT
         READ
         CLOSE DATA
         LOOP
      ELSE
         STORE SALE_CODE TO MOPT_CODE
      ENDIF
      SET ORDER TO 1
      
   OTHERWISE
      SELECT C
      SET ORDER TO 2
      SEEK TRIM(MOPT_NAME)
      IF EOF()
         @ 24,0 CLEAR
         STORE ' ' TO MWAIT
         @ 24,0 SAY 'THD PARTY NOT ON FILE - CANNOT CONTINUE - PRESS ENTER TO RETURN' GET MWAIT
         READ
         CLOSE DATA
         LOOP
      ELSE
         STORE COM_CODE TO MOPT_CODE
      ENDIF
      SET ORDER TO 1
   ENDCASE
ENDIF


SELECT B
GOTO TOP

IF MTHD_TYPE = ' '
   DO WHILE .NOT. EOF()
      IF RPT_PRT = ' ' 
         SKIP
         LOOP
      ENDIF
      
      IF MSAL_TYPE = 'X'
         IF MOPT_CODE <> '  '
            IF SALE_CODE <> MOPT_CODE
               SKIP
               LOOP
            ENDIF
         ENDIF
      ENDIF
      
      STORE SALE_CODE TO MSALE_CODE
      STORE NAME TO MNAME
      STORE STREET TO MSTREET
      STORE CITY TO MCITY
      STORE STATE TO MSTATE
      STORE ZIP TO MZIP
      STORE SALE_SSN TO MCOM_SSN
      STORE FED_TAXID TO MFED_TAXID
      MLINE = 99
      SELECT A
      SEEK 'S' + MSALE_CODE
      IF EOF()
         SELECT B
         SKIP
         LOOP
      ENDIF
      STORE 0 TO MTOTAL
      DO WHILE .NOT. EOF() .AND. COM_TYPE = 'S' .AND. COM_CODE = MSALE_CODE ;
         .AND. TRAN_DATE <= MEND_DATE           
         IF CK_NBR = SPACE(6) .OR. TRAN_DATE < MBEG_DATE
            SKIP
            LOOP
         ENDIF
         MCK_NBR = CK_NBR
         IF ADV_REP <> ' '
            SKIP
            LOOP
         ENDIF
         
         MTOTAL = MTOTAL + AMOUNT
         SKIP
      ENDDO
      
      IF MTOTAL <> 0
         SELECT F
         APPEND BLANK
         REPLACE  NAME WITH MNAME
         REPLACE ADDR1 WITH MSTREET
         REPLACE ADDR2 WITH TRIM(MCITY) + ', ' + MSTATE + '  ' + MZIP
         DO CASE
         CASE MFED_TAXID <> SPACE(9)
            REPLACE RECPID WITH TRANSFORM(MFED_TAXID, '@R ##-#######')
         OTHERWISE
            REPLACE RECPID WITH TRANSFORM(MCOM_SSN, '@R ###-##-####')
         ENDCASE           
         REPLACE AMOUNT WITH MTOTAL * -1
      ENDIF
      
      SELECT B
      SKIP
   ENDDO
ENDIF

***** NOW PRINT FOR THIRD PARTY PAYEES
SELECT C
GOTO TOP
IF MSAL_TYPE = ' '
   DO WHILE .NOT. EOF()
      IF MTHD_TYPE = 'X'
         IF MOPT_CODE <> '  '
            IF COM_CODE <> MOPT_CODE
               SKIP
               LOOP
            ENDIF
         ENDIF
      ENDIF
      
      *** DO NOT PRINT A 1099 FOR BILL BACK COMMISSION PEOPLE
      IF BILL_BACK = 'Y'
         SKIP
         LOOP
      ENDIF
      
      STORE COM_CODE TO MCOM_CODE 
      STORE NAME TO MNAME
      STORE STREET TO MSTREET  
      STORE CITY TO MCITY    
      STORE STATE TO MSTATE 
      STORE ZIP TO MZIP
      STORE COM_SSN TO MCOM_SSN
      STORE FED_TAXID TO MFED_TAXID
      MLINE = 99
      SELECT A
      SEEK 'T' + MCOM_CODE 
      IF EOF()
         SELECT C
         SKIP
         LOOP
      ENDIF
      
      MTOTAL = 0
      
      DO WHILE .NOT. EOF() .AND. COM_TYPE = 'T' .AND. COM_CODE = MCOM_CODE ;
         .AND. TRAN_DATE <= MEND_DATE           
         
         IF CK_NBR = SPACE(6) .OR. TRAN_DATE < MBEG_DATE
            SKIP
            LOOP
         ENDIF
         IF COR_FLG = 'I' .OR. COR_FLG = 'C' .OR. COR_FLG = ' '
            SKIP
            LOOP
         ENDIF
         
         MTOTAL = MTOTAL + AMOUNT
         SKIP
      ENDDO
      
      IF MTOTAL <> 0
         SELECT F
         APPEND BLANK
         REPLACE  NAME WITH MNAME
         REPLACE ADDR1 WITH MSTREET
         REPLACE ADDR2 WITH TRIM(MCITY) + ', ' + MSTATE + '  ' + MZIP
         DO CASE
         CASE MFED_TAXID <> SPACE(9)
            REPLACE RECPID WITH TRANSFORM(MFED_TAXID, '@R ##-#######')
         OTHERWISE
            REPLACE RECPID WITH TRANSFORM(MCOM_SSN, '@R ###-##-####')
         ENDCASE           
         REPLACE AMOUNT WITH MTOTAL * -1
      ENDIF
      SELECT C
      SKIP
   ENDDO
ENDIF

MLINE = 99
MPAGE_NO= 0
MPAGE_LEN = 56

SET CONSOLE OFF
IF FILE("C:\COMPINFO\PRINTERS.DBF")
   SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
ELSE
   SET PRINT TO LPT3
ENDIF
SET DEVICE TO PRINT
SET PRINT ON

SELECT F
USE &MMASTDBF.1099INFO EXCLUSIVE
INDEX ON NAME TO 1099INFO
UNLOCK
SELECT F
DO FOX_USE WITH "&MMASTDBF.1099INFO INDEX 1099INFO", .F.

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'
DO WHILE .NOT. EOF()
   STORE NAME   TO MSV_NAME
   STORE SUBSTR(NAME,1,5) TO MSHRT_NM
   STORE ADDR1  TO MADDR1
   STORE ADDR2  TO MADDR2
   STORE RECPID TO MRECPID
   MAMOUNT = 0
   DO WHILE NAME = MSHRT_NM
      MAMOUNT = MAMOUNT + AMOUNT
      SKIP
   ENDDO
   IF MLINE > MPAGE_LEN
      IF MLINE <> 99
         EJECT
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      @ 2,30 SAY MCOMPANY
      @ 4,1 SAY 'Page'
      @ 4,06 say mpage_no picture '99'
      @ 4,15 SAY '1099 SUMMARY REPORT ' + M1_DATE + ' THRU ' + M2_DATE
      @ 4,85 SAY DTOC(DATE())
      @ 6,1 SAY 'NAME                                   PAYER ID          1099 AMOUNT'
      @ 6,1 SAY REPLICATE('_',68)
      MLINE = 8
   ENDIF
   @ MLINE,1 SAY MSV_NAME
   @ MLINE,40 SAY MRECPID
   @ MLINE,57 SAY TRANSFORM(MAMOUNT, '9,999,999.99')
   @ MLINE+1,1 SAY MADDR1 
   @ MLINE+2,1 SAY MADDR2
   MLINE = MLINE + 5
ENDDO
@ MLINE,1 SAY ' '

EJECT

SET DEVICE TO SCREEN
SET PRINT OFF
SET PRINT TO
SET CONSOLE ON
IF MPRINTER3 <> 'DONOTPRINT'
   RUN &MPRINTIT3
ENDIF

RUN DEL TMPIDX.IDX
CLOSE DATA
* EOF: SUM_1099.PRG
*Formatted by: ToolBox Ver. 1.2  on 1/8/16 at 4:42 PM.
