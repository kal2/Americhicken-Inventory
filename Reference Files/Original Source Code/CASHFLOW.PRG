********** 
* Program.: CASHFLOW.PRG
* Author..: GRACE KELLER
* Date....: 10/12/87
* Notice..: Copyright 1987, Solid Software, Inc., All Rights Reserved
* Version.: FOXPRO
* Notes...: CURRENT CASH FLOW REPORT
*
* ---PROCESSING LOOP
*  MULTI-USER RECORD/FILE LOCKING  +(M4)  CLIPPER                             
MTITLE = ' - CURRENT CASH FLOW REPORT'               
CLEAR
@  1, 1  SAY MCOMPANY
@  1,68 SAY DATE()
@  2, 0 SAY MPROGRAM + MTITLE
@ 3,0 TO 22,79
** GET MONTHLY ACTIVITY
DO CASE
CASE MPROG_CODE = 1
   
   SELECT A
   DO FOX_USE WITH "&MMASTDBF.DAILYJRN", .F.
   SET FILTER TO POST_FLG = ' '             
   GOTO TOP
   SUM TOT_SELL+CUS_PALL TO GTOT_SELL FOR BBUYCODE <> 'I' .AND. POST_FLG = ' '
   SUM TOT_PURCH+SUP_PALL TO GTOT_PURCH FOR RSUPCODE <> 'I' .AND. POST_FLG = ' '
   SUM FRT_AMT1+FRT_PALL TO GTOT_FRT FOR POST_FLG = ' '
   
   DO FOX_USE WITH "\PLANT73\DAILYJRN", .F.
   SET FILTER TO POST_FLG = ' '
   GOTO TOP
   SUM TOT_SELL+CUS_PALL TO KTOT_SELL FOR BBUYCODE <> 'I' .AND. POST_FLG = ' '
   SUM TOT_PURCH+SUP_PALL TO KTOT_PURCH FOR RSUPCODE <> 'I' .AND. POST_FLG = ' '
   SUM FRT_AMT1+FRT_PALL TO KTOT_FRT FOR POST_FLG = ' '
   
   DO FOX_USE WITH "\PLANT71\DAILYJRN", .F.
   SET FILTER TO POST_FLG = ' '
   GOTO TOP
   SUM TOT_SELL+CUS_PALL TO ITOT_SELL FOR BBUYCODE <> 'I' .AND. POST_FLG = ' '
   SUM TOT_PURCH+SUP_PALL TO ITOT_PURCH FOR RSUPCODE <> 'I' .AND. POST_FLG = ' '
   SUM FRT_AMT1+FRT_PALL TO ITOT_FRT FOR POST_FLG = ' '
   
   
   *** ACCOUNTS PAYABLE - SUPPLIER
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "&MMASTDBF.SUPLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO GSUPLED
   
   DO FOX_USE WITH "\PLANT73\SUPLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO KSUPLED
   
   DO FOX_USE WITH "\PLANT71\SUPLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO ISUPLED
   
   
   *** ACCOUNTS PAYABLE - FREIGHT
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "&MMASTDBF.FRTLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR
   GOTO TOP
   SUM AMOUNT TO GFRTLED
   
   DO FOX_USE WITH "\PLANT73\FRTLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR
   GOTO TOP
   SUM AMOUNT TO KFRTLED
   
   DO FOX_USE WITH "\PLANT71\FRTLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR
   GOTO TOP
   SUM AMOUNT TO IFRTLED
   
   
   *** ACCOUNTS RECEIVABLE - CUSTOMER
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "&MMASTDBF.CUSLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MSVTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   MSVTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO GCUSLED
   
   DO FOX_USE WITH "\PLANT73\CUSLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO KCUSLED
   
   DO FOX_USE WITH "\PLANT71\CUSLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO ICUSLED
   
   ** 1 = \BROKER\ - DIVISION 01 - MIDWEST FOOD & POULTRY
   ** 2 = \PLANT73\ - DIVISION 15 - FOOD SERVICE
   ** 3 = \PLANT71\ - DIVISION 10 - YUMA, AZ
   MTIMES = 1
   DO WHILE MTIMES <= 3
      MI = STR(MTIMES,1)
      STORE 0 TO MTOT_REC&MI, MTOT_PAY&MI, MTOT_INV&MI, MTOT_FRT&MI
      MTIMES = MTIMES + 1
   ENDDO
   
   *******CURRENT DATE******
   STORE DATE() TO MDATE              
   STORE MSVTRAN_MO TO MMONTH
   STORE MSVTRAN_YR TO MYEAR
   STORE '01' TO MDAY
   *************************
   
   *STORE MONTH(MDATE) TO MMONTH
   *MMONTH = MMONTH + 100
   *STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH
   
   *STORE YEAR(MDATE) TO MYEAR
   
   *STORE SUBSTR(STR(MYEAR,4),3) TO MYEAR
   
   *STORE DAY(MDATE) TO MDAY
   *MDAY = MDAY + 100
   *STORE SUBSTR(STR(MDAY,3),2) TO MDAY
   
   MTIMES = 1
   DO WHILE MTIMES <= 3
      DO CASE
      CASE MTIMES = 1
         MFILE = '\BROKER\'
      CASE MTIMES = 2
         MFILE = '\PLANT73\'
      CASE MTIMES = 3 
         MFILE = '\PLANT71\'
      ENDCASE
      MI = STR(MTIMES,1)
      
      **** CALCULATE THE CURRENT MONTH RECEIPTS
      SELECT A
      DO FOX_USE WITH "&MFILE.PAYMENTS INDEX &MFILE.PAY_DATE, &MFILE.PAY_PO", .F.
      SEEK MYEAR + MMONTH         
      *** ONLY GET THE CUSTOMER RECEIPTS
      DO WHILE .NOT. EOF() .AND. PAID_DATE <= MDATE
         IF ACCOUNT = SPACE(4) .AND. POST_FLG = ' '
            MTOT_REC&MI = MTOT_REC&MI + AMT_PAID + CRED_AMT + AMT_OVER
         ENDIF
         SKIP  
      ENDDO    
      CLOSE DATA
      
      **** CALCULATE THE PAYMENTS
      SELECT A
      DO FOX_USE WITH "&MFILE.DISBJRN INDEX &MFILE.DISBJRN", .F.
      
      SEEK MYEAR + MMONTH          
      DO WHILE .NOT. EOF() .AND. CTOD(JRNL_MO+'/'+JRNL_DAY+'/'+JRNL_YR) <= MDATE
         IF VOID_MAN = 'V'         
            SKIP
            LOOP
         ENDIF
         ** ONLY PICK UP POSTED ENTRIES
         IF POST_FLG <> ' '         
            SKIP
            LOOP
         ENDIF
         *** ONLY GET THE SUPPLER OR FREIGHT PAYMENTS
         DO CASE
         CASE ACCT_TYPE = 'S'
            MTOT_PAY&MI = MTOT_PAY&MI + AMOUNT1
         CASE ACCT_TYPE = 'F'
            MTOT_FRT&MI = MTOT_FRT&MI + AMOUNT1
         ENDCASE
         SKIP
      ENDDO
      CLOSE DATA
      
      
      **** CALCULATE THE INVENTORY
      DO CASE
         ** DIVISION 15
      CASE MTIMES = 2                   
         
         SELECT A
         DO FOX_USE WITH "\PLANT73\INVEN", .F.
         
         SET FILTER TO SOLD_FLG = ' '
         GOTO TOP
         DO WHILE .NOT. EOF()
            
            MCASE_LEFT = 0
            MVAL_LEFT = 0
            MLBS_LEFT = 0
            ***CALCULATE CURRENT VALUE
            
            SELECT A
            MVAL_LEFT  = VALUE
            MLBS_LEFT  = LBS
            MCASE_LEFT = CASE_CNT
            MTOT_COST = 0    
            MTOT_PRO  = 0
            MWORK_COST = 0
            SELECT B
            DO FOX_USE WITH "\PLANT73\INVN_DTL INDEX \PLANT73\DTL_LOT, \PLANT73\IDTL_DTL, \PLANT73\INVN_PO, \PLANT73\INVNDISP, \PLANT73\DTL_DATE, \PLANT73\INVN_DTL", .F.
            
            **SEEK STR(A->I_NBR,5)
            ***HERE
            SEEK A->FREEZ_LOC + A->LOT_NBR
            *DO WHILE .NOT. EOF() .AND. A->I_NBR = I_NBR
            DO WHILE .NOT. EOF() .AND. A->FREEZ_LOC = FREEZ_LOC .AND. A->LOT_NBR = LOT_NBR
               DO CASE    
               CASE ACT_CODE = 'C'
                  MTOT_COST = MTOT_COST + COST_AMT
                  MWORK_COST = MWORK_COST + COST_AMT
               CASE ACT_CODE = 'S'
                  MTHIS_COST =  ROUND(MWORK_COST/MLBS_LEFT,4) * SHIP_LBS
                  MLBS_LEFT  = MLBS_LEFT  - SHIP_LBS
                  MVAL_LEFT  = MVAL_LEFT  - SHIP_VAL               
                  MCASE_LEFT = MCASE_LEFT - SHIP_CASE
                  MTOT_PRO  = MTOT_PRO + MTHIS_COST
                  MWORK_COST = MWORK_COST - MTHIS_COST
               ENDCASE
               SKIP
            ENDDO
            MVAL_LEFT = MVAL_LEFT + ( MTOT_COST - MTOT_PRO)
            SELECT B
            USE
            SELECT A
            
            IF MLBS_LEFT <> 0
               MSTOR_UNIT = 0
               MPRO_PRI = PRI_LB + MSTOR_UNIT                  
               MVAL_LEFT = ROUND(MPRO_PRI * MLBS_LEFT,2)
            ELSE
               MPRO_PRI = 0
               MVAL_LEFT = 0
            ENDIF
            MTOT_INV&MI = MTOT_INV&MI + MVAL_LEFT
            SKIP
         ENDDO
         
      OTHERWISE
         DO CASE
         CASE MTIMES = 1           
            MDIV = '01'
         CASE MTIMES = 3                      
            MDIV = '10'
         OTHERWISE
            MDIV = '??'
         ENDCASE
         
         SELECT A
         DO FOX_USE WITH "S:INVEN", .F.
         
         SET FILTER TO SOLD_FLG = ' '
         GOTO TOP
         DO WHILE .NOT. EOF()
            IF MDIV <> DIV_CODE
               SKIP
               LOOP
            ENDIF
            
            SELECT A
            IF CASE_LEFT > 0
               MVAL_LEFT = ROUND(LBS_LEFT * PRI_LB,2)
            ENDIF
            MTOT_INV&MI = MTOT_INV&MI + MVAL_LEFT
            SKIP
         ENDDO
         
      ENDCASE
      CLOSE DATA
      
      MTIMES = MTIMES + 1
   ENDDO
   
   MT_REC = 0
   MT_PAY = 0
   MT_RECV = 0
   MT_INV  = 0
   
   MPRT_ACT = 'C'
   
   DO PRT_SET
   
   IF MPRT_ACT <> 'C'
      RETURN 
   ENDIF
   MPAGE_LEN = 56
   
   MPAGE_NO = 0
   MLINE = 1  
   
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON
   
   *** PRINT IN 12 CPI
   ?? chr(27) + '&k4S'
   
   *** LETTER GOTHIC AND BOLDED PRINT
   ?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'
   
   *** LETTER SIZE PAPER
   ?? CHR(27) + '&l2A'
   
   *** PORTRAIT MODE
   ?? CHR(27) + '&l0O'
   
   MT_REC = 0
   MPAGE_NO = MPAGE_NO + 1
   @ 1,30 SAY MCOMPANY
   @ 2,0 SAY 'PAGE'
   @ 2,05 say mpage_no picture '99'
   @ 2,27 SAY 'CASH FLOW REPORT FOR: ' + DTOC(MDATE)
   @ 2,70 SAY DTOC(DATE())
   @ 5,1 SAY 'DIVISION'
   @ 5,1+15 SAY '   DIVISION 01'
   @ 5,20+15 SAY '   DIVISION 10'
   @ 5,40+15 SAY '   DIVISION 15'
   @ 5,60+15 SAY 'COMPANY TOTALS'   
   @ 6,1 SAY REPLICATE ('_',89)
   MLINE = 8
   STORE 0 TO MTOT_PAY01, MTOT_PAY10, MTOT_PAY15
   
   @ MLINE,1 SAY 'LASTMO SUP PAY'
   @ MLINE,1+15 SAY GSUPLED PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ISUPLED PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KSUPLED PICTURE '999,999,999.99'
   M1= GSUPLED+ISUPLED+KSUPLED                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   @ MLINE,1 SAY 'CUR MO SUP PAY'
   @ MLINE,1+15 SAY GTOT_PURCH PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ITOT_PURCH PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KTOT_PURCH PICTURE '999,999,999.99'
   M2= GTOT_PURCH+ITOT_PURCH+KTOT_PURCH 
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   @ MLINE,1 SAY 'CUR MO SUP DIS'
   @ MLINE,1+15 SAY MTOT_PAY1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY MTOT_PAY3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY MTOT_PAY2  PICTURE '999,999,999.99'
   M3= MTOT_PAY1+MTOT_PAY2+MTOT_PAY3  
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,20+15 SAY '--------------'
   @ MLINE,40+15 SAY '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   MTOT_PAY01= GSUPLED+GTOT_PURCH-MTOT_PAY1 
   MTOT_PAY10= ISUPLED+ITOT_PURCH-MTOT_PAY3 
   MTOT_PAY15= KSUPLED+KTOT_PURCH-MTOT_PAY2 
   @ MLINE,1 SAY 'TOTCUR SUP PAY'
   @ MLINE,1+15 SAY GSUPLED+GTOT_PURCH-MTOT_PAY1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ISUPLED+ITOT_PURCH-MTOT_PAY3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KSUPLED+KTOT_PURCH-MTOT_PAY2 PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   @ MLINE,1 SAY 'LASTMO FRT PAY'
   @ MLINE,1+15 SAY GFRTLED PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY IFRTLED PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KFRTLED PICTURE '999,999,999.99'
   M1= GFRTLED+IFRTLED+KFRTLED                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO FRT PAY'
   @ MLINE,1+15 SAY GTOT_FRT PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ITOT_FRT PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KTOT_FRT PICTURE '999,999,999.99'
   M2= GTOT_FRT+ITOT_FRT+KTOT_FRT 
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO FRT DIS'
   @ MLINE,1+15 SAY MTOT_FRT1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY MTOT_FRT3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY MTOT_FRT2  PICTURE '999,999,999.99'
   M3= MTOT_FRT1+MTOT_FRT2+MTOT_FRT3  
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,20+15 SAY '--------------'
   @ MLINE,40+15 SAY '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   
   MTOT_PAY01= MTOT_PAY01 + GFRTLED+GTOT_FRT-MTOT_FRT1 
   MTOT_PAY10= MTOT_PAY10 + IFRTLED+ITOT_FRT-MTOT_FRT3 
   MTOT_PAY15= MTOT_PAY15 + KFRTLED+KTOT_FRT-MTOT_FRT2 
   
   @ MLINE,1 SAY 'TOTCUR FRT PAY'
   @ MLINE,1+15 SAY GFRTLED+GTOT_FRT-MTOT_FRT1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY IFRTLED+ITOT_FRT-MTOT_FRT3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KFRTLED+KTOT_FRT-MTOT_FRT2 PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   ****** TOTAL PAYABLES LINE HERE
   @ MLINE,1 SAY '=============='
   @ MLINE,1+15 SAY  '=============='
   @ MLINE,20+15 SAY '=============='
   @ MLINE,40+15 SAY '=============='
   @ MLINE,60+15 SAY '=============='
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'TOTAL CUR  PAY'
   @ MLINE,1+15 SAY MTOT_PAY01  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY MTOT_PAY10  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY MTOT_PAY15  PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY MTOT_PAY01+MTOT_PAY10+MTOT_PAY15  PICTURE '999,999,999.99'
   MLINE = MLINE + 5
   
   
   @ MLINE,1 SAY 'LASTMO CUS REC'
   @ MLINE,1+15 SAY GCUSLED PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ICUSLED PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KCUSLED PICTURE '999,999,999.99'
   M1= GCUSLED+ICUSLED+KCUSLED                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO SALES  '
   @ MLINE,1+15 SAY GTOT_SELL PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ITOT_SELL PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KTOT_SELL PICTURE '999,999,999.99'
   M2= GTOT_SELL+ITOT_SELL+KTOT_SELL
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO RECEIPT'
   @ MLINE,1+15 SAY MTOT_REC1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY MTOT_REC3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY MTOT_REC2  PICTURE '999,999,999.99'
   M3= MTOT_REC1+MTOT_REC2+MTOT_REC3  
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,20+15 SAY '--------------'
   @ MLINE,40+15 SAY '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'TOTCUR CUS REC'
   ** HERE
   @ MLINE,1+15 SAY GCUSLED+GTOT_SELL-MTOT_REC1  PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY ICUSLED+ITOT_SELL-MTOT_REC3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY KCUSLED+KTOT_SELL-MTOT_REC2 PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   @ MLINE,1 SAY 'CURRENT INVEN '
   @ MLINE,1+15 SAY MTOT_INV1   PICTURE '999,999,999.99'
   @ MLINE,20+15 SAY MTOT_INV3  PICTURE '999,999,999.99'
   @ MLINE,40+15 SAY MTOT_INV2  PICTURE '999,999,999.99'
   MINVN= MTOT_INV1 +MTOT_INV2 +MTOT_INV3  
   @ MLINE,60+15 SAY MINVN PICTURE '999,999,999.99'
   
   @ MLINE+1,1 SAY ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
   
OTHERWISE
   
   SELECT A
   DO FOX_USE WITH "DAILYJRN", .F.
   SET FILTER TO POST_FLG = ' '             
   GOTO TOP
   SUM TOT_SELL+CUS_PALL TO GTOT_SELL FOR BBUYCODE <> 'I' .AND. POST_FLG = ' '
   SUM TOT_PURCH+SUP_PALL TO GTOT_PURCH FOR RSUPCODE <> 'I' .AND. POST_FLG = ' '
   SUM FRT_AMT1+FRT_PALL TO GTOT_FRT FOR POST_FLG = ' '
   
   *** ACCOUNTS PAYABLE - SUPPLIER
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "SUPLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO GSUPLED
   
   *** ACCOUNTS PAYABLE - FREIGHT
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "FRTLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR
   GOTO TOP
   SUM AMOUNT TO GFRTLED
   
   *** ACCOUNTS RECEIVABLE - CUSTOMER
   *** GET LAST POSTED LEDGER ACTIVITY
   
   DO FOX_USE WITH "CUSLED", .F.
   GOTO BOTTOM
   MTRAN_MO = TRAN_MO
   MTRAN_YR = TRAN_YR
   MSVTRAN_MO = TRAN_MO
   MSVTRAN_YR = TRAN_YR
   SET FILTER TO TRAN_MO = MTRAN_MO .AND. TRAN_YR = MTRAN_YR .AND. LED_CODE <> 'I'
   GOTO TOP
   SUM AMOUNT TO GCUSLED
   
   
   ** 1 = P: - DIVISION 01 - MIDWEST FOOD INTERNATIONAL
   MTIMES = 1
   DO WHILE MTIMES <= 1
      MI = STR(MTIMES,1)
      STORE 0 TO MTOT_REC&MI, MTOT_PAY&MI, MTOT_INV&MI, MTOT_FRT&MI
      MTIMES = MTIMES + 1
   ENDDO
   *******CURRENT DATE******
   STORE DATE() TO MDATE              
   STORE MSVTRAN_MO TO MMONTH
   STORE MSVTRAN_YR TO MYEAR
   STORE '01' TO MDAY
   *************************
   
   *STORE MONTH(MDATE) TO MMONTH
   *MMONTH = MMONTH + 100
   *STORE SUBSTR(STR(MMONTH,3),2) TO MMONTH
   
   *STORE YEAR(MDATE) TO MYEAR
   
   *STORE SUBSTR(STR(MYEAR,4),3) TO MYEAR
   
   *STORE DAY(MDATE) TO MDAY
   *MDAY = MDAY + 100
   *STORE SUBSTR(STR(MDAY,3),2) TO MDAY
   
   MTIMES = 1
   DO WHILE MTIMES <= 1
      DO CASE
      CASE MTIMES = 1
         MFILE = '\MFI\'
      ENDCASE
      MI = STR(MTIMES,1)
      
      **** CALCULATE THE CURRENT MONTH RECEIPTS
      SELECT A
      DO FOX_USE WITH "&MFILE.PAYMENTS INDEX &MFILE.PAY_DATE, &MFILE.PAY_PO", .F.
      SEEK MYEAR + MMONTH         
      *** ONLY GET THE CUSTOMER RECEIPTS
      DO WHILE .NOT. EOF() .AND. PAID_DATE <= MDATE
         IF ACCOUNT = SPACE(4) .AND. POST_FLG = ' '
            MTOT_REC&MI = MTOT_REC&MI + AMT_PAID + CRED_AMT + AMT_OVER
         ENDIF
         SKIP  
      ENDDO    
      CLOSE DATA
      
      **** CALCULATE THE PAYMENTS
      SELECT A
      DO FOX_USE WITH "&MFILE.DISBJRN INDEX &MFILE.DISBJRN", .F.
      
      SEEK MYEAR + MMONTH          
      DO WHILE .NOT. EOF() .AND. CTOD(JRNL_MO+'/'+JRNL_DAY+'/'+JRNL_YR) <= MDATE
         IF VOID_MAN = 'V'
            SKIP
            LOOP
         ENDIF
         IF POST_FLG <> ' '
            SKIP
            LOOP
         ENDIF
         *** ONLY GET THE SUPPLER OR FREIGHT PAYMENTS
         DO CASE
         CASE ACCT_TYPE = 'S'
            MTOT_PAY&MI = MTOT_PAY&MI + AMOUNT1
         CASE ACCT_TYPE = 'F'
            MTOT_FRT&MI = MTOT_FRT&MI + AMOUNT1
         ENDCASE
         SKIP
      ENDDO
      CLOSE DATA
      
      MTIMES = MTIMES + 1
   ENDDO
   
   MT_REC = 0
   MT_PAY = 0
   MT_RECV = 0
   MT_INV  = 0
   
   MPRT_ACT = 'C'
   
   DO PRT_SET
   
   IF MPRT_ACT <> 'C'
      RETURN 
   ENDIF
   MPAGE_LEN = 56
   
   MPAGE_NO = 0
   MLINE = 1  
   
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON
   
   *** PRINT IN 12 CPI
   ?? chr(27) + '&k4S'
   
   *** LETTER GOTHIC AND BOLDED PRINT
   ?? chr(27) + '(s4102T' + chr(27) + '(s3B' + chr(27) + '(s3B'
   
   *** LETTER SIZE PAPER
   ?? CHR(27) + '&l2A'
   
   *** PORTRAIT MODE
   ?? CHR(27) + '&l0O'
   
   MT_REC = 0
   MPAGE_NO = MPAGE_NO + 1
   @ 1,30 SAY MCOMPANY
   @ 2,0 SAY 'PAGE'
   @ 2,05 say mpage_no picture '99'
   @ 2,27 SAY 'CASH FLOW REPORT FOR: ' + DTOC(MDATE)
   @ 2,70 SAY DTOC(DATE())
   @ 5,1 SAY 'DIVISION'
   @ 5,1+15 SAY '         M F I'
   @ 5,60+15 SAY 'COMPANY TOTALS'   
   @ 6,1 SAY REPLICATE ('_',89)
   MLINE = 8
   STORE 0 TO MTOT_PAY01, MTOT_PAY10, MTOT_PAY15
   
   @ MLINE,1 SAY 'LASTMO SUP PAY'
   @ MLINE,1+15 SAY GSUPLED PICTURE '999,999,999.99'
   M1= GSUPLED                                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   
   MLINE = MLINE + 1
   @ MLINE,1 SAY 'CUR MO SUP PAY'
   @ MLINE,1+15 SAY GTOT_PURCH PICTURE '999,999,999.99'
   M2= GTOT_PURCH                       
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   
   MLINE = MLINE + 1
   @ MLINE,1 SAY 'CUR MO SUP DIS'
   @ MLINE,1+15 SAY MTOT_PAY1  PICTURE '999,999,999.99'
   M3= MTOT_PAY1                      
   
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   
   MTOT_PAY01= GSUPLED+GTOT_PURCH-MTOT_PAY1 
   @ MLINE,1 SAY 'TOTCUR SUP PAY'
   @ MLINE,1+15 SAY GSUPLED+GTOT_PURCH-MTOT_PAY1  PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   @ MLINE,1 SAY 'LASTMO FRT PAY'
   @ MLINE,1+15 SAY GFRTLED PICTURE '999,999,999.99'
   M1= GFRTLED                                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO FRT PAY'
   @ MLINE,1+15 SAY GTOT_FRT PICTURE '999,999,999.99'
   M2= GTOT_FRT                    
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO FRT DIS'
   @ MLINE,1+15 SAY MTOT_FRT1  PICTURE '999,999,999.99'
   M3= MTOT_FRT1
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   
   MTOT_PAY01= MTOT_PAY01 + GFRTLED+GTOT_FRT-MTOT_FRT1 
   
   @ MLINE,1 SAY 'TOTCUR FRT PAY'
   @ MLINE,1+15 SAY GFRTLED+GTOT_FRT-MTOT_FRT1  PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   ****** TOTAL PAYABLES LINE HERE
   @ MLINE,1 SAY '=============='
   @ MLINE,1+15 SAY  '=============='
   @ MLINE,60+15 SAY '=============='
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'TOTAL CUR  PAY'
   @ MLINE,1+15 SAY MTOT_PAY01  PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY MTOT_PAY01  PICTURE '999,999,999.99'
   MLINE = MLINE + 5
   
   @ MLINE,1 SAY 'LASTMO CUS REC'
   @ MLINE,1+15 SAY GCUSLED PICTURE '999,999,999.99'
   M1= GCUSLED                                             
   @ MLINE,60+15 SAY M1 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO SALES  '
   @ MLINE,1+15 SAY GTOT_SELL PICTURE '999,999,999.99'
   M2= GTOT_SELL                       
   @ MLINE,60+15 SAY M2 PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'CUR MO RECEIPT'
   @ MLINE,1+15 SAY MTOT_REC1  PICTURE '999,999,999.99'
   M3= MTOT_REC1                       
   @ MLINE,60+15 SAY M3    PICTURE '999,999,999.99'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY '--------------'
   @ MLINE,1+15 SAY  '--------------'
   @ MLINE,60+15 SAY '--------------'
   MLINE = MLINE + 1
   
   @ MLINE,1 SAY 'TOTCUR CUS REC'
   ** HERE
   @ MLINE,1+15 SAY GCUSLED+GTOT_SELL-MTOT_REC1  PICTURE '999,999,999.99'
   @ MLINE,60+15 SAY M1+M2-M3    PICTURE '999,999,999.99'
   
   MLINE = MLINE + 3
   
   *@ MLINE,1 SAY 'CURRENT INVEN '
   *@ MLINE,1+15 SAY MTOT_INV1   PICTURE '999,999,999.99'
   *@ MLINE,20+15 SAY MTOT_INV3  PICTURE '999,999,999.99'
   *@ MLINE,40+15 SAY MTOT_INV2  PICTURE '999,999,999.99'
   *MINVN= MTOT_INV1 +MTOT_INV2 +MTOT_INV3  
   *@ MLINE,60+15 SAY MINVN PICTURE '999,999,999.99'
   
   @ MLINE+1,1 SAY ' '
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
   
   
ENDCASE
CLOSE DATA

RETURN

* EOF: CASHFLOW.PRG
*Formatted by: ToolBox Ver. 1.2  on 12/8/15 at 1:13 PM.
