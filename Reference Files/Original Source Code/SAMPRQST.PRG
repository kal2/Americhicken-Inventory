*************************
*  FILE NAME: SAMPRQST.PRG
*  DESC:
*  CALLED BY:
*  DATA FILES:
CLEAR
@ 00,00 SAY MCOMPANY
@ 01,71 SAY DATE()
@ 01,00 SAY MPROGRAM + ' - ORDERS WITH SAMPLE REQUESTS'                 
@ 2,0 to 24,79
MPRT_DISP = 'D'
STORE DATE() TO MBEGIN, MEND
STORE 'N' TO MOPT_ITMS
@ 21,16 SAY SPACE(34)
@ 06,3 SAY 'SELECT FOLLOWING OPTION'
@ 07,3 SAY 'DISPLAY (D) or PRINT (P): ' GET MPRT_DISP PICTURE '@!'
@ 09,3 SAY 'BEGIN PRODUCTION SHIP DATE: ' GET MBEGIN
@ 10,3 SAY 'END   PRODUCTION SHIP DATE: ' GET MEND
READ
IF MPRT_DISP <> 'D' .AND. MPRT_DISP <> 'P'
   RETURN
ELSE
   IF MPRT_DISP = 'P'
      @ 12,3 SAY 'PRINT PO ITEM DETAILS (Y/N):' GET MOPT_ITMS PICTURE '@!'
      READ
      MPAGE_LEN = 56
      MPRT_ACT = 'C'
      DO PRT_SET
      IF MPRT_ACT <> 'C'
         RETURN
      ENDIF
   ELSE
      MPAGE_LEN = 23
   ENDIF
ENDIF
MPAGE_NO = 0
MLINE = 99

IF MPRT_DISP = 'P'
   @ 11,3 SAY 'NOW SELECTING, PRINTING........'
   SET CONSOLE OFF
   IF FILE("C:\COMPINFO\PRINTERS.DBF")
      SET PRINT TO C:\COMPINFO\PRT_FILE.TXT
   ELSE
      SET PRINT TO LPT3
   ENDIF
   SET DEVICE TO PRINT
   SET PRINT ON

*** PRINT IN 10 CPI
?? chr(27) + '&k0S'

*** LETTER GOTHIC AND BOLDED PRINT
?? chr(27) + '(s4102T' + chr(27) + '(s3B'

*** LETTER SIZE PAPER
?? CHR(27) + '&l2A'

*** PORTRAIT MODE
?? CHR(27) + '&l0O'
   
ELSE
   CLEAR
ENDIF

SELECT B
DO FOX_USE WITH "&MDBFLOC.BIL_BUY INDEX &MDBFLOC.BBUYCODE", .F.

SELECT D
DO FOX_USE WITH "PO_DTL INDEX PO_DTL", .F.

SELECT A
DO FOX_USE WITH "PO_HEAD INDEX PO_SHIP", .F.

SEEK STR(YEAR(MBEGIN),4) + SUBSTR(DTOC(MBEGIN),1,2)
IF EOF()
   @ 24,0 CLEAR
   STORE ' ' TO MWAIT
   @ 24,1 SAY 'NO ORDERS ON FILE WITH THE BEGIN SHIP DATE- PRESS ENTER TO CONTINUE' GET MWAIT
   READ
   CLOSE DATA
   RETURN
ENDIF
DO WHILE SHIP_DATE < MBEGIN
   SKIP
ENDDO
DO WHILE .NOT. EOF() .AND. SHIP_DATE <= MEND
   IF RSUPCODE = 'INVN' .OR. RSUPCODE = 'NONE'
      SKIP
      LOOP
   ENDIF
   IF BBUYCODE = 'NONE' .OR. BBUYCODE = 'SAMP'
      SKIP
      LOOP
   ENDIF
   
   IF MLINE > MPAGE_LEN
      IF MPRT_DISP = 'P'
         IF MLINE <> 99
            EJECT        
         ENDIF
      ELSE
         IF MLINE <> 99
            STORE ' ' TO MWAIT
            @ 24,1 SAY 'PRESS RETURN/ENTER FOR NEXT PAGE ' GET MWAIT
            READ
         ENDIF
         CLEAR
      ENDIF
      MPAGE_NO = MPAGE_NO + 1
      MLINE = 1
      @ MLINE,1  SAY 'PAGE NBR: ' + STR(MPAGE_NO,2)
      @ MLINE,20 SAY MCOMPANY + SPACE(12) + DTOC(DATE())
      MLINE = MLINE + 1
      @ MLINE,20 SAY 'SAMPLE REQUEST REPORT' 
      MLINE = MLINE + 2
      @ MLINE,1 SAY 'PO NUMBER'
      @ MLINE,11 SAY 'SHIP DATE'
      @ MLINE,23 SAY 'DELIVERY'
      @ MLINE,35 SAY 'CUSTOMER'
      MLINE = 6
   ENDIF
   
   @ MLINE,1 SAY SALESMAN 
   @ MLINE,3 SAY '-'         
   @ MLINE,4 SAY PO_NBR    
   IF PO_SUFFIX <> ' '
      @ MLINE,8 SAY '-' + PO_SUFFIX
   ENDIF
   @ MLINE,11 SAY SHIP_DATE
   @ MLINE,23 SAY DEL_REQD
   SELECT B
   SEEK A->BBUYCODE
   IF EOF()
      @ MLINE,35 SAY 'CUSTOMER NOT ON FILE'
   ELSE
      @ MLINE,35 SAY SUBSTR(NAME,1,20)
   ENDIF
   SELECT A
   IF MOPT_ITMS = 'Y'
      MLINE = MLINE + 1
      SELECT D
      SEEK A->SALESMAN + A->PO_NBR + A->PO_SUFFIX
      DO WHILE .NOT. EOF() .AND. SALESMAN = A->SALESMAN .AND. PO_NBR = A->PO_NBR .AND. PO_SUFFIX = A->PO_SUFFIX
         IF MLINE > MPAGE_LEN
            IF MLINE <> 99
               EJECT        
            ENDIF
            MPAGE_NO = MPAGE_NO + 1
            MLINE = 1
            @ MLINE,1  SAY 'PAGE NBR: ' + STR(MPAGE_NO,2)
            @ MLINE,20 SAY MCOMPANY + SPACE(12) + DTOC(DATE())
            MLINE = MLINE + 1
            @ MLINE,20 SAY 'SAMPLE REQUEST REPORT' 
            MLINE = MLINE + 2
            @ MLINE,1 SAY 'PO NUMBER'
            @ MLINE,11 SAY 'SHIP DATE'
            @ MLINE,23 SAY 'DELIVERY'
            @ MLINE,35 SAY 'CUSTOMER'
            MLINE = 6
         ENDIF
         @ MLINE,11 SAY PROD_DESC
         @ MLINE,23 SAY QTY PICTURE '9999'
         IF IN_LOT <> SPACE(10)
            @ MLINE,35 SAY 'IN: ' + IN_LOT
         ENDIF
         IF OUT_LOT <> SPACE(10)
            @ MLINE,48 SAY 'OUT: ' + OUT_LOT
         ENDIF
         MLINE = MLINE + 1
         SKIP
      ENDDO
      MLINE = MLINE + 2
      SELECT A
      SKIP
      
   ELSE
      MLINE = MLINE + 2
      SELECT A
      SKIP
   ENDIF
ENDDO

IF MLINE =  99
   @ 10,3 SAY 'NO ORDERS SELECTED FOR REPORT'                            
ELSE
   IF MPRT_DISP = 'D'
      @ 23,1 CLEAR
      MLINE = 23
   ENDIF
ENDIF

IF MPRT_DISP = 'P'
   EJECT
   SET DEVICE TO SCREEN
   SET PRINT OFF
   SET PRINT TO
   SET CONSOLE ON
   IF MPRINTER3 <> 'DONOTPRINT'
      RUN &MPRINTIT3
   ENDIF
ELSE
   STORE ' ' TO MWAIT
   @ 24,1 SAY 'PRESS RETURN TO FINISH ' GET MWAIT
   READ
ENDIF

CLOSE DATA
MRPT_SEL   = ' '
RETURN


* EOF: SAMPRQST.PRG
*Formatted by: ToolBox Ver. 1.2  on 7/23/14 at 1:53 PM.
